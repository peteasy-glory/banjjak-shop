<?
$shop_title	= "예약 접수";
include($_SERVER['DOCUMENT_ROOT'] . "/include/global.php");
include($_SERVER['DOCUMENT_ROOT'] . "/include/skin/header_shop.php");
include($_SERVER['DOCUMENT_ROOT'] . "/include/check_login_shop.php");

$searchTxt = (isset($_GET['searchTxt'])) ? $_GET['searchTxt'] : "";
$customer_cellphone = (isset($_GET['cellPhone'])) ? $_GET['cellPhone'] : "";
$customer_id = (isset($_GET['customer_id'])) ? $_GET['customer_id'] : "";
//$shop_id = $_SESSION['gobeauty_user_id'];

if($_SESSION['artist_flag'] === true){
    $shop_id = $_SESSION['shop_user_id'];
    $user_name = $_SESSION['shop_user_nickname'];
}else{
    $shop_id = $_SESSION['gobeauty_user_id'];
    $user_name = $_SESSION['gobeauty_user_nickname'];
}

$cellPhone = $_GET['cellPhone'];
$worker = $_GET['worker'];
$workTime = $_GET['workTime'];
$workDate = $_GET['workDate'];
$backurl = $_GET['backurl'];
/* 미용사 아이디 구하기 2020-02-18 james */
$sql = "SELECT * FROM tb_artist_list WHERE nicname = '{$worker}'";
$res = mysqli_query($connection, $sql);
$rs = mysqli_fetch_assoc($res);

// 중복예약 방지 쿠키 생성
$_SESSION['reserve_go'] = 1;

$data = array(); // all_data
$crypto = new Crypto();
if ($customer_cellphone && $customer_cellphone != "") {
    $where_qy = "";
    if(strpos($customer_id, '신규등록') === false){
        $where_id = "WHERE id = '{$customer_id}' ";
    }else{
        $where_id = "WHERE cellphone = '{$customer_cellphone}' ";
    }
    // 회원 데이터 호출(정회원)
    $cellphone_encode = $crypto->encode($customer_cellphone, $access_key, $secret_key);
    $sql = "
		SELECT *
		FROM tb_customer
		".$where_id."
			and nickname not like 'cellp_%'
	";	// 20210705 by migo - cellp 제외 조건
//    echo $sql."<p>";
    $result = mysqli_query($connection, $sql);
    $member_cnt = mysqli_num_rows($result);
    if ($member_cnt == 0) { // (가회원)
        $sql = "
			SELECT *
			FROM tb_tmp_user
			WHERE cellphone = '" . $customer_cellphone . "'
		";
        $result = mysqli_query($connection, $sql);
        $data["customer"] = mysqli_fetch_assoc($result);
        $data["customer"]["tmp_yn"] = "Y";
        //$where_qy  = " AND mp.tmp_yn = '" . $data["customer"]["tmp_yn"] . "' ";
        $where_qy .= " AND mp.tmp_seq = '" . $data["customer"]["tmp_seq"] . "' ";
    } else {
        $data["customer"] = mysqli_fetch_assoc($result);
        $data["customer"]["tmp_yn"] = "N";
        //$where_qy  = " AND mp.tmp_yn = '" . $data["customer"]["tmp_yn"] . "' ";
        $where_qy .= " AND mp.customer_id = '" . $data["customer"]["id"] . "' ";
        $data["customer"]["cellphone"] = $customer_cellphone;
    }
    // 펫 리스트 호출
    $sql = "
		SELECT * FROM (
			SELECT 
				if(sum(pl.data_delete) > 0, NULL, mp.pet_seq) AS pet_seq,
				if(sum(pl.data_delete) > 0, NULL, mp.name) AS name, 
				if(sum(pl.data_delete) > 0, NULL, mp.photo) AS photo
			FROM tb_mypet AS mp
				LEFT OUTER JOIN (
					SELECT * 
					FROM tb_payment_log
					WHERE artist_id = '" . $shop_id . "'
				) AS pl ON mp.pet_seq = pl.pet_seq
				
			WHERE 1=1 
			AND mp.data_delete = '0'
			" . $where_qy . "
			GROUP BY mp.pet_seq
		) AS past
		WHERE past.pet_seq IS NOT NULL
	";
    //echo $sql."<p>";
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        if ($row["pet_name"] != "") {
            $row["name"] = $row["pet_name"];
        }

        $data["pet_list"][] = $row;
    }

    //$selected_pet_seq = ($customer_pet_seq != "" && $customer_pet_seq != null && $customer_pet_seq != "all") ? $customer_pet_seq : $data["pet_list"][0]["pet_seq"];
    $selected_pet_seq = $_GET['no'];
    $where_qy .= " AND mp.pet_seq = '" . $selected_pet_seq . "' ";

    $last_delete = count($data["pet_list"]);


    // 펫 데이터 호출
    $sql = "
		SELECT mp.*, ac.pet_name,
		(select file_path from tb_mypet_beauty_photo tmbp where  artist_id ='{$shop_id}' and pet_seq ='{$selected_pet_seq}' order by idx desc limit 1) as gallery_file_path
		FROM tb_mypet AS mp
			LEFT OUTER JOIN tb_artist_customer_list AS ac ON ac.pet_seq = mp.pet_seq
		WHERE 1=1 " . $where_qy . "
		LIMIT 1
	";
    //echo $sql;
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        if ($row["pet_name"] != "") {
            $row["name"] = $row["pet_name"];
        }
        $data["pet"] = $row;
    }


//    print_r($data["pet"][0]);
    // 즉시예약 세션
    $_SESSION['bjj_stop_direct_flag'] = "0";
    $_SESSION['bjj_cellphone'] = $customer_cellphone;
    $_SESSION['bjj_pet_seq'] = $data["pet"]["pet_seq"];
    $_SESSION['bjj_pet_name'] = $data["pet"]["name"];
    $_SESSION['bjj_pet_kind'] = $data["pet"]["type"];
    $_SESSION['bjj_pet_type'] = $data["pet"]["pet_type"];
    $_SESSION['bjj_pet_type2'] = $data["pet"]["pet_type2"];
    $_SESSION['bjj_pet_gender'] = $data["pet"]["gender"];
    $_SESSION['bjj_neutral'] = $data["pet"]["neutral"];

    // 메모 데이터 호출
    $sql = "
		SELECT *
		FROM tb_payment_log 
		WHERE cellphone = '" . $customer_cellphone . "' 
			AND artist_id = '" . $shop_id . "' 
			AND pet_seq = '" . $data["pet"]["pet_seq"] . "'
			AND etc_memo != ''
		ORDER BY DATE_FORMAT(CONCAT(year, '-', month, '-', day), '%Y-%m-%d') DESC";
    $result = mysqli_query($connection, $sql);
    $memo_cnt = mysqli_num_rows($result);
    while ($row = mysqli_fetch_assoc($result)) {
        $data["memo"][] = $row;
    }

    // 노쇼 횟수 호출
    $sql = "
		SELECT count(is_no_show) AS cnt_no_show
		FROM tb_payment_log 
		WHERE artist_id = '" . $shop_id . "' 
			AND is_no_show = 1 
			AND is_cancel = 0 
			AND cellphone = '" . $customer_cellphone . "'
	";
    $result = mysqli_query($connection, $sql);
    $data["cnt_no_show"] = mysqli_fetch_assoc($result);
    $data["cnt_no_show"] = $data["cnt_no_show"]["cnt_no_show"];

    // 회원 거래내역 호출
    $where_qy = ($customer_pet_seq != "all") ? " AND pet_seq = '" . $_GET['no'] . "' " : "";
    $sql = "
		SELECT *, DATE_FORMAT(CONCAT(year, '-', month, '-', day), '%Y-%m-%d') AS check_in_date
		FROM tb_payment_log 
		WHERE cellphone = '" . $customer_cellphone . "'
			AND artist_id = '" . $shop_id . "'
			AND data_delete = '0'
			" . $where_qy . "
		ORDER BY DATE_FORMAT(CONCAT(year, '-', month, '-', day), '%Y-%m-%d') DESC
	";
//    echo $sql;
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        $data["payment"][] = $row;
        $row["payment_type"] = "beauty";
        $data["total_payment"][] = $row;
    }

    // 회원 호텔내역 호출
    $where_qy = ($customer_pet_seq != "all") ? " AND hpl.pet_seq = '" . $data["pet"]["pet_seq"] . "' " : "";
    $sql = "
		SELECT mp.name, hpl.*,
			hr.room_name, hr.check_in_date, hr.check_out_date, hr.pickup_price, hr.neutral_price, hr.extra_price, hr.weight, 
			TIMESTAMPDIFF(DAY, hr.check_in_date, hr.check_out_date) AS datediff
		FROM tb_hotel_payment_log as hpl
			INNER JOIN tb_hotel_reservation AS hr ON hpl.order_num = hr.order_num
			INNER JOIN tb_mypet AS mp ON hpl.pet_seq = mp.pet_seq
		WHERE hpl.is_delete = '2'
			AND hpl.cellphone = '" . $customer_cellphone . "'
			AND hpl.artist_id = '" . $shop_id . "'
			" . $where_qy . "
	";
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        $data["hotel"][] = $row;
        $row["payment_type"] = "hotel";
        $data["total_payment"][] = $row;
    }

    // 회원 유치원 내역 호출
    $where_qy = ($customer_pet_seq != "all") ? " AND ppl.pet_seq = '" . $data["pet"]["pet_seq"] . "' " : "";
    $sql = "
		SELECT mp.name, ppl.*,
			pr.room_name, pr.check_in_date, pr.check_out_date, pr.pickup_price, pr.neutral_price, pr.extra_price, pr.weight, 
			TIMESTAMPDIFF(DAY, pr.check_in_date, pr.check_out_date) AS datediff
		FROM tb_playroom_payment_log as ppl
			INNER JOIN tb_playroom_reservation AS pr ON ppl.order_num = pr.order_num
			INNER JOIN tb_mypet AS mp ON ppl.pet_seq = mp.pet_seq
		WHERE ppl.cellphone = '" . $customer_cellphone . "'
			AND ppl.artist_id = '" . $shop_id . "'
			" . $where_qy . "
	";
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        $data["playroom"][] = $row;
        $row["payment_type"] = "playroom";
        $data["total_payment"][] = $row;
    }

    // 통합 결제 시간순 정렬
    foreach ($data["total_payment"] as $key => $value) {
        $sort[$key] = $value['check_in_date'];
    }
    array_multisort($sort, SORT_DESC, $data["total_payment"]);

    // 상단 이미지
    if ($data["pet_list"][0]["photo"] == null || $data["pet_list"][0]["photo"] == "") {
        if ($data["pet_list"][0]["type"] == "dog") {
            $data["pet_list"][0]["photo"] = $image_directory . "/dog_pet.png";
        } else if ($data["pet_list"][0]["type"] == "cat") {
            $data["pet_list"][0]["photo"] = $image_directory . "/cat_pet.png";
        } else {
            $data["pet_list"][0]["photo"] = $image_directory . "/dog_pet.png";
        }
    }

    // 하단 이미지
    if ($data["pet"]["photo"] == null || $data["pet"]["photo"] == "") {
        if ($data["pet"]["type"] == "dog") {
            $data["pet"]["photo"] = $image_directory . "/dog_pet.png";
        } else if ($data["pet"]["type"] == "cat") {
            $data["pet"]["photo"] = $image_directory . "/cat_pet.png";
        } else {
            $data["pet"]["photo"] = $image_directory . "/dog_pet.png";
        }
    }

    $data['pet']['latest_pet_photo'] = ($data['pet']['gallery_file_path']) ? $data['pet']['gallery_file_path'] : $data['pet']['photo'];	// 20210617 by migo - 미용사진이력에 추가된 사진이 있을 경우 변경 지정



    // 2020-05-12 ulmo 연락처 연결기능 추가
    $family_data = "";
    if ($data["customer"]["customer_id"] == "") {
        $beauty_cellphone = $customer_cellphone;
        $where_qy = " AND to_cellphone = '" . $beauty_cellphone . "' ";
    } else {
        $beauty_cellphone = $crypto->decode($data["customer"]["cellphone"], $access_key, $secret_key);
        $where_qy = " AND ( to_customer_id = '" . $data["customer"]["customer_id"] . "' OR to_cellphone = '" . $beauty_cellphone . "' ) ";
    }

    $sql = "
		SELECT *
		FROM tb_customer_family
		WHERE artist_id = '" . $shop_id . "'
			AND is_delete = '0' 
			" . $where_qy . " 
	";
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        $family_data .= $row['from_nickname'] . " : " . add_hyphen($row['from_cellphone']) . "<br/>";
    }

    // 2020-09-29 ulmo 펫샵별 회원메모 추가
    $sql = "
		SELECT *
		FROM tb_shop_customer_memo
		WHERE artist_id = '" . $shop_id . "'
			AND customer_id = '" . $data["customer"]["id"] . "'
			AND tmp_seq = '" . $data["customer"]["tmp_seq"] . "'
			AND is_delete = '2'
	";
    //echo $sql;
    $result = mysqli_query($connection, $sql);
    while ($row = mysqli_fetch_assoc($result)) {
        $data["shop_customer_memo"]["memo"] = $row["memo"];
        $data["shop_customer_memo"]["scm_seq"] = $row["scm_seq"];
    }

    // 2020-11-18 ulmo 회원 적립금 추가
    $where_qy = "";
    if ($data["customer"]["id"] != "") { // 정회원
        $where_qy = " AND customer_id = '" . $data["customer"]["id"] . "' ";
    } else if ($data["customer"]["tmp_seq"] != "") { // 가회원
        $where_qy = " AND tmp_seq = '" . $data["customer"]["tmp_seq"] . "' ";
    }

    if ($where_qy != "") {
        $sql = "
			SELECT *
			FROM tb_user_reserve
			WHERE is_delete = '2'
				AND artist_id = '" . $shop_id . "'
				" . $where_qy . "
		";
        $result = mysqli_query($connection, $sql);
        $row = mysqli_fetch_assoc($result);
        $data["user_reserve"] = $row["reserve"];

        foreach ($data["payment"] as $key => $value) {
            $sql = "
				SELECT *
				FROM tb_user_reserve_log
				WHERE is_delete = '2'
					AND artist_id = '" . $shop_id . "'
					AND customer_id = '" . $data["customer"]["id"] . "'
					AND service_type = 'B'
					AND type = 'R'
					AND payment_log_seq = '" . $value["payment_log_seq"] . "'
			";
            $result = mysqli_query($connection, $sql);
            while ($row = mysqli_fetch_assoc($result)) {
                $data["reserve"][$row["payment_log_seq"]] = $row["add_reserve"];
            }
        }
    } else {
        $data["reserve"][$row["payment_log_seq"]] = 0;
    }
    // 20210818 펫삭제
    // 해당 샵에 미용기록이 있는지
    // 0 = 없음
    $sql = "
		SELECT COUNT(*) AS another_reserve FROM tb_payment_log 
		WHERE pet_seq = '" . $data["pet"]["pet_seq"] . "'
		AND artist_id = '" . $shop_id . "'
	";
    /*echo "쿼리 실행";
    echo $sql."<br>";*/
    $result = mysqli_query($connection, $sql);
    $data["another_reserve"] = mysqli_fetch_assoc($result);
    $data["another_reserve"] = $data["another_reserve"]["another_reserve"];


    $que = "SELECT * FROM tb_working_schedule WHERE customer_id = '{$shop_id}'";
    $res = sql_query($que);
    $wt = sql_fetch($res);


    $que = "SELECT * FROM tb_shop WHERE customer_id = '{$shop_id}'";
    $res = sql_query($que);
    $r = sql_fetch($res);
}

$sql = "
    SELECT *
    FROM tb_shop_reserve_money
    WHERE artist_id = '" . $shop_id . "'
";
$result = mysqli_query($connection, $sql);
$data["reserve_money"] = mysqli_fetch_assoc($result);


?>

    <!-- container -->
    <section id="container">
        <!-- page-body -->
        <form action="./data/make_reservation.php" method="post" name="f">
            <input type="hidden" name="shopName" value="<?php echo $r['name'];?>">
            <input type="hidden" name="cellPhone" value="<?php echo $cellPhone; ?>">
            <input type="hidden" name="worker" value="<?php echo $worker; ?>">
            <input type="hidden" name="workTime" value="<?php echo $workTime; ?>">
            <input type="hidden" name="workDate" value="<?php echo date("Y-m-d",strtotime($workDate)); ?>">
            <input type="hidden" name="customer_id" id="customer_id" value="">
            <input type="hidden" name="coupon_seq" id="coupon_seq" value="">
            <input type="hidden" name="alarm_yn" id="alarm_yn" value="Y">
            <input type="hidden" name="deposit_check" id="deposit_check_" value="Y">
            <input type="hidden" name="is_reserve_pay" id="is_reserve_pay" value="0">
            <input type="hidden" name="befor_day_alarm_yn" id="befor_day_alarm_yn" value="Y">
            <input type="hidden" name="reserve_deposit_time_" id="reserve_deposit_time_" value="">
            <input type="hidden" name="backurl" id="alarm_yn" value="<?php echo $backurl;?>">
            <input type="hidden" name="bank_name" value="<?php echo $data["reserve_money"]['bank_name']?>">
            <input type="hidden" name="bank_account" value="<?php echo $data["reserve_money"]['account_num'];?>">
            <input type="hidden" id="write_ing" value="n">
            <div class="page-body">
                <!-- reserve-accept-wrap -->
                <div class="reserve-accept-wrap">
                    <div class="wide-tab">
                        <div class="wide-tab-inner">
                            <!-- 활성화시 actived클래스 추가 -->
                            <div class="tab-cell actived"><a href="#" class="btn-tab-item">기존 고객 예약 </a></div>
                            <div class="tab-cell"><a href="javascript:chk_dt('reserve_accept_2?&worker=<?php echo $_GET['worker'];?>&workTime=<?php echo $_GET['workTime'];?>&workDate=<?php echo $_GET['workDate'];?>');" class="btn-tab-item">신규 고객 예약</a></div>
                        </div>
                    </div>
                    <div class="basic-data-group vmiddle">
                        <div class="form-group">
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">전화번호</div>
                                    <div class="form-item-data type-2">
                                        <input type="text" readonly class="readonly" value="<?= $customer_cellphone ?>">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">메모</div>
                                    <div class="form-item-data type-3">
                                        <div class="font-size-14"><?= $data["shop_customer_memo"]["memo"] ?></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">펫 선택</div>
                                    <div class="form-item-data type-2">
                                        <div class="grid-layout basic">
                                            <div class="grid-layout-inner">
                                                <?php
                                                //print_r($data["pet_list"]);
                                                foreach ($data["pet_list"] as $key => $value) {
                                                    $str_class_on = ($value["pet_seq"] == $_GET['no']) ? "checked" : "";
                                                    ?>
                                                    <div class="grid-layout-cell flex-auto">
                                                        <label class="form-toggle-box"><input name="pet_no" class="pet-no" type="radio" <?= $str_class_on ?> value="<?php echo $value['pet_seq'];?>" data-no="<?php echo $value['pet_seq'];?>"><em><?= $value["name"] ?></em></label>
                                                    </div>
                                                    <?php
                                                }
                                                ?>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="basic-data-group">
                        <div class="con-title-group">
                            <h4 class="con-title">펫 정보</h4>
                            <p class="title-need font-color-red">*필수사항만 입력해도 예약등록 가능</p>
                        </div>
                        <div class="form-group">
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label"><em class="need">*</em>펫 이름</div>
                                    <div class="form-item-data">
                                        <input type="text" name="pet_name" id="pet_name" class="form-control" value="<?= $data["pet"]["name"] ?>" placeholder="펫 이름 입력">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label"><em class="need">*</em>품종</div>
                                    <div class="form-item-data type-2">
                                        <div class="pet-breed-select">
                                            <div class="breed-select">

                                                <label class="form-toggle-box" for="breed1">
                                                    <input type="radio" name="pet_kind" id="breed1" value="dog" <?= ($data["pet"]['type'] == "dog") ? "checked" : ""; ?>>
                                                    <em><span>강아지</span></em>
                                                </label>
                                                <label class="form-toggle-box" for="breed2">
                                                    <input type="radio" name="pet_kind" id="breed2" value="cat" <?= ($data["pet"]['type'] == "cat") ? "checked" : ""; ?>>
                                                    <em><span>고양이</span></em>
                                                </label>
                                            </div>
                                            <!-- 강아지 -->
                                            <div style="display:block" id="is_dog">
                                                <select  name="pet_type" id="pet_type_dog">
                                                <?php
                                                $que = "SELECT * FROM tb_pet_type WHERE type = 'dog' ORDER BY name = '기타' ASC, name ASC ";
                                                //echo $que;
                                                $arr = sql_fetch_array($que);
                                                foreach($arr as $list){
                                                    ?>
                                                    <option value="<?php echo $list['name'];?>" <?php echo ($list['pet_seq']==$data["pet"]["pet_seq"])?'selected':'';?>><?php echo $list['name'];?></option>
                                                <?php } ?>
                                                <div>
                                                    <input id="pet_type2" type="text" name="pet_type2" class="input input_full" style="display:none"/>
                                                </div>
                                            </div>
                                            <!-- //강아지 -->
                                            <!-- 고양이 -->
                                            <div style="display:none" id="is_cat">
                                                <select  name="pet_type" id="pet_type_cat">
                                                    <?php
                                                        $que = "SELECT * FROM tb_pet_type WHERE type = 'cat' AND name != '기타' ORDER BY name ASC ";
                                                        $arr = sql_fetch_array($que);
                                                        foreach($arr as $list){
                                                    ?>
                                                    <option value="<?php echo $list['name'];?>"><?php echo $list['name'];?></option>
                                                    <?php } ?>
                                                    <option value="기타">기타</option>
                                                </select>
                                            </div>
                                            <!-- //고양이 -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">생일</div>
                                    <div class="form-item-data type-2">
                                        <div class="grid-layout margin-12">
                                            <div class="grid-layout-inner">
                                                <div class="grid-layout-cell grid-3">
                                                    <select name="pet_year" id="pet_year">
                                                        <?php for ($y = 2000; $y <= (int) date('Y'); $y++) { ?>
                                                            <option value="<?= $y ?>" <?= ($data["pet"]["year"] == $y) ? "selected" : ""; ?>><?= $y ?> 년</option>
                                                        <?php } ?>
                                                    </select>
                                                </div>
                                                <div class="grid-layout-cell grid-3">
                                                    <select name="pet_month" id="pet_month">
                                                        <?php for ($m = 1; $m <= 12; $m++) { ?>
                                                            <option value="<?= $m ?>" <?= ($data["pet"]["month"] == $m) ? "selected" : ""; ?>><?= $m ?> 월</option>
                                                        <?php } ?>
                                                    </select>
                                                </div>
                                                <div class="grid-layout-cell grid-3">
                                                    <select name="pet_day" id="pet_day">
                                                        <?php for ($d = 1; $d <= 31; $d++) { ?>
                                                            <option value="<?= $d ?>" <?= ($data["pet"]["day"] == $d) ? "selected" : ""; ?>><?= $d ?> 일</option>
                                                        <?php } ?>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">성별 선택</div>
                                    <div class="form-item-data type-2">
                                        <div class="grid-layout toggle-button-group">
                                            <div class="grid-layout-inner">
                                                <div class="grid-layout-cell grid-2">
                                                    <label class="form-toggle-box middle" for="gender1">
                                                        <input type="radio" name="pet_gender_m" id="gender1" value="남아" <?= ($data["pet"]["gender"] == "남아") ? "checked" : ""; ?>><em>남아</em>
                                                    </label>
                                                </div>
                                                <div class="grid-layout-cell grid-2">
                                                    <label class="form-toggle-box middle" for="gender2">
                                                        <input type="radio" name="pet_gender_m" id="gender2" value="여아" <?= ($data["pet"]["gender"] == "여아") ? "checked" : ""; ?>><em>여아</em>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label">중성화</div>
                                    <div class="form-item-data type-2">
                                        <div class="grid-layout toggle-button-group">
                                            <div class="grid-layout-inner">
                                                <div class="grid-layout-cell grid-2">
                                                    <label class="form-toggle-box middle" for="neutralize1">
                                                        <input type="radio" name="neutral" id="neutralize1" value="0" <?= ($data["pet"]["neutral"] == "0") ? "checked" : ""; ?>><em>X</em>
                                                    </label>
                                                </div>
                                                <div class="grid-layout-cell grid-2">
                                                    <label class="form-toggle-box middle" for="neutralize2">
                                                        <input type="radio" name="neutral" id="neutralize2" value="1" <?= ($data["pet"]["neutral"] == "1") ? "checked" : ""; ?>><em>O</em>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell middle">
                                <div class="form-group-item">
                                    <div class="form-item-label"><em class="need">*</em>몸무게</div>
                                    <div class="form-item-data type-2">
                                        <div class="form-flex">
                                            <select name="pet_weight1" id="pet_weight1" class="inline-block">
                                                <?
                                                $weight = explode(".", $data["pet"]["weight"]);
                                                for ($i = 0; $i <= 50; $i++) {
                                                    ?>
                                                    <option value="<?= $i ?>" <?= ($weight[0] == $i) ? "selected" : "" ?>><?= $i ?></option>
                                                    <?
                                                }
                                                ?>
                                            </select>
                                            <div class="form-unit-point">.</div>
                                            <select name="pet_weight2" id="pet_weight2" class="inline-block">
                                                <?
                                                for ($i = 0; $i <= 9; $i++) {
                                                    ?>
                                                    <option value="<?= $i ?>" <?= ($weight[1] == $i) ? "selected" : "" ?>><?= $i ?></option>
                                                    <?
                                                }
                                                ?>
                                            </select>
                                            <div class="form-unit-label">kg</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!--이전 특이사항 -->

                        <div class="basic-data-group" id="prev_cmt" style="display:none;">

                            <div class="con-title-group">
                                <h4 class="con-title">이전 특이사항</h4>
                            </div>
                            <div class="special-note-list" id="prev_cmt_list">

                            </div>

                            <div class="basic-data-group vmiddle">
                                <!-- 더보기 활성화시 닫기로 텍스트 변경 필요 -->
                                <button type="button" class="btn btn-middle-size btn-round btn-outline-purple view-special-cmt">더보기</button>
                            </div>

                        </div>

                        <!--이전 미용 정보 -->


                        <div class="basic-data-group" id="prev_beauty_info" style="display:none">
                            <div class="con-title-group">
                                <h4 class="con-title">이전 미용</h4>
                            </div>
                            <div class="memo-item-list" id="prev_beauty_list">

                            </div>
                            <div class="basic-data-group vmiddle">
                                <!-- 더보기 활성화시 닫기로 텍스트 변경 필요 -->
                                <button type="button" class="btn btn-middle-size btn-round btn-outline-purple view-prev-beauty"><?php echo ($tp_cnt>5)?'더보기':'닫기';?></button>
                            </div>
                        </div>

                        <div class="basic-data-group">
                            <div class="con-title-group">
                                <h4 class="con-title">예약 시간</h4>
                            </div>
                            <div class="form-group">
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label">날짜</div>
                                        <div class="form-item-data type-2">
                                            <div class="grid-layout margin-12">
                                                <div class="grid-layout-inner">
                                                    <?$year = (int) date('Y')?>
                                                    <div class="grid-layout-cell grid-3">
                                                        <select name="year">
                                                            <option value="<?php echo substr($workDate,0,4);?>"><?php echo substr($workDate,0,4);?> 년</option>
                                                        </select>
                                                    </div>
                                                    <div class="grid-layout-cell grid-3">
                                                        <select name="month">
                                                            <option value="<?php echo substr($workDate,5,2);?>"><?php echo substr($workDate,5,2);?> 월</option>
                                                        </select>
                                                    </div>
                                                    <div class="grid-layout-cell grid-3">
                                                        <select name="day">
                                                            <option value="<?php echo substr($workDate,8,2);?>"><?php echo substr($workDate,8,2);?> 일</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label">시간</div>
                                        <div class="form-item-data type-2">
                                            <div class="form-datepicker-group">
                                                <div class="form-datepicker">
                                                    <select name="from_time" id="from_time">
                                                        <?php

                                                            // 이전 타임 미용 및 휴무 있는지 확인
                                                            $from_time_sql = "
                                                                SELECT * FROM (
                                                                    SELECT to_hour end_hour, to_minute end_minute FROM tb_payment_log WHERE artist_id = '".$shop_id."'
                                                                    AND worker = '".$_GET['worker']."' AND is_cancel = '0'
                                                                    AND YEAR = ".substr($workDate,0,4)." AND MONTH = ".substr($workDate,5,2)." AND DAY = ".substr($workDate,8,2)."
                                                                    UNION
                                                                    SELECT end_hour, end_minute FROM tb_private_holiday WHERE customer_id = '".$shop_id."'
                                                                    AND worker = '".$_GET['worker']."'
                                                                    AND start_YEAR = ".substr($workDate,0,4)." AND start_MONTH = ".substr($workDate,5,2)." AND start_DAY = ".substr($workDate,8,2)." 
                                                                    AND end_MONTH = ".substr($workDate,5,2)." AND end_DAY = ".substr($workDate,8,2)."
                                                                ) a
                                                                    WHERE time_format(CONCAT(a.end_hour,':',a.end_minute),'%H:%i') <= '".$_GET['workTime']."'
                                                                    ORDER BY time_format(CONCAT(a.end_hour,':',a.end_minute),'%H:%i') DESC
                                                                    LIMIT 1
                                                            ";
                                                            $from_time_result = sql_query($from_time_sql);
                                                            $from_time_row = sql_fetch($from_time_result);
                                                            $from_hour = (count($from_time_row)>0&&$from_time_row['end_hour']<10)?'0'.$from_time_row['end_hour']:$from_time_row['end_hour'];
                                                            $from_minute = (count($from_time_row)>0&&$from_time_row['end_minute']<10)?'0'.$from_time_row['end_minute']:$from_time_row['end_minute'];

                                                            // 뒤 타임 미용 및 휴무 있는지 확인
                                                            $to_time_sql = "
                                                            SELECT * FROM (
                                                                SELECT hour start_hour, minute start_minute FROM tb_payment_log WHERE artist_id = '".$shop_id."'
                                                                AND worker = '".$_GET['worker']."' AND is_cancel = '0'
                                                                AND YEAR = ".substr($workDate,0,4)." AND MONTH = ".substr($workDate,5,2)." AND DAY = ".substr($workDate,8,2)."
                                                                UNION
                                                                SELECT start_hour, start_minute FROM tb_private_holiday WHERE customer_id = '".$shop_id."'
                                                                AND worker = '".$_GET['worker']."'
                                                                AND start_YEAR = ".substr($workDate,0,4)." AND start_MONTH = ".substr($workDate,5,2)." AND start_DAY = ".substr($workDate,8,2)." 
                                                                AND end_MONTH = ".substr($workDate,5,2)." AND end_DAY = ".substr($workDate,8,2)."
                                                            ) a
                                                                WHERE time_format(CONCAT(a.start_hour,':',a.start_minute),'%H:%i') > '".$_GET['workTime']."'
                                                                ORDER BY time_format(CONCAT(a.start_hour,':',a.start_minute),'%H:%i') 
                                                                LIMIT 1
                                                            ";
                                                            $to_time_result = sql_query($to_time_sql);
                                                            $to_time_row = sql_fetch($to_time_result);
                                                            $to_hour = (count($to_time_row)>0&&$to_time_row['start_hour']<10)?'0'.$to_time_row['start_hour']:$to_time_row['start_hour'];
                                                            $to_minute = (count($to_time_row)>0&&$to_time_row['start_minute']<10)?'0'.$to_time_row['start_minute']:$to_time_row['start_minute'];
//echo $from_hour.$from_minute.$to_hour.$to_minute;

                                                            $start_time = ($wt['working_start']<10)?'0'.$wt['working_start']:$wt['working_start'];
                                                            $end_time = ($wt['working_end']<10)?'0'.$wt['working_end']:$wt['working_end'];
                                                            //$start_date = $workDate.' '.$start_time.':00';
                                                            //$end_date = $workDate.' '.$end_time.':00';
                                                            $start_date = ($from_hour)? $workDate.' '.$from_hour.':'.$from_minute : $workDate.' '.$start_time.':00';
                                                            $end_date = ($to_minute)? $workDate.' '.$to_hour.':'.$to_minute : $workDate.' '.$end_time.':00';
                                                            $rev_date = $workDate.' '.$_GET['workTime'].':00';
                                                            for($i=strtotime($start_date);$i<=(strtotime($end_date)-1800);$i+=1800){
                                                        ?>
                                                        <option value="<?php echo $i;?>" <?php echo ($i == strtotime($rev_date))?'selected':''; ?>><?php echo date('H:i',$i);?></option>
                                                        <?php } ?>
                                                    </select>
                                                </div>
                                                <div class="form-unit">~</div>
                                                <div class="form-datepicker">
                                                    <select name="to_time" id="to_time">
                                                        <?php
                                                        //$start_time = ($wt['working_start']<10)?'0'.$wt['working_start']:$wt['working_start'];
                                                        //$end_time = ($wt['working_end']<10)?'0'.$wt['working_end']:$wt['working_end'];
                                                        //$start_date = $workDate.' '.$start_time.':00';
                                                        //$end_date = $workDate.' '.$end_time.':00';
                                                        for($i=(strtotime($start_date)+1800);$i<=strtotime($end_date);$i+=1800){
                                                        ?>
                                                            <option value="<?php echo $i;?>" <?php echo ($i == strtotime($rev_date.' +2 hour'))?'selected':''; ?>><?php echo date('H:i',$i);?></option>
                                                        <?php } ?>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="basic-data-group">
                                <div class="con-title-group" style="justify-content: flex-start;">
                                    <h4 class="con-title">예약금 안내발송</h4>
                                    <label for="switch-toggle" class="form-switch-toggle" style="margin-left:20px;"><input type="checkbox" id="deposit_btn" onclick="deposit_toggle(artist_id); if(this.checked === true){document.getElementById('is_reserve_pay').value = 1;}else{document.getElementById('is_reserve_pay').value=0;}"><span class="bar"></span></label>

                                </div>
                                <div class="form-group" id="deposit_form_1" style="display:none;">
                                    <div class="grid-layout margin-14-17">
                                        <div class="grid-layout-inner">
                                            <div class="grid-layout-cell grid-2">
                                                <div class="form-group-item">
                                                    <div class="form-item-label">예약금</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="form-datepicker-group">
                                                            <div class="form-datepicker">
                                                                <input type="number" name="deposit_input" placeholder="최소 예약금은 1천원" min="0" value="0" class="deposit_input" style="max-width:150px;" id="reserve_deposit_input">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="grid-layout-cell grid-2">
                                                <div class="form-group-item">
                                                    <div class="form-item-label">결제기한 설정</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="form-datepicker-group">
                                                            <div class="form-datepicker">
                                                                <select id="reserve_deposit_time" name="reserve_deposit_time" value="" style="max-width:150px;">
                                                                </select>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        <!-- 쿠폰 시작 -->
                        <div class="basic-data-group" id="coupon_div" style="display: none;">
                            <div class="con-title-group">
                                <h4 class="con-title">보유쿠폰</h4>
                            </div>
                            <div class="form-group">
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label">쿠폰 명</div>
                                        <div class="form-item-data type-2">
                                            <div class="form-control-btns">
                                                <select name="coupon_name" id="coupon_name">
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label">보유</div>
                                        <div class="form-item-data type-2">
                                            <div class="form-control-btns">
                                                <select name="coupon_balance" id="coupon_balance">
                                                    <option value="">선택</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label">쿠폰 차감</div>
                                        <div class="form-item-data type-2">
                                            <div class="form-control-btns">
                                                <select name="use_coupon" id="use_coupon">
                                                </select>
                                                <button type="button" class="btn btn-90 btn-outline-gray btn-round btn-inline use-coupon">적용</button>
                                            </div>
                                        </div>
                                        <div class="form-item-data type-7">
                                            <div class="btn btn-gray btn-round"><strong class="font-color-purple">적용 후 잔액 <span id="remind_coupon">0</span></strong></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 미용서비스 시작 -->
                            <!-- 강아지 일경우 서비스 시작 -->
                        <div class="basic-data-group is_dog" style="display:<?php echo ($data["pet"]['type']=='dog')?'block':'none';?>">
                            <div class="con-title-group">
                                <h4 class="con-title">예약 서비스 및 추가 특이사항 입력</h4>
                            </div>
                            <ul class="accordion-list last-none-line small">
                                <li class="accordion-cell disabled">
                                    <button type="button" class="btn-accordion-menu">
                                    <span class="accordion-menu-subject">
                                        <h5 class="con-title">기본 서비스 선택</h5>
                                    </span>
                                    </button>
                                    <div class="accordion-content">
                                        <div class="form-group">
                                                <div class="form-group-cell middle grid-5-add">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">크기</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner flex-dir" id="serviceType">
                                                                    <div class="grid-layout-cell font-size-12">
                                                                        <label class="form-toggle-box middle" for="size1">
                                                                            <input type="radio" name="size" id="size1" value="" checked>
                                                                            <em>선택안함</em>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group-cell middle grid-5-add">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">서비스</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner flex-dir" id="service_list">
                                                                    <div class="grid-layout-cell">
                                                                        <label class="form-toggle-box middle" for="service1" id="service">
                                                                            <input type="radio" name="service" id="service1" class="service-type" value="" checked>
                                                                            <em>선택안함</em>
                                                                        </label>
                                                                    </div>
                                                                    <?php

                                                                    $cnt = $disp_cnt = 0;
                                                                    $dog_product_title = array();
                                                                    $option_name = array('bath_price','part_price','bath_part_price','sanitation_price','sanitation_bath_price','all_price','spoting_price','scissors_price','summercut_price');
                                                                    $dog_product_arr = array(
                                                                        "무게",
                                                                        "목욕",
                                                                        "부분미용",
                                                                        "부분+목욕",
                                                                        "위생",
                                                                        "위생+목욕",
                                                                        "전체미용",
                                                                        "스포팅",
                                                                        "가위컷",
                                                                        "썸머컷"
                                                                    );
                                                                    $dog_product_seq = array(
                                                                        "목욕"         =>'bath',
                                                                        "부분미용"      =>'part',
                                                                        "부분+목욕"     =>'bath_part',
                                                                        "위생"         =>'sanitation',
                                                                        "위생+목욕"    =>'sanitation_bath',
                                                                        "전체미용"     =>'all',
                                                                        "스포팅"      =>'spoting',
                                                                        "가위컷"      =>'scissors',
                                                                        "썸머컷"       =>'summercut'
                                                                    );
                                                                    $beauty = 1;
                                                                    $productWorkTimeTitle = array("목욕", "부분미용", "부분+목욕", "위생", "위생+목욕","전체미용", "스포팅", "가위컷", "썸머컷");
                                                                    $que = "SELECT * FROM tb_product_dog_worktime WHERE artist_id = '{$user_id}' ";
                                                                    $res = sql_query($que);
                                                                    $rows = sql_fetch($res);
                                                                    for($i=0;$i<14;$i++){
                                                                        if(!empty($rows['worktime'.$i.'_disp_yn'] == 'y')){
                                                                            if($i<10){
                                                                                array_push($dog_product_title, $dog_product_arr[$i]);
                                                                            } else {
                                                                                if(!empty($rows['worktime'.$i.'_title'])) {
                                                                                    $dog_product_seq[$rows['worktime' . $i . '_title']] = 'beauty' . $beauty;
                                                                                    $option_name[] = 'beauty' . $beauty . "_price";
                                                                                    array_push($dog_product_title, $rows['worktime' . ($i+1) . '_title']);
                                                                                    $beauty++;
                                                                                }
                                                                            }
                                                                        }
                                                                        //print_r($dog_product_title);
                                                                        if($i<9) {

                                                                            if ($rows['worktime' . ($i + 1) . '_disp_yn'] == 'y' && !empty($rows['worktime' . ($i + 1)]) && !empty($productWorkTimeTitle[$i])) {
                                                                                $worktime['title'][] = $productWorkTimeTitle[$i];
                                                                                $worktime['time'][] = $rows['worktime' . ($i + 1)];
                                                                            }
                                                                        } else if($i>8){
                                                                            if ($rows['worktime' . ($i + 1) . '_disp_yn'] == 'y' && !empty($rows['worktime' . ($i + 1).'_title']) ) {
                                                                                $worktime['title'][] = $rows['worktime' . ($i + 1).'_title'];
                                                                                $worktime['time'][] = $rows['worktime' . ($i + 1)];
                                                                            }
                                                                        }
                                                                    }

                                                                    for($i=0;$i<count($worktime['title']);$i++){
                                                                        $que_main = "SELECT * FROM tb_product_dog_static
                                                                        WHERE customer_id = '{$user_id}' AND first_type = '개' AND (second_type = '{$beauty_info[3]}' OR direct_title = '{$beauty_info[3]}')
                                                                        AND ".$dog_product_seq[$worktime['title'][$i]]."_price != ''
                                                                    ";

                                                                        //echo $que;
                                                                        $res_main = sql_query($que_main);
                                                                        $row_main = sql_fetch($res_main);
                                                                        if(count($row_main)>0){
                                                                            ?>
                                                                            <div class="grid-layout-cell">
                                                                                <label class="form-toggle-box middle" for="service2">
                                                                                    <input type="radio" name="service" class="service-type" value="<?php echo $dog_product_seq[$worktime['title'][$i]],'_price';?>" data-time="<?php echo strtotime($rev_date.' +'.$worktime['time'][$i].' minute');?>"><em><?php echo $worktime['title'][$i];?> <?php echo $worktime['time'][$i];?>분</em>
                                                                                </label>
                                                                            </div>
                                                                        <?php }} ?>


                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group-cell middle grid-5-add">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">무게</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner flex-dir" id="kgs_list">
                                                                    <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1"><input type="radio" name="weight" id="weight1" value=":0" checked><em><span>선택안함</span><strong>0원</strong></em></label></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <?php
                                                $sql = "
                                            SELECT * 
                                            FROM tb_product_dog_common
                                            WHERE customer_id = '".$user_id."'
                                        ";
                                                $sql;
                                                $result = mysqli_query($connection, $sql);
                                                while($row = mysqli_fetch_assoc($result)){
                                                    $data["product_dog_common"][] = $row;
                                                }
                                                ?>

                                            <?php
                                            $sql_option = "
                                                SELECT *
                                                FROM tb_product_common_option
                                                WHERE customer_id = '".$user_id."'
                                            ";
                                            $result_option = mysqli_query($connection, $sql_option);
                                            while($row_option = mysqli_fetch_assoc($result_option)){
                                                $data["bath_option_list"][] = $row_option;
                                            }
                                            if($data["product_dog_common"][0]['short_hair_price']>0 || $data["product_dog_common"][0]['long_hair_price']>0 || $data["product_dog_common"][0]['double_hair_price'] || count($data['bath_option_list']) > 0){
                                                ?>
                                                <div class="form-group-cell middle grid-5-add">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">털특징</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner flex-dir">

                                                                    <?php if($data["product_dog_common"][0]['short_hair_price']>0){ ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="hair_type[]" class="extra-hair_type" value="단모_목욕:<?php echo $data["product_dog_common"][0]['short_hair_price'];?>" id="leg1"><em><span>단모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['short_hair_price']);?>원</strong></em></label></div>
                                                                    <?php } ?>
                                                                    <?php if($data["product_dog_common"][0]['long_hair_price']>0){ ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="hair_type[]" class="extra-hair_type" value="장모_목욕:<?php echo $data["product_dog_common"][0]['long_hair_price'];?>" id="leg1"><em><span>장모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['long_hair_price']);?>원</strong></em></label></div>
                                                                    <?php } ?>
                                                                    <?php if($data["product_dog_common"][0]['double_hair_price']>0){ ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="hair_type[]" class="extra-hair_type" value="이중모_목욕:<?php echo $data["product_dog_common"][0]['double_hair_price'];?>" id="leg1"><em><span>이중모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['double_hair_price']);?>원</strong></em></label></div>
                                                                    <?php } ?>
                                                                    <?php
                                                                    /*$sql_option = "
                                                                                SELECT *
                                                                                FROM tb_product_common_option
                                                                                WHERE customer_id = '".$user_id."'
                                                                            ";
                                                                    $result_option = mysqli_query($connection, $sql_option);
                                                                    while($row_option = mysqli_fetch_assoc($result_option)){
                                                                        $data["bath_option_list"][] = $row_option;
                                                                    }*/
                                                                    if(count($data['bath_option_list']) > 0){
                                                                        for($i=0;$i<count($data['bath_option_list']);$i++){
                                                                            ?>
                                                                            <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                                    <input type="checkbox" name="hair_type[]" class="extra-hair-type" value="<?php echo $data['bath_option_list'][$i]['title'];?>:<?php echo $data['bath_option_list'][$i]['price'];?>" id="leg1"><em><span><?php echo $data['bath_option_list'][$i]['title'];?></span><strong>+<?php echo number_format($data['bath_option_list'][$i]['price']);?>원</strong></em></label></div>
                                                                        <?php }} ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            <?php } ?>
                                                <?php
                                                if($data["product_dog_common"][0]['beauty_length_1']>0 || $data["product_dog_common"][0]['beauty_length_2']>0 || $data["product_dog_common"][0]['beauty_length_3']>0 || $data["product_dog_common"][0]['beauty_length_4']>0 || $data["product_dog_common"][0]['beauty_length_5']>0){
                                                    ?>
                                                <div class="form-group-cell middle grid-5-add">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">털길이</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner flex-dir">
                                                                    <?php
                                                                    for($i=1; $i<=5; $i++){
                                                                    if($data["product_dog_common"][0]['beauty_length_'.$i]){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="radio" name="hair_length" id="leg1" class="extra-hair-length" value="<?php echo $data["product_dog_common"][0]['beauty_length_'.$i];?>:<?php echo $data["product_dog_common"][0]['beauty_length_'.$i.'_price'];?>">
                                                                            <em><span><?php echo $data["product_dog_common"][0]['beauty_length_'.$i];?>mm</span><strong>+<?php echo number_format($data["product_dog_common"][0]['beauty_length_'.$i.'_price']);?>원</strong></em>
                                                                        </label>
                                                                    </div>
                                                                    <?php
                                                                    }
                                                                    }
                                                                    $face = split_text($data["product_dog_common"][0]['hair_length_product']);
                                                                    if(count($face)>0){
                                                                    for($i=0;$i<count($face['name']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="radio" name="hair_length" id="leg1" class="extra-hair-length" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>">
                                                                            <em><span><?php echo $face['name'][$i];?>mm</span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em>
                                                                        </label>
                                                                    </div>
                                                                    <?php
                                                                    }
                                                                    }
                                                                    ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <?php } ?>

                                        </div>
                                    </div>
                                </li>
                                <?php
                                $sql = "
                                            SELECT * 
                                            FROM tb_product_dog_common
                                            WHERE customer_id = '".$user_id."'
                                        ";
                                $sql;
                                $result = mysqli_query($connection, $sql);
                                while($row = mysqli_fetch_assoc($result)){
                                    $data["product_dog_common"][] = $row;
                                }
                                ?>
                                <li class="accordion-cell" style=clear:left; >
                                    <button type="button" class="btn-accordion-menu">
                                    <span class="accordion-menu-subject">
                                        <h5 class="con-title">추가 서비스 선택 (선택)</h5>
                                    </span>
                                    </button>
                                    <div class="accordion-content">
                                        <div class="form-group">
                                            <?php
                                                if($data["product_dog_common"][0]['basic_face_price'] > 0 || $data["product_dog_common"][0]['broccoli_price'] > 0 || $data["product_dog_common"][0]['highba_price'] > 0 || $data["product_dog_common"][0]['bear_price'] > 0 ) {
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">얼굴컷</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="radio" name="face" id="face0" value="" class="extra-face" checked><em><span>선택안함</span><strong>+0원</strong></em></label></div>
                                                                <?php if($data["product_dog_common"][0]['basic_face_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face1"><input type="radio" name="face" id="face1" value="기본얼굴컷:<?php echo $data["product_dog_common"][0]['basic_face_price'];?>" class="extra-face"><em><span>기본얼굴컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['basic_face_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['broccoli_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face2"><input type="radio" name="face" id="face2" value="브로콜리컷:<?php echo $data["product_dog_common"][0]['broccoli_price'];?>" class="extra-face"><em><span>브로콜리컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['broccoli_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['highba_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face3"><input type="radio" name="face" id="face3" value="하이바컷:<?php echo $data["product_dog_common"][0]['highba_price'];?>" class="extra-face"><em><span>하이바컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['highba_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['bear_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face4"><input type="radio" name="face" id="face4" value="곰돌이컷:<?php echo $data["product_dog_common"][0]['bear_price'];?>" class="extra-face"><em><span>곰돌이컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['bear_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php
                                                                $face = split_text($data["product_dog_common"][0]['addition_face_product']);
                                                                if($face['name']>0){
                                                                    for($i=0;$i<count($face['name']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face5"><input type="radio" name="face" id="face5" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                    <?php 
                                                                    }
                                                                }
                                                                ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } ?>
                                            <div class="form-group-cell middle grid-5-add">
                                            <?php
                                                $face = split_text($data["product_dog_common"][0]['addition_option_product']);
                                                if((count($face)>0 && !empty($face['name'][0])) || $data["product_dog_common"][0]['toenail_price'] != '' || $data["product_dog_common"][0]['trumpet_etc_price'] != '' || $data["product_dog_common"][0]['bell_price'] != ''){
                                            ?>
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">다리</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php if($data["product_dog_common"][0]['toenail_price'] != ''){ ?>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="leg[]" class="extra-leg" value="발톱:<?php echo $data["product_dog_common"][0]['toenail_price'];?>" id="leg1"><em><span>발톱</span><strong>+<?php echo number_format($data["product_dog_common"][0]['toenail_price']);?>원</strong></em></label></div>
                                                        <?php } ?>
                                                        <?php if($data["product_dog_common"][0]['trumpet_etc_price'] != ''){ ?>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg2"><input type="checkbox" name="leg[]" class="extra-leg" value="장화:<?php echo $data["product_dog_common"][0]['trumpet_etc_price'];?>" id="leg2"><em><span>장화</span><strong>+<?php echo number_format($data["product_dog_common"][0]['trumpet_etc_price']);?>원</strong></em></label></div>
                                                        <?php } ?>
                                                        <?php if($data["product_dog_common"][0]['bell_price'] != ''){ ?>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg3"><input type="checkbox" name="leg[]" class="extra-leg" value="방울:<?php echo $data["product_dog_common"][0]['bell_price'];?>" id="leg3"><em><span>방울</span><strong>+<?php echo number_format($data["product_dog_common"][0]['bell_price']);?>원</strong></em></label></div>
                                                        <?php } ?>
                                                                <?php
                                                                $face = split_text($data["product_dog_common"][0]['addition_option_product']);
                                                                if(count($face)>0 && !empty($face['name'][0])){
                                                                for($i=0;$i<count($face['name']);$i++){
                                                                    ?>

                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="leg[]" class="extra-leg" id="leg1" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php }} ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                            <?php
                                                $face = split_text($data["product_dog_common"][0]['spa_option_product']);
                                                if(count($face)>0 && !empty($face['name'][0])){
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">스파</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                for($i=0;$i<count($face['name']);$i++){
                                                                    ?>

                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="spa[]" class="extra-spa" id="leg1" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } ?>
                                            <?php
                                                $face = split_text($data["product_dog_common"][0]['dyeing_option_product']);
                                                if(count($face)>0 && !empty($face['name'][0])){
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">염색</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                for($i=0;$i<count($face['name']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="color[]" class="extra-color" id="color2" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } ?>
                                            <?php
                                                $face = split_text($data["product_dog_common"][0]['etc_option_product']);
                                                if(count($face)>0 && !empty($face['name'][0])){
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">기타</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                for($i=0;$i<count($face['name']);$i++){
                                                                ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="etc[]" class="extra-etc" id="color2" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } ?>
                                        </div>

                                    </div>
                                </li>
                            </ul>
                        </div>
                        <!-- 강아지 일경우 서비스 끝 -->
                        <!-- 고양이 일경우 서비스 시작 -->
                        <div class="basic-data-group is_cat" style="display:<?php echo ($data["pet"]['type']=='cat')?'block':'none';?>">
                            <?php
                                $que = "SELECT * FROM tb_product_cat WHERE customer_id = '{$user_id}'";
                                //echo $que;
                                $res1 = sql_query($que);
                                $cat = sql_fetch($res1);
                            ?>
                            <div class="con-title-group">
                                <h4 class="con-title">예약 서비스 및 추가 특이사항 입력</h4>
                            </div>
                            <ul class="accordion-list last-none-line small">
                                <li class="accordion-cell disabled">
                                    <button type="button" class="btn-accordion-menu">
                                <span class="accordion-menu-subject">
                                    <h5 class="con-title">기본 서비스 선택</h5>
                                </span>
                                    </button>
                                    <div class="accordion-content">
                                        <div class="form-group">

                                            <?php
                                                if($cat['is_use_weight']==1){
                                                    $cat_sec = explode(",",$cat['section']);
                                            ?>
                                            <div class="form-group-cell middle grid-3-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">무게</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir" id="kgs_list_cat">
                                                                <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                        <input type="radio" name="cat_weight" class="cw" value=""  checked>
                                                                        <em><span>선택안함</span><strong>0원</strong></em></label>
                                                                </div>
                                                                <?php for($x=0;$x<count($cat_sec);$x++){ ?>
                                                                <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                        <input type="radio" name="cat_weight" class="cw"  onclick="cat_show_view(<?php echo $x;?>);" value="<?php echo $cat_sec[$x];?>">
                                                                        <em><span></span><strong><?php echo $cat_sec[$x];?>kg</strong></em></label>
                                                                </div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group-cell middle grid-3-add" >
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">미용</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                        <input type="radio" name="hair_kg" class="cat-hair-price " checked  value="">
                                                                        <em><span></span><strong>사용안함</strong></em></label>
                                                                </div>
                                                                <?php for($x=0;$x<count($cat_sec);$x++){ ?>
                                                                <div class="grid-layout-cell cat-weight kg_<?php echo $x;?>" style="display:none;"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                        <input type="radio" name="hair_kg" class="cat-hair-price " data-cat_hair="단모" value="단모:<?php echo ($cat['short_price']+($cat['increase_section_price']*$x));?>"><em><span>단모</span><strong><?php echo number_format($cat['short_price']+($cat['increase_section_price']*$x));?>원</strong></em></label></div>
                                                                <div class="grid-layout-cell cat-weight kg_<?php echo $x;?>" style="display:none;"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                        <input type="radio" name="hair_kg" class="cat-hair-price " data-cat_hair="장모" value="장모:<?php echo ($cat['long_price']+($cat['increase_section_price']*$x));?>"><em><span>장모</span><strong><?php echo number_format($cat['long_price']+($cat['increase_section_price']*$x));?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } else { ?>
                                            <input type="hidden" name="cat_weight" value="all">
                                            <!-- 고양이 선택시 -->
                                            <div class="form-group-cell middle grid-3-add" >
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">미용</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">

                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                        <input type="radio" name="hair_kg" value="<?php echo "단모:".$cat['short_price'];?>" data-cat_hair="단모" class="cat-hair-price"><em><span>단모_미용</span><strong>+<?php echo number_format($cat['short_price']);?>원</strong></em></label></div>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hair2">
                                                                        <input type="radio" name="hair_kg" value="<?php echo "장모:".$cat['long_price'];?>" data-cat_hair="장모" class="cat-hair-price"><em><span>장모_미용</span><strong>+<?php echo number_format($cat['long_price']);?>원</strong></em></label></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <?php } ?>
                                            <div class="form-group-cell middle grid-3-add" >
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">목욕</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="" checked ><em><span>선택안함</span><strong>0원</strong></em></label></div>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="단모"  value="<?php echo "단모:".$cat['shower_price'];?>"><em><span>단모</span><strong><?php echo number_format($cat['shower_price']);?>원</strong></em></label></div>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="장모"  value="<?php echo "장모:".$cat['shower_price_long'];?>"><em><span>장모</span><strong><?php echo number_format($cat['shower_price_long']);?>원</strong></em></label></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <li class="accordion-cell">
                                    <button type="button" class="btn-accordion-menu">
                                <span class="accordion-menu-subject">
                                    <h5 class="con-title">추가 서비스 선택 (선택)</h5>
                                </span>
                                    </button>
                                    <div class="accordion-content">
                                        <div class="form-group">

                                                <div class="form-group-cell middle">
                                                    <div class="form-group-item">
                                                        <div class="form-item-label01">추가서비스</div>
                                                        <div class="form-item-data type-2">
                                                            <div class="grid-layout toggle-button-group">
                                                                <div class="grid-layout-inner">
                                                                    <div class="grid-layout-cell grid-2"><label class="form-toggle-box form-toggle-price middle" for="face1">
                                                                            <input type="checkbox" class="cat-etc" name="cat_toenail" value="<?php echo $cat['toenail_price'];?>" class="extra-face"><em><span>발톱</span><strong>+<?php echo number_format($cat['toenail_price']);?>원</strong></em></label></div>

                                                                    <?php
                                                                    $face = split_text($cat['addition_option_product']);
                                                                    for($i=0;$i<count($face['name']);$i++){
                                                                        ?>
                                                                        <div class="grid-layout-cell grid-2"><label class="form-toggle-box form-toggle-price middle" for="face5">
                                                                                <input type="checkbox" name="cat_etc[]" class="cat-etc" value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>">
                                                                                <em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label>
                                                                        </div>
                                                                    <?php } ?>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            
                                        </div>

                                    </div>
                                </li>
                            </ul>
                        </div>
                        <!-- 고양이 일경우 서비스 끝 -->
                        <div class="basic-data-group vmiddle ">
                            <div class="service-selected-wrap">
                                <div class="service-selected-group">
                                    <h5 class="con-title">서비스 선택 내역</h5>
                                    <div class="service-selected-list" id="choose_area">
                                        <!--<div class="service-selected-list-cell">
                                            <div class="list-data">소형견 미용</div>
                                        </div>-->

                                    </div>
                                </div>
                                <div class="service-selected-group add">
                                    <h5 class="con-title">추가 선택 내역</h5>
                                    <div class="service-selected-list" id="extra_choose_area">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- //reserve-accept-wrap -->
                </div>
                <!-- //page-body -->
                </div>
            </div>
            <!-- page-bottom -->

            <!-- //page-bottom -->
            <div class="page-bottom">
                <div class="grid-layout btn-grid-group">
                    <div class="grid-layout-inner">
                        <div class="grid-layout-cell grid-2"><a href="javascript:;" class="btn btn-outline-purple btn-middle-size btn-round reserve_regist_btn" id="reserve_regist_1">알림없이 등록</a></div>
                        <div class="grid-layout-cell grid-2"><a href="javascript:;" class="btn btn-outline-purple btn-middle-size btn-round reserve_regist_btn" id="reserve_regist_2">등록</a></div>
                    </div>
                </div>
            </div>



        <!-- 알림없이 등록 팝업 -->
        <article id="reserveCalendarPop2" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">미용 예약 하루 전 알림은 발송 하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-reserv-block" onclick="confirm_send_reserv('Y');">발송</button>
                            <button type="button" class="btn btn-confirm btn-reserv-send" onclick="confirm_send_reserv('N');">미발송</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>


        <!-- 알림없이 등록 팝업 -->
        <article id="reserveCalendarPop99" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">입력된 정보가 저장되지 않을 수 있습니다.<br><br>이동하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm mv-url" onclick="">확인</button>
                            <button type="button" class="btn btn-confirm " onclick="popalert.close();">취소</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <!-- 알림없이 등록 팝업 -->
        <article id="reserveCalendarPop98" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">입력된 정보가 저장되지 않을 수 있습니다.<br><br>이동하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm mv-url" onclick="popalert.close();">확인</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>


        <article id="deposit_confirm" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">먼저 예약금 설정을 해주세요. <br> 지금 설정하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-cf" onclick="pop.open('deposit_set'); pop.close('deposit_confirm')">확인</button>
                            <button type="button" class="btn btn-confirm btn-cc" onclick="document.getElementById('deposit_btn').checked = false; pop.close();">취소</button>

                        </div>
                    </div>

                </div>
            </div>
        </article>


        <article id="deposit_set" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data middle" >
                        <div class="pop-body" style="flex-direction: row">

                            <div class="set-save-money"  id="shop_reserve">
                                <div class="basic-data-group">
                                    <div class="con-title-group">
                                        <h4 class="con-title">예약금</h4>
                                    </div>
                                    <div class="form-group vmiddle">
                                        <div class="form-group-cell middle">
                                            <div class="form-group-item">
                                                <div class="form-item-data type-2" style="margin-top:0px; padding-top:0px;">
                                                    <div class="form-item-data type-2" style="margin-top:0px; padding-top:0px; display: flex; align-items: center;">
                                                        <input type="number" placeholder="최소 예약금은 1천원" min="0" id="deposit_input"><label style="margin-left:10px;"></label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="basic-data-group" style="margin-top:20px;">
                                    <div class="con-title-group">
                                        <h4 class="con-title">결제기한 설정</h4>
                                    </div>
                                    <div class="basic-data-group vvsmall2">
                                        <div class="form-group-item">
                                            <div class="form-item-data type-2" style="margin-top:0px; padding-top:0px;">
                                                <select class="percent" id="deposit_time">
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="basic-data-group" style="margin-top:20px;">
                                    <div class="con-title-group">
                                        <h4 class="con-title">계좌입력</h4>
                                    </div>
                                    <div class="basic-data-group vvsmall2">
                                        <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center">
                                            <label style="margin-right:20px; min-width:80px;">은행명</label>
                                            <select class="percent" name="deposit_bank" id="deposit_bank">

                                            </select>


                                        </div>
                                        <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center">

                                            <label style="margin-right:20px; min-width:80px">계좌번호</label>
                                            <input type="text" placeholder='" - " 포함'  type="number" name="deposit_bank_account" min="0" id="deposit_bank_account">

                                        </div>
                                    </div>
                                </div>
                                <div class="basic-data-group" style="margin-top:20px;">
                                    <div class="con-title-group">
                                        <h4 class="con-title">예약금 결제관리</h4>
                                    </div>
                                    <div class="basic-data-group vvsmall2">
                                        <div class="form-group-item">
                                            <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center; justify-content: space-between">

                                                <span>수동</span><label for="switch-toggle" class="form-switch-toggle"><input type="checkbox" checked onclick="return false;"><span class="bar"></span></label>
                                            </div>
                                            <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center; justify-content: space-between">

                                                <span>자동</span><label for="switch-toggle" class="form-switch-toggle"><input type="checkbox" onclick="event.preventDefault(); document.getElementById('msg1_txt').innerText = '열심히 오픈 준비중입니다. \n 조금만 기다려 주세요.'; pop.open('reserveAcceptMsg1') "><span class="bar"></span></label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" style="background:#fdd94e;" onclick="deposit_save(artist_id); document.getElementById('deposit_set').classList.remove('actived'); document.getElementById('deposit_confirm').classList.remove('actived'); document.getElementById('deposit_btn').checked = false;">저장</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <article id="reserveAcceptMsg1" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt" id="msg1_txt"></div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="pop.close(); pop.close('reserveCalendarPop11')">확인</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        <article id="reserveCalendarPop11" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="toggle-wrap">
                                <div class="msg-txt">예약접수 알림</div>
                                <label for="switch-toggle" class="form-switch-toggle" style="margin-left:5px; margin-right:10px;"><input type="checkbox" id="notice_check" onclick="if(this.checked===true){document.getElementById('notice_check_span').innerText = '발송'; document.getElementById('alarm_yn').value = 'Y';}else{document.getElementById('notice_check_span').innerText ='미발송';document.getElementById('alarm_yn').value = 'N'}"><span class="bar"></span></label>
                                <span  class="notice_span" id="notice_check_span">미발송</span>

                            </div>
                            <div class="toggle-wrap" id="deposit_notice" style="display:none;">
                                <div class="msg-txt">예약금 안내</div>
                                <label for="switch-toggle" class="form-switch-toggle" style="margin-left:20px; margin-right:10px;"><input type="checkbox" checked id="deposit_check"  onclick="if(this.checked===true){document.getElementById('deposit_check_span').innerText = '발송'; document.getElementById('deposit_check_').value ='Y'}else{document.getElementById('deposit_check_span').innerText ='미발송'; document.getElementById('deposit_check_').value ='N'} "><span class="bar"></span></label>
                                <span class="notice_span" id="deposit_check_span">발송</span>
                            </div>
                            <div class="toggle-wrap">
                                <div class="msg-txt">하루전 알림</div>
                                <label for="switch-toggle" class="form-switch-toggle" style="margin-left:20px; margin-right:10px;"><input type="checkbox" checked id="yesterday_check" onclick="if(this.checked===true){document.getElementById('yesterday_check_span').innerText = '발송'; document.getElementById('befor_day_alarm_yn').value ='Y'}else{document.getElementById('yesterday_check_span').innerText ='미발송'; document.getElementById('befor_day_alarm_yn').value = 'N'}"><span class="bar"></span></label>
                                <span  class="notice_span" id="yesterday_check_span">발송</span>
                            </div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-reserv-block" onclick="confirm_send_reserv()">확인</button>
                            <button type="button" class="btn btn-confirm btn-reserv-send" onclick="pop.close()">취소</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>
        </form>
    </section>


    <!-- //container -->
    <script src="/static/pub/js/dev_common.js"></script>
    <script>

        let artist_id = `<?=$shop_id?>`
        for(let i=30; i<=1440; i+=30){
            document.getElementById('reserve_deposit_time').innerHTML += `<option value=${i}>${minutes_to_hour(i)} 이내</option>`
        }

        for(let i=30; i<=1440; i+=30){
            document.getElementById('deposit_time').innerHTML += `<option value=${i}>${minutes_to_hour(i)} 이내</option>`
        }
        bank_names.forEach(function(el){

            document.getElementById('deposit_bank').innerHTML += `<option value="${el.name}" data-code="${el.code}">${el.name}</option>`
        })

        // 고양이 미용 선택 선택시 선택해제(완전 래퍼)
        var beforeChecked = -1;
        $("input[name='hair']").click(function(){
            // 블로그 인용
            var index = $(this).parent().index("label");
            if(beforeChecked == index) {
                beforeChecked = -1;
                $(this).prop("checked", false);
            }else{
                beforeChecked = index;
            }
        });

        //펫 이름 선택시
        $(document).on('click','.pet-no',function(){
            var no = $(this).data('no');
            if(!no){
                alert('펫 정보가 없습니다. 새로 고칭 후 이용해주세요.');
                return false;
            }
            get_pet_info(no);

        });

        var keep_going = true;
        function confirm_send_reserv(){
            pop.close();
            if(keep_going == true){
                document.f.submit();
                keep_going = false;
            }

        }

        //펫정보
        function get_pet_info(no){

            $.ajax({
                type : 'post',
                url : './data/get_pet_info.php',
                data : {'mode':'petInfo','no':no,'cellphone':'<?php echo $cellPhone;?>'},
                dataType : 'json',
                success : function(json){
                    if(json.result['flag'] == true){
                        var kg = json.data['weight'].split('.');
                        $('#pet_name').val(json.data['name']);
                        $('#pet_type').val(json.data['pet_type']);

                        if(json.data['type']=='dog'){
                            $('#breed1').prop('checked',true);
                            $('#pet_type_dog').val(json.data['pet_type']);
                            $('#is_cat, .is_cat').css('display','none');
                            $('#is_dog, .is_dog').css('display','block');
                            $('#pet_type_cat').prop('disabled',true);
                            $('#pet_type_dog').prop('disabled',false);
                        } else {
                            $('#breed2').prop('checked',true);
                            $('#pet_type_cat').val(json.data['pet_type']);
                            $('#is_cat, .is_cat').css('display','block');
                            $('#is_dog, .is_dog').css('display','none');
                            $('#pet_type_cat').prop('disabled',false);
                            $('#pet_type_dog').prop('disabled',true);
                        }

                        $('#pet_year').val(json.data['year']);
                        $('#pet_month').val(json.data['month']);
                        $('#pet_day').val(json.data['day']);

                        if(json.data['gender']=='남아'){
                            $('#gender1').prop('checked',true);
                        } else {
                            $('#gender2').prop('checked',true);
                        }

                        if(json.data['neutral']==0){
                            $('#neutralize1').prop('checked',true);
                        } else {
                            $('#neutralize2').prop('checked',true);
                        }

                        $('#pet_weight1').val(kg[0]);
                        $('#pet_weight2').val(kg[1]);

                        get_prev_info(no);
                        /*if(json.beauty != ''){
                            $('#prev_beauty_info').empty().append(json.beauty).css('display','block');
                        } else {
                            $('#prev_beauty_info').empty().css('display','none');
                        }*/

                        $('#customer_id').val(json.data['customer_id']);
                        get_coupon($('#customer_id').val());
                        //품종 타입별 크기선택 불러오기
                        get_type_load(json.data['type']);
                        make_beauty_chk();
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //이전 미용 및 특이사항
        function get_prev_info(pet_no){
            var phone = '<?php echo $_GET['cellPhone'];?>';
            var html = '';
            var html1 = '';
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax.php',
                data : {'mode':'getPrevInfo','pet':pet_no,'cellphone':phone},
                dataType : 'json',
                success : function(json){
                    if(json.memo.total>0) {
                        if (json.memo.total > 5) {
                            $('.view-special-cmt').text('더보기').css('display', 'block');
                        } else {
                            $('.view-special-cmt').text('더보기').css('display', 'none');
                        }
                        for (var i = 0; i < json.memo.total; i++) {
                            html += `
                                <div class="special-note special-cmt" style="display:`;
                            if (i > 4) {
                                html += `none`;
                            } else {
                                html += `block`;
                            }
                            html += `">            <div class="note-desc"><em>` + json.memo.date[i] + `</em><div class="txt">` + json.memo.memo[i] + `</div></div>
                                    </div>
                                `;
                        }

                        $('#prev_cmt_list').empty().append(html)
                        $('#prev_cmt').css('display','block');
                    } else {
                        $('#prev_cmt').css('display','none');
                    }



                    if(json.beauty.total>0) {
                        if (json.beauty.total > 5) {
                            $('.view-prev-beauty').text('더보기').css('display', 'block');
                        } else {
                            $('.view-prev-beauty').text('더보기').css('display', 'none');
                        }
                        for (var i = 0; i < json.beauty.total; i++) {

                            html1 += `
                                 <div class="memo-item" style="display:`;
                            if (i > 4) {
                                html1 += `none`;
                            } else {
                                html1 += `block`;
                            }
                            html1 += `">`+json.beauty.info[i];
                            html1 += `<div class="memo-link"><a href="reserve_pay_management_2?payment_log_seq=`+json.beauty.pay[i]+`&history_back=1" class="btn-memo-link">상세보기<div class="icon icon-arrow-right-small"></div></a></div></div>`;
                        }

                        $('#prev_beauty_list').empty().append(html1)
                        $('#prev_beauty_info').css('display','block');
                    } else {
                        $('#prev_beauty_info').css('display','none');
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //쿠폰 정보 구하기

        function get_coupon(cusid){
            make_beauty_chk();
        }


        //쿠폰 선택시
        $('#coupon_name').change(function(){
            var cid = $(this).val();
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax.php',
                data : {'mode':'getCouponBalance','cid':cid},
                dataType : 'json',
                success : function(json){
                    console.log(json)
                    if(json.flag == true){
                        $('#coupon_balance').empty().append(json.select_name);
                        $('#use_coupon').empty().append(json.select_use);
                        make_beauty_chk();
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        });

        //쿠폰사용
        $(document).on('click','.use-coupon',function(){
            var cnt = $('#use_coupon option:selected').val();
            var cid = $('#coupon_name option:selected').val();
            if(!cnt){
                popalert.open('reserveCalendarPop98','쿠폰차감 횟수를 선택해주세요.');
                return false;
            }
             if(confirm('쿠폰을 사용하시겠습니까?')){
                 $.ajax({
                     type : 'post',
                     url : './data/get_book_data_ajax.php',
                     data : {'mode':'useCoupon','cid':cid,'cnt':cnt},
                     dataType : 'json',
                     success : function(json){
                         console.log(json)
                         if(json.flag == true){
                             var cid = json.cid;
                             $.ajax({
                                 type : 'post',
                                 url : './data/get_book_data_ajax.php',
                                 data : {'mode':'getCouponBalance','cid':cid},
                                 dataType : 'json',
                                 success : function(json){
                                     if(json.flag == true){
                                         $('#coupon_balance').empty().append(json.select_name);
                                         $('#use_coupon').empty().append(json.select_use);
                                         $('#remind_coupon').text($('#coupon_balance option:selected').val());
                                         make_beauty_chk();
                                     }
                                 }, error : function(xhr, error){
                                     console.log('error'+xhr)
                                 }
                             });
                         }
                        $('#coupon_seq').val(cid);
                     }, error : function(xhr, error){
                         console.log('error'+xhr)
                     }
                 });
             }
        });

        //크기 정보 구하기
        function get_type_load(gt){
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax.php',
                data : {'mode':'getTypeSize','type':gt},
                dataType : 'json',
                success : function(json){
                    if(json.flag == true){
                        $('#serviceType').empty().append(json.data);
                        make_beauty_chk();
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //서비스 선택시
        $(document).on('click','.service-type',function(){

            var petType = '';
            var serviceType = '';
            var service = $(this).val();
            $('input[name="pet_kind"]').each(function(){
                if($(this).is(':checked')==true) {
                    petType = $(this).val();
                }
            });

            $('.pet-size').each(function(){
                if($(this).is(':checked')==true) {
                    serviceType = $(this).val();
                }
            });

            if(!petType || !serviceType){
                alert('크기를 선택해주세요.');
                return false;
            }

            //해당 미용 시간으로 예약시간을 변경한다.
            console.log($(this).data('time'));
            //$('#to_time').val($(this).data('time'));
            var this_time = parseInt($(this).data('time'));
            var lsat_time = $('#to_time option:last').val();
            if(this_time <= lsat_time){
                $('#to_time').val(this_time);
            }else{
                $('#to_time').val(lsat_time);
            }
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax.php',
                data: {'mode':'getBeautyKgsData','petType':petType,'serviceType':serviceType,'service':service},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    if(json.flag == true){
                        $('#kgs_list').empty().append(json.data);
                        make_beauty_chk();
                    }
                }
            });
        });

        //강아지 사이즈 선택시 무게 값을 가져온다.
        $(document).on('click','.pet-size',function(){

            document.getElementById('kgs_list').innerHTML = ' <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="weight1"><input type="radio" name="weight" id="weight1" value="" class="weight" checked=""><em><span>선택안함</span></em></label></div>'


            var petType = '';
            var serviceType = '';
            var service = '';
            var startTime = "<?=$rev_date ?>";
            $('input[name="pet_kind"]').each(function(){
                if($(this).is(':checked')==true) {
                    petType = $(this).val();
                }
            });

                    serviceType = $(this).val();


            if(petType || serviceType || service){
                $.ajax({
                    type: 'post',
                    url: 'data/get_book_data_ajax.php',
                    data: {'mode':'getBeautyServiceData','petType':petType,'serviceType':serviceType,'service':service, 'start_time': startTime},
                    dataType: 'json',
                    error: function() {
                        alert('Error');
                    },
                    success: function(json) {
                        if(json.flag == true){
                            $('#service_list').empty().append(json.data);
                            make_beauty_chk();
                        }
                    }
                });
            }




        });

        // });

        // 무게 키로당 추가금액 선택시
        //무게 +-
        function weight_change(obj, add_price, type){
            var name = $('#weight'+obj+'_cnt');
            var org_cnt = parseInt($('#weight'+obj+'_cnt').val());
            var weight_plus = $(".weight_plus").val().split(":");
            var weight_plus_0 = parseInt(weight_plus[0]);
            var weight_plus_1 = parseInt(weight_plus[1]);
            var obj = parseInt(obj);
            console.log(add_price, weight_plus_0, weight_plus_1);
            if(type == 'm'){
                if(name.val() > obj){
                    name.val(org_cnt-1);
                    var val = (weight_plus_0-1)+":"+(weight_plus_1-add_price);
                    $(".weight_plus").val(val);
                }
            } else {
                if(name.val() < 100){
                    name.val(org_cnt+1);
                    var val = (weight_plus_0+1)+":"+(weight_plus_1+add_price);
                    $(".weight_plus").val(val);
                }
            }
        }

        //품종선택시
        $(document).on('click','input[name="pet_kind"]',function(){
            //기본서비스 정보를 초기화 한다.

            console.log($(this).val())
            if($(this).val() == 'dog'){
                //get_type_load($(this).val());
                get_type_load('dog');
                $('#is_dog').css('display','block');
                $('#is_cat').css('display','none');
                $('.is_dog').css('display','block');
                $('.is_cat').css('display','none');
                $('#pet_type_cat').prop('disabled',true);
                $('#pet_type_dog').prop('disabled',false);
            } else {
                get_type_load('cat');
                $('#is_cat').css('display','block');
                $('#is_dog').css('display','none');
                $('.is_dog').css('display','none');
                $('.is_cat').css('display','block');
                $('#pet_type_cat').prop('disabled',false);
                $('#pet_type_dog').prop('disabled',true);
            }
            $('#choose_area').empty();
            $('#extra_choose_area').empty();
            //
        });

        //이전 미용 정보 불러오기
        function get_prev_beauty_info(){
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax.php',
                data: {'mode':'getBeautyKgsData','petType':petType,'serviceType':serviceType,'service':service},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    if(json.flag == true){
                        $('#kgs_list').empty().append(json.data);
                        make_beauty_chk();
                    }
                }
            });
        }

        //무게 선택시
        $(document).on('click','.weight, .extra-hair-type, .extra-hair-length, .extra-face, .extra-leg, .extra-spa, .extra-color, .extra-etc, .cat-weight, .cat-hair-price, .cat_bath, .cat-etc, .cw',function(){
            make_beauty_chk();
            make_beauty_cat_chk();
        });
        //서비스 선택정보 만들기
        function make_beauty_chk(){
            var choose_info = '';
            var extra_choose_info = '';
            if($('#breed1').is(':checked')==true) {
                $('.pet-size').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">' + $(this).val() + 'kg</div>';
                            choose_info += '</div>';
                        }
                    }
                });
                $('.service-type').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">' + $(this).parent().find('em').text() + '</div>';
                            choose_info += '</div>';
                        }
                    }
                });
                $('.weight').each(function () {

                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {

                            var tmp = $(this).val().split(':');
                            console.log(tmp)
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">~' + tmp[0] + 'kg</div>';
                            choose_info += '</div>';
                        }
                    }
                })
                $('.extra-hair-type').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '<div class="list-title">털특징</div>';
                            choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            choose_info += '</div>';
                        }
                    }
                });
                $('.extra-hair-length').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '<div class="list-title">털길이</div>';
                            choose_info += '<div class="list-data">+ ' + tmp[0] + 'mm</div>';
                            choose_info += '</div>';
                        }
                    }
                });
                $('.extra-face').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            extra_choose_info += '<div class="service-selected-list-cell">';
                            extra_choose_info += '<div class="list-title">얼굴컷</div>';
                            extra_choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            extra_choose_info += '</div>';
                        }
                    }
                });
                $('.extra-leg').each(function () {
                    var cnt = 0;
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            if (cnt == 0) {
                                extra_choose_info += '<div class="service-selected-list-cell">';
                                extra_choose_info += '<div class="list-title">다리</div>';
                            }
                            extra_choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            extra_choose_info += '</div>';
                            cnt++;
                        }
                    }
                });
                $('.extra-spa').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            extra_choose_info += '<div class="service-selected-list-cell">';
                            extra_choose_info += '<div class="list-title">스파</div>';
                            extra_choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            extra_choose_info += '</div>';
                        }
                    }
                });
                $('.extra-color').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            extra_choose_info += '<div class="service-selected-list-cell">';
                            extra_choose_info += '<div class="list-title">염색</div>';
                            extra_choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            extra_choose_info += '</div>';
                        }
                    }
                });
                $('.extra-etc').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            extra_choose_info += '<div class="service-selected-list-cell">';
                            extra_choose_info += '<div class="list-title">기타</div>';
                            extra_choose_info += '<div class="list-data">+ ' + tmp[0] + '</div>';
                            extra_choose_info += '</div>';
                        }
                    }
                });

                $('#choose_area').empty().append(choose_info);
                $('#extra_choose_area').empty().append(extra_choose_info);
            }
        }

        function make_beauty_cat_chk(){
            var choose_info = '';
            var extra_choose_info = '';
            if($('#breed2').is(':checked')==true) {
                console.log('cat info')
                $('.cw').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">무게 : ' + $(this).val() + 'kg</div>';
                            choose_info += '</div>';
                        }
                    }
                });
                $('.cat-hair-price').each(function () {

                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {

                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">미용 : ' + $(this).data('cat_hair') + '</div>';
                            choose_info += '</div>';
                        }
                    }
                });

                $('.cat_bath').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            if($(this).data('cat_bath') == ''){
                                choose_info += '';
                            } else {
                                choose_info += '<div class="service-selected-list-cell">';
                                choose_info += '    <div class="list-data">목욕 : ' + $(this).data('cat_bath') + '</div>';
                                choose_info += '</div>';
                            }
                        }
                    }
                });

                $('.cat-etc').each(function () {
                    if ($(this).is(':checked') == true) {
                        if ($(this).val() != '') {
                            var tmp = $(this).val().split(':');
                            choose_info += '<div class="service-selected-list-cell">';
                            choose_info += '    <div class="list-data">추가 : ' + tmp[0] + '</div>';
                            choose_info += '</div>';
                        }
                    }
                });


                $('#choose_area').empty().append(choose_info);
                $('#extra_choose_area').empty().append(extra_choose_info);
            }
        }


        //알람없이 저장
        $(document).on('click','#reserve_regist_1',function(){
            console.log(1)
            if($('#to_time').val()-$('#from_time').val() <= 0){
                alert("미용 시간을 확인해주세요.");
                return false;
            }
            document.getElementById('notice_check').checked = false;
            document.getElementById('alarm_yn').value = 'N'
            document.getElementById('notice_check_span').innerText ='미발송'
            console.log('알람없이 저장');
            pop.open('reserveCalendarPop11');
            //document.f.submit();
        });

        //저장
        $(document).on('click','#reserve_regist_2',function(){
            if($('#to_time').val()-$('#from_time').val() <= 0){
                alert("미용 시간을 확인해주세요.");
                return false;
            }
            document.getElementById('notice_check').checked = true;
            document.getElementById('alarm_yn').value = 'Y'
            document.getElementById('notice_check_span').innerText ='발송'
            console.log('알람 저장')
            pop.open('reserveCalendarPop11');
            //document.f.submit();
        });

        $(document).ready(function() {
            var petType = "<?= $data["pet"]['type'] ?>";
            var pet_type = "<?= $data["pet"]['pet_type'] ?>";
            $("#pet_type").on("change", function(e) {
                if ($("#pet_type").val().trim() == "기타") {
                    $("#pet_type2").show();
                } else {
                    $("#pet_type2").hide();
                }
            });
            if(petType == 'dog'){
                $('.is-dog').css('display','block');
                $('.is-cat').css('display','none');
            } else {
                $('.is-cat').css('display','block');
                $('.is-dog').css('display','none');
            }
            get_pet_info(<?php echo $_GET['no'];?>);
            changePetType(petType, pet_type);
            get_type_load('<?php echo $data["pet"]['type'];?>');
            make_beauty_chk();

        });

        function changePetType(pet_type, thisVale) {
            var petType = $("#pet_type");
            $.ajax({
                type: 'get',
                url: 'data/data_get_json_petkind_list.php',
                data: 'type=' + pet_type,
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(res) {
                    $.each(res.row,function(i, v) {
                        var obj_option = $('<option></option>');
                        obj_option.val(v['name']).text(v['name']);
                        if (thisVale != null && v['name'] == thisVale) obj_option.prop('selected', true);
                        petType.append(obj_option);
                    });
                    make_beauty_chk();

                }
            });
        }
        function etc_toggle(){
            if ($("#pet_type").val().trim() == "기타") {
                $("#pet_type2").show();
            } else {
                $("#pet_type2").hide();
            }
            make_beauty_chk();
        }

        function chk_dt(url){
            $('.mv-url').attr('onclick','go_url("'+url+'")');
            popalert.open('reserveCalendarPop99');
        }

        function go_url(url){
            location.href = url;
        }

        //특이사항 더보기
        $(document).on('click','.view-special-cmt',function(){
            if($(this).text() == '더보기'){
                $('.special-cmt').css('display','block');
                $(this).text('닫기');
            } else {
                $('.special-cmt').each(function(index){
                    if(index>4){
                        $('.special-cmt').eq(index).css('display','none');
                    }
                })
                $(this).text('더보기');
            }
        });
        //이전미용 더보기
        $(document).on('click','.view-prev-beauty',function(){
            if($(this).text() == '더보기'){
                $('.memo-item').css('display','block');
                $(this).text('닫기');
            } else {
                $('.memo-item').each(function(index){
                    if(index>4){
                        $('.memo-item').eq(index).css('display','none');
                    }
                })
                $(this).text('더보기');
            }
        });

        $(document).ready(function(){
            $('#btn_page_prev').prop('href','reserve_accept?worker=<?php echo $_GET['worker'];?>&workTime=<?php echo $_GET['workTime'];?>&workDate=<?php echo $_GET['workDate'];?>&searchTxt=<?php echo $_GET['searchTxt'];?>');
        });

        function cat_show_view(g){
            $('.cat-weight').css('display','none');
            $('.kg_'+g).css('display','block');
        }



        $(document).ready(function(){

            document.getElementById('reserve_deposit_time').addEventListener('change',function(){

                let time = parseInt(document.getElementById('reserve_deposit_time').value);

                let deposit_time = new Date();

                deposit_time.setMinutes(deposit_time.getMinutes()+time);


                document.getElementById('reserve_deposit_time_').value = `${deposit_time.getFullYear()}-${fill_zero(deposit_time.getMonth()+1)}-${fill_zero(deposit_time.getDate())} ${fill_zero(deposit_time.getHours())}:${fill_zero(deposit_time.getMinutes())}:${fill_zero(deposit_time.getSeconds())}`
            })

        })


        function deposit_toggle(id){




            $.ajax({

                url:'/data/api.php',
                type:'post',
                data:{

                    mode:'get_deposit',
                    artist_id:id
                },success:function(res) {
                    let response = JSON.parse(res);
                    let head = response.data.head;
                    let body = response.data.body;
                    if (head.code === 401) {
                        pop.open('firstRequestMsg1', '잠시 후 다시 시도 해주세요.');
                    } else if (head.code === 200) {
                        console.log(body)

                        if(body.length >0){
                            if(document.getElementById('deposit_form_1').style.display === 'none'){

                                document.getElementById('deposit_form_1').style.display = 'block'
                            }else{

                                document.getElementById('deposit_form_1').style.display = 'none';
                            }


                            document.getElementById('reserve_deposit_input').value = body[0].reserve_price

                            for(let i=0; i<document.getElementById('reserve_deposit_time').options.length; i++){

                                if(body[0].deadline == document.getElementById('reserve_deposit_time').options[i].value){

                                    document.getElementById('reserve_deposit_time').options[i].selected = true;
                                    document.getElementById('reserve_deposit_time').dispatchEvent(new Event('change'))
                                }

                            }

                            if(document.getElementById('deposit_btn').checked === true){
                                document.getElementById('deposit_notice').style.display = 'flex';
                            }else{
                                document.getElementById('deposit_notice').style.display = 'none';
                            }


                            document.getElementById('reserve_deposit_input').setAttribute('data-bank',`${body[0].bank_name}`)
                            document.getElementById('reserve_deposit_input').setAttribute('data-account',`${body[0].account_num}`)
                        }else{

                            pop.open('deposit_confirm')

                        }



                    }
                }

            })



        }

        function minutes_to_hour(minutes){

            let hours = Math.floor(minutes/60);
            let min = minutes%60;


            return `${hours !== 0 ? hours : ''}${hours !== 0 ? '시간 ':''}${min !== 0 ? min : ''}${min !== 0 ? '분' :''}`

        }


        var bank_names = [
            {
                code : '003',
                name : '기업은행'
            },{
                code : '004',
                name : '국민은행'
            },{
                code : '011',
                name : '농협중앙회회'
            },{
                code : '012',
                name : '단위농협'
            },{
                code : '020',
                name : '우리은행'
            },{
                code : '031',
                name : '대구은행'
            },{
                code : '005',
                name : '외환은행'
            },{
                code : '023',
                name : 'SC제일은행'
            },{
                code : '032',
                name : '부산은행'
            },{
                code : '045',
                name : '새마을금고'
            },{
                code : '027',
                name : '한국씨티은행'
            },{
                code : '034',
                name : '광주은행'
            },{
                code : '039',
                name : '경남은행'
            },{
                code : '007',
                name : '수협'
            },{
                code : '048',
                name : '신협'
            },{
                code : '037',
                name : '전북은행'
            },{
                code : '035',
                name : '제주은행'
            },{
                code : '064',
                name : '산림조합'
            },{
                code : '071',
                name : '우체국'
            },{
                code : '081',
                name : '하나은행'
            },{
                code : '088',
                name : '신한은행'
            },{
                code : '090',
                name : '카카오뱅크'
            },{
                code : '209',
                name : '동양종금증권'
            },{
                code : '243',
                name : '한국투자증권'
            },{
                code : '240',
                name : '삼성증권'
            },{
                code : '230',
                name : '미래에셋'
            },{
                code : '247',
                name : '우리투자증권'
            },{
                code : '218',
                name : '현대증권'
            },{
                code : '266',
                name : 'SK증권'
            },{
                code : '278',
                name : '신한금융투자'
            },{
                code : '262',
                name : '하이증권'
            },{
                code : '263',
                name : 'HMC증권'
            },{
                code : '267',
                name : '대신증권'
            },{
                code : '270',
                name : '하나대투증권'
            },{
                code : '279',
                name : '동부증권'
            },{
                code : '280',
                name : '유진증권'
            },{
                code : '287',
                name : '메리츠증권'
            },{
                code : '291',
                name : '신영증권'
            },{
                code : '238',
                name : '대우증권'
            }

        ]


        function deposit_save(id){


            if(parseInt(document.getElementById('deposit_input').value) < 1000){

                document.getElementById('msg1_txt').innerText = '최소 예약금은 1,000원 입니다.';
                pop.open('reserveAcceptMsg1');
                return;
            }

            $.ajax({

                url:'/data/api.php',
                type:'post',
                data:{

                    mode:'deposit_save',
                    artist_id:id,
                    reserve_price:document.getElementById('deposit_input').value,
                    deadline:document.getElementById('deposit_time').value,
                    bank_name:document.getElementById('deposit_bank').value,
                    account_num:document.getElementById('deposit_bank_account').value
                },success:function(res) {
                    console.log(res)
                    let response = JSON.parse(res);
                    let head = response.data.head;
                    let body = response.data.body;
                    if (head.code === 401) {
                        pop.open('firstRequestMsg1', '잠시 후 다시 시도 해주세요.');
                    } else if (head.code === 200) {


                        pop.close('deposit_set')
                    }


                }

            })


        }

        function get_deposit(id){



            $.ajax({

                url:'/data/api.php',
                type:'post',
                data:{

                    mode:'shop_reserve_get',
                    login_id:id,
                },success:function(res) {
                    console.log(res)
                    let response = JSON.parse(res);
                    let head = response.data.head;
                    let body = response.data.body;
                    if (head.code === 401) {
                        pop.open('firstRequestMsg1', '잠시 후 다시 시도 해주세요.');
                    } else if (head.code === 200) {
                        console.log(body)


                        document.getElementById('deposit_input').value = body[0].reserve_price;


                        for(let i=0; i<document.getElementById('deposit_time').options.length; i++){

                            if(body[0].deadline == document.getElementById('deposit_time').options[i].value){

                                document.getElementById('deposit_time').options[i].selected = true;

                            }
                        }

                        for(let i=0; i<document.getElementById('deposit_bank').options.length; i++){

                            if(body[0].bank_name == document.getElementById('deposit_bank').options[i].value){

                                document.getElementById('deposit_bank').options[i].selected = true;

                            }
                        }

                        document.getElementById('deposit_bank_account').value = body[0].account_num;
                    }


                }

            })

        }


        function fill_zero(time){

            if(time.toString().length < 2){

                time = `0${time}`
            }else{
                time = time;
            }

            return time;
        }

        function deposit_finish(target){

            if(target.checked === true){
                target.disabled = true;
            }
            let payment_idx = target.getAttribute('data-payment_idx');
            let allim = target.getAttribute('data-allim');

            let beauty_date = target.getAttribute('data-date');
            let cellphone = target.getAttribute('data-cellphone');
            let name = target.getAttribute('data-pet-name');

            let year = target.getAttribute('data-year');
            let month = target.getAttribute('data-month');
            let day = target.getAttribute('data-day');

            let hour = target.getAttribute('data-hour');
            let min = target.getAttribute('data-min');

            let shop_name = target.getAttribute('data-shop_name');
            $.ajax({

                url:'/data/api.php',
                type:'post',
                data:{
                    mode:'deposit_finish',
                    payment_log_seq:payment_idx,
                },
                success:function(res) {
                    let response = JSON.parse(res);
                    let head = response.data.head;
                    let body = response.data.body;
                    if (head.code === 401) {
                        pop.open('firstRequestMsg1', '잠시 후 다시 시도 해주세요.');
                    } else if (head.code === 200) {
                        console.log(body)
                        if(allim == 1){

                            document.getElementById('pay_deposit_btn').setAttribute('data-allim','0')
                            let message = `반려생활의 단짝, 반짝에서 ${cellphone.slice(-4)}님의 ${name} 미용예약 내용을 알려드립니다.\n` +
                                '\n' +
                                `- 예약펫샵 : ${shop_name}\n` +
                                `- 예약일시 : ${year}년 ${month}월 ${day}일 ${hour}시 ${min}분\n` +
                                '\n' +
                                '예약내용 상세확인과 예약은\n' +
                                '반려생활의 단짝, 반짝에서도 가능합니다.';



                            $.ajax({

                                url:'/data/api.php',
                                type:'post',
                                data:{

                                    mode:'reserve_regist_allim',
                                    cellphone:cellphone,
                                    message:message,
                                    payment_idx:body.idx,


                                },success:function(res){



                                }
                            })

                        }
                        target.checked = true;
                        let date_ = new Date();
                        document.getElementById('pay_deposit_title').innerText = '예약금 입금완료';
                        document.getElementById('pay_deposit_title').classList.add('actived');
                        document.getElementById('pay_deposit_date').innerText = `(입금처리 : ${date_.getFullYear()}. ${fill_zero(date_.getMonth()+1)}. ${fill_zero(date_.getDate())}. ${am_pm_check(date_.getHours())}시 ${fill_zero(date_.getMinutes())}분)`

                    }
                }
            })
        }
        function am_pm_check(hours){

            if(hours > 12){
                hours = `오후 ${(hours-12).toString().length <2 ? '0' : ''}${hours-12}`
            }else if(hours === 12){
                hours = `오후 ${hours}`
            }else{
                hours = `오전 ${hours}`
            }

            return hours;
        }
    </script>
<?
//include($_SERVER['DOCUMENT_ROOT'] . "/include/skin/footer_shop.php");
?>
