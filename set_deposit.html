<?
include($_SERVER['DOCUMENT_ROOT']."/include/global.php");

$artist_flag = (isset($_SESSION['artist_flag'])) ? $_SESSION['artist_flag'] : "";

if ($artist_flag === true) {
    $artist_id = (isset($_SESSION['shop_user_id'])) ? $_SESSION['shop_user_id'] : "";
    $user_id = (isset($_SESSION['shop_user_id'])) ? $_SESSION['shop_user_id'] : "";
    $user_name = (isset($_SESSION['shop_user_nickname'])) ? $_SESSION['shop_user_nickname'] : "";
} else {
    $artist_id = (isset($_SESSION['gobeauty_user_id'])) ? $_SESSION['gobeauty_user_id'] : "";
    $user_id = (isset($_SESSION['gobeauty_user_id'])) ? $_SESSION['gobeauty_user_id'] : "";
    $user_name = (isset($_SESSION['gobeauty_user_nickname'])) ? $_SESSION['gobeauty_user_nickname'] : "";
}

$yy = (isset($_REQUEST['yy']) && $_REQUEST['yy']) ? $_REQUEST['yy'] : date('Y');
$mm = (isset($_REQUEST['mm']) && $_REQUEST['mm']) ? $_REQUEST['mm'] : date('m');
$dd = (isset($_REQUEST['dd']) && $_REQUEST['dd']) ? $_REQUEST['dd'] : date('d');



$shop_title	= "예약금 설정";
$header_right	= '';
include($_SERVER['DOCUMENT_ROOT']."/include/skin/header_shop.php");
include($_SERVER['DOCUMENT_ROOT']."/include/check_login_shop.php");


?>
<!-- container -->
<section id="container">
    <!-- page-body -->
    <div class="page-body">
        <!-- set-save-money -->
        <div class="set-save-money"  id="shop_reserve">
            <div class="basic-data-group">
                <div class="con-title-group">
                    <h4 class="con-title">예약금</h4>
                </div>
                <div class="form-group vmiddle">
                    <div class="form-group-cell middle">
                        <div class="form-group-item">
                            <div class="form-item-data type-2">
                                <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center;">
                                    <input type="number" placeholder="최소 예약금은 1천원" min="0" id="deposit_input"><label style="margin-left:10px;"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="basic-data-group">
                <div class="con-title-group">
                    <h4 class="con-title">결제기한 설정</h4>
                </div>
                <div class="basic-data-group vvsmall2">
                    <div class="form-group-item">
                        <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px;">
                            <select class="percent" id="deposit_time">
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="basic-data-group">
                <div class="con-title-group">
                    <h4 class="con-title">계좌입력</h4>
                </div>
                <div class="basic-data-group vvsmall2">
                    <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center">
                        <label style="margin-right:20px; min-width:80px;">은행명</label>
                        <select class="percent" id="deposit_bank">

                        </select>


                    </div>
                    <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center">

                        <label style="margin-right:20px; min-width:80px">계좌번호</label>
                        <input type="text" placeholder='" - " 포함'  type="number" min="0" id="deposit_bank_account">

                    </div>
                </div>
            </div>
            <div class="basic-data-group">
                <div class="con-title-group">
                    <h4 class="con-title">예약금 결제관리</h4>
                </div>
                <div class="basic-data-group vvsmall2">
                    <div class="form-group-item">
                        <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center; justify-content: space-between">

                            <span>수동</span><label for="switch-toggle" class="form-switch-toggle"><input type="checkbox" checked onclick="return false;"><span class="bar"></span></label>
                        </div>
                        <div class="form-item-data type-2" style="margin-top:0px; padding-top:10px; display: flex; align-items: center; justify-content: space-between">

                            <span>자동</span><label for="switch-toggle" class="form-switch-toggle"><input type="checkbox" onclick="event.preventDefault(); document.getElementById('msg1_txt').innerText = '열심히 오픈 준비중입니다. \n 조금만 기다려 주세요.'; pop.open('reserveAcceptMsg1') "><span class="bar"></span></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- //set-save-money -->
    </div>
    <!-- //page-body -->
    <!-- page-bottom -->
    <div class="page-bottom">
        <!--
        //	비활성화시
        // - a태그는 disabled 클래스 추가
        // - button 태그는 disabled 속성 추가
        -->
        <a href="#" class="btn-page-bottom deposit_btn" onclick="deposit_save(artist_id)">저장하기</a>
    </div>
    <!-- //page-bottom -->
</section>
<!-- //container -->

<article id="reserveAcceptMsg1" class="layer-pop-wrap">
    <div class="layer-pop-parent">
        <div class="layer-pop-children">
            <div class="pop-data alert-pop-data">
                <div class="pop-body">
                    <div class="msg-txt" id="msg1_txt"></div>
                </div>
                <div class="pop-footer">
                    <button type="button" class="btn btn-confirm" onclick="pop.close();">확인</button>
                </div>
            </div>
        </div>
    </div>
</article>

<article id="reserveAcceptMsg2" class="layer-pop-wrap">
    <div class="layer-pop-parent">
        <div class="layer-pop-children">
            <div class="pop-data alert-pop-data">
                <div class="pop-body">
                    <div class="msg-txt" id="msg2_txt"></div>
                </div>
                <div class="pop-footer">
                    <button type="button" class="btn btn-confirm" onclick="location.reload()">확인</button>
                </div>
            </div>
        </div>
    </div>
</article>

<script src="/static/js/dev_common.js"></script>


<script>
    var artist_id = "<?=$artist_id ?>";


    $(document).ready(function(){

        $('#btn_page_prev').prop('href','set_main');

        setInputFilter(document.getElementById("deposit_input"), function(value) {
            return /^\d*\.?\d*$/.test(value);
        })

        for(let i=30; i<=1440; i+=30){
            document.getElementById('deposit_time').innerHTML += `<option value=${i}>${minutes_to_hour(i)} 이내</option>`
        }

        get_deposit(artist_id);
    })







    bank_names.forEach(function(el){

        document.getElementById('deposit_bank').innerHTML += `<option value="${el.name}" data-code="${el.code}">${el.name}</option>`
    })



    function setInputFilter(textbox, inputFilter) {
        ["input", "keydown", "keyup", "mousedown", "mouseup", "select", "contextmenu", "drop"].forEach(function(event) {
            textbox.addEventListener(event, function() {
                if (inputFilter(this.value)) {
                    this.oldValue = this.value;
                    this.oldSelectionStart = this.selectionStart;
                    this.oldSelectionEnd = this.selectionEnd;
                } else if (this.hasOwnProperty("oldValue")) {
                    this.value = this.oldValue;
                    this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
                } else {
                    this.value = "";
                }
            });
        });
    }


</script>
<?
//include($_SERVER['DOCUMENT_ROOT']."/include/skin/footer_shop.php");
?>
