<?php
include($_SERVER['DOCUMENT_ROOT']."/include/global.php");

$artist_flag = (isset($_SESSION['artist_flag'])) ? $_SESSION['artist_flag'] : "";

if ($artist_flag === true) {
    $artist_id = (isset($_SESSION['shop_user_id'])) ? $_SESSION['shop_user_id'] : "";
    $user_id = (isset($_SESSION['shop_user_id'])) ? $_SESSION['shop_user_id'] : "";
    $user_name = (isset($_SESSION['shop_user_nickname'])) ? $_SESSION['shop_user_nickname'] : "";
} else {
    $artist_id = (isset($_SESSION['gobeauty_user_id'])) ? $_SESSION['gobeauty_user_id'] : "";
    $user_id = (isset($_SESSION['gobeauty_user_id'])) ? $_SESSION['gobeauty_user_id'] : "";
    $user_name = (isset($_SESSION['gobeauty_user_nickname'])) ? $_SESSION['gobeauty_user_nickname'] : "";
}

$yy = (isset($_REQUEST['yy']) && $_REQUEST['yy']) ? $_REQUEST['yy'] : date('Y');
$mm = (isset($_REQUEST['mm']) && $_REQUEST['mm']) ? $_REQUEST['mm'] : date('m');
$dd = (isset($_REQUEST['dd']) && $_REQUEST['dd']) ? $_REQUEST['dd'] : date('d');



$shop_title	= "작업 / 결제관리";
$header_right	= '
	
';
include($_SERVER['DOCUMENT_ROOT']."/include/skin/header_shop.php");
include($_SERVER['DOCUMENT_ROOT']."/include/check_login_shop.php");

$notice_yn = "Y";

//돌아갈 url을 세션에 저장한다.
unset($_SESSION['backurl2']);
$_SESSION['backurl2'] = 'reserve_pay_management_2?payment_log_seq='.$_GET['payment_log_seq'];


$customer_user_id = $user_id;	// 사진 변경용 정회원번호
$customer_tmp_seq = "";			// 사진 변경용 가회원번호

$thisTimeStart = $_GET['thisTimeStart'];
$thisTimeEnd = $_GET['thisTimeEnd'];
$order_id = $_GET['order_id'];
$payment_log_seq = $_GET['payment_log_seq'];
$backurl = urldecode($_GET['backurl']);
$backurl_4_gallery = urlencode("/pet/shop/view_payment_customer_info_pc.php?payment_log_seq={$payment_log_seq}&thisTimeStart={$thisTimeStart}&thisTimeEnd={$thisTimeEnd}");	// 갤러리용 backurl

//결제 정보 구하기
$que = "SELECT * FROM tb_payment_log WHERE payment_log_seq = {$payment_log_seq}";
$res = sql_query($que);
$pay = sql_fetch($res);

$notice_yn		= $pay['notice_yn'];


$crypto = new Crypto();
//회원정보
if($pay['customer_id']) {
    $que = "SELECT * FROM tb_customer WHERE id = '{$pay['customer_id']}'";
} else {
    $que = "SELECT * FROM tb_tmp_user WHERE cellphone = '{$pay['cellphone']}'";
}
//echo $que;
$res = sql_query($que);
$cus = sql_fetch($res);


//펫정보
$que = "SELECT * FROM tb_customer_family WHERE to_customer_id = '{$pay['customer_id']}' AND to_cellphone = '{$cus['cellphone']}' AND is_delete = 0";
//echo $que;
$arr = sql_fetch_array($que);
if(count($arr)>0){
    foreach($arr as $fam){
        $tel['title'][] = $fam['from_nickname'];
        $tel['tel'][] = $fam['from_cellphone'];
    }
}

//메모
$que = "SELECT * FROM tb_shop_customer_memo WHERE (customer_id = '{$pay['customer_id']}' OR tmp_seq = '{$cus['tmp_seq']}')AND artist_id = '{$pay['artist_id']}' AND cellphone = '{$pay['cellphone']}' AND is_delete = 1";
//echo $que;
$arr = sql_fetch_array($que);
if(count($arr)>0){
    foreach($arr as $fam){
        $tel['title'][] = $fam['from_nickname'];
        $tel['tel'][] = $fam['from_cellphone'];
    }
}


//페이미지
$que = "SELECT * FROM tb_mypet_beauty_photo WHERE artist_id = '{$pay['aritst_id']}' AND pet_seq = {$pay['pat_seq']} ORDER BY upload_dt DESC LIMIT 1";
$res = sql_query($que);
$pic = sql_fetch($res);
if(!$pic['file_path']){

}
$que = "SELECT * FROM tb_mypet WHERE pet_seq = {$pay['pet_seq']}";
$res1 = sql_query($que);
$pet = sql_fetch($res1);
//print_r($pet);

//미용사 정보
$que = "SELECT * FROM tb_artist_list WHERE name = '{$pay['worker']}' GROUP BY artist_id ";
//echo $que;
$ar = sql_fetch_array($que);


$que = "SELECT * FROM tb_working_schedule WHERE customer_id = '{$user_id}'";
$tws = sql_fetch_array($que);


//상점정보
$que = "SELECT * FROM tb_shop WHERE customer_id = '{$pay['artist_id']}'";
$sh = sql_fetch_array($que);

//미용선택정보 가져오기
$beauty_info = explode("|",$pay['product']);
//print_r($beauty_info);

// 단골고객할인 select 구하기
$discount_percent = [];
for($i = 0; $i <= 100; $i++){
    $discount_percent[$i] = $i;
}
$discount_won = [];
for($i = 0; $i <= 500; $i++){
    $discount_won[$i] = $i * 100;
}

//적립금
$que = "SELECT * FROM tb_user_reserve WHERE customer_id = '{$cus['id']}' AND artist_id = '{$pay['artist_id']}' AND tmp_seq = '{$cus['tmp_seq']}'";
//echo $que."<br>";
$res = sql_query($que);
$resrv = sql_fetch($res);
//print_r($resrv);

//쿠폰

$que = "SELECT * FROM tb_coupon WHERE customer_id = '{$pay['artist_id']}' AND product_type = 'B' AND del_yn = 'N' AND (given > 0 OR price > 0)";
//echo $que;
$arr = sql_fetch_array($que);
if (count($arr) > 0) {
    foreach ($arr as $arr) {
        $coupon[] = $arr;
    }
}
//print_r($coupon);

//보유 쿠폰 내역
$que = "SELECT coupon_seq FROM tb_user_coupon WHERE customer_id = '{$cus['id']}' AND tmp_seq = '{$cus['tmp_seq']}' AND artist_id = '{$pay['artist_id']}' ";
$qrs = sql_fetch_array($que);
if(count($qrs)>0){
    foreach($qrs as $qrs) {
        $cpseq[] = $qrs['coupon_seq'];
    }
}

//미용동의서
$que = "SELECT * FROM tb_beauty_agree WHERE artist_id = '{$pay['artist_id']}' AND pet_id = '{$pay['pet_seq']}'";
//echo $que;
$bag = sql_fetch_array($que);


//견주메모관련
$que = "SELECT * FROM tb_shop_customer_memo WHERE customer_id = '{$cus['id']}' AND tmp_seq = '{$cus['tmp_seq']}' AND cellphone = '{$pay['cellphone']}' AND artist_id = '{$pay['artist_id']}'";
//echo $que;
$scm = sql_fetch_array($que);

//가족번호조회
$que = "SELECT * FROM tb_customer_family WHERE to_cellphone = '{$pay['cellphone']}' AND artist_id = '{$user_id}' AND is_delete = 0";
//echo $que;
$arr_t = sql_fetch_array($que);
if(count($arr_t)>0){
    foreach($arr_t as $fam){
        $tel['title'][]     = $fam['from_nickname'];
        $tel['tel'][]       = $fam['from_cellphone'];
        $tel['seq'][]       = $fam['family_seq'];
    }
}

?>

    <!-- container -->
    <section id="container">
        <!-- page-body -->
        <div class="page-body">
            <div class="reserve-pay-management">
                <?php
                if($pay['status'] == 'R1' && $pay['total_price'] > 0){
                    ?>
                    <div class="basic-data-group vvsmall3">
                        <p class="btn btn-yellow btn-middle-size btn-round" style="margin-top:-10px;font-weight:bold;">사전 결제완료 : <span style="color:red;">&nbsp;<?php echo number_format($pay['total_price'])."원" ?></span></p>
                    </div>
                    <?php
                }
                ?>
                <!-- 예약자 정보 -->
                <div class="basic-data-group" style="margin-top:15px;">
                    <div class="con-title-group con-title-group-add">
                        <h4 class="con-title">예약자 정보</h4>
                    </div>
                    <div class="flex-table type-2">
                        <!--<div class="flex-table-cell">
                            <div class="flex-table-item">
                                <div class="flex-table-title"><div class="txt">아이디</div></div>
                                <div class="flex-table-data">
                                    <div class="flex-table-data-inner">
                                        <?php /*echo (!empty($cus['id']))?$cus['id']:$cus['tmp_seq'];*/?>
                                    </div>
                                    <?php /*if($pay['is_no_show']>0){ */?>
                                        <div class="flex-table-data-side"><div class="label label-outline-pink label-noshow">NO SHOW <?php /*echo $pay['is_no_show'];*/?>회</div></div>
                                    <?php /*} */?>
                                </div>
                            </div>
                        </div>-->
                        <div class="flex-table-cell">
                            <div class="flex-table-item">
                                <div class="flex-table-title"><div class="txt">등급</div></div>
                                <div class="flex-table-data">
                                    <div class="flex-table-data-inner">
                                        <div class="user-grade-item">
                                            <div class="icon icon-grade-vip"></div>
                                            <div class="icon-grade-label">VIP</div>
                                        </div>
                                        <!--
                                        <div class="user-grade-item">
                                            <div class="icon icon-grade-normal"></div>
                                            <div class="icon-grade-label">Normal</div>
                                        </div>
                                        <div class="user-grade-item">
                                            <div class="icon icon-grade-normalb"></div>
                                            <div class="icon-grade-label">Normal_B</div>
                                        </div>
                                        -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-table-cell">
                            <div class="flex-table-item">
                                <div class="flex-table-title"><div class="txt">연락처</div></div>
                                <div class="flex-table-data">
                                    <div class="flex-table-data-inner">
                                        <?php echo $pay['cellphone'];?>
                                    </div>
                                    <div class="flex-table-data-side">
                                        <div class="btn-ui-group">
                                            <a href="tel:<?php echo $pay['cellphone'];?>"><button type="button" class="btn-data-tel">전화하기</button></a>
                                            <a href="sms:<?php echo $pay['cellphone'];?>"><button type="button" class="btn-data-message">메시지보내기</button></a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-table-cell no-padding">
                            <div class="flex-table-item">
                                <div class="flex-table-title"><div class="txt">보조 연락처</div></div>
                                <div class="flex-table-data">
                                    <div class="flex-table-data-inner">
                                        <?php for($i=0;$i<count($arr_t);$i++){ ?>
                                            <div class="flex-table-item middle">
                                                <div class="flex-table-data">
                                                    <div class="flex-table-data-inner">
                                                        <div class="flex-table-txt"><em><?php echo $tel['title'][$i];?></em><?php echo $tel['tel'][$i];?></div>
                                                    </div>
                                                    <div class="flex-table-data-side">
                                                        <div class="btn-ui-group">
                                                            <a href="tel:<?php echo $tel['tel'][$i];?>"><button type="button" class="btn-data-tel">전화하기</button></a>
                                                            <a href="sms:<?php echo $tel['tel'][$i];?>"><button type="button" class="btn-data-message">메시지보내기</button></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <?php if($pay['is_no_show']!=1){?>
                        <div class="basic-data-group vvsmall3 mg-bt-12">
                            <a href="javascript:;" class="btn btn-red btn-middle-size btn-round set-noshow">노쇼 등록</a>
                        </div>
                    <?php } ?>
                    <div class="form-group-cell middle">
                        <div class="form-group-item">
                            <div class="form-item-label mg-bt-12">
                                견주관련 메모
                                <span class="form-input-info margin">(고객에게는 노출되지 않습니다.)</span>
                            </div>
                            <div class="form-item-data">
                                <textarea name="etc2_memo" id="etc2_memo" cols="30" rows="10"><?php echo $scm[0]['memo'];?></textarea>

                            </div>
                            <div class="form-item-data type-8">
                                <button type="button" class="pc-mg-bt-20 btn btn-outline-purple btn-middle-size btn-round save-etc2 ft-size-17" data-cid="<?php echo $cus['id'];?>" data-aid="<?php echo $pay['artist_id'];?>" data-phone="<?php echo $pay['cellphone'];?>" data-tseq="<?php echo $cus['tmp_seq'];?>">저장</button>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- //예약자 정보 -->
                <!-- 예약동물 정보 -->
                <div class="basic-data-group">
                    <div class="con-title-group con-title-group-add">
                        <h4 class="con-title">예약동물 정보</h4>
                    </div>
                    <div class="customer-view-pet-group">
                        <div class="customer-view-pet-picture">
                            <div class="item-thumb">
                                <div class="user-thumb large">
                                    <?php

                                    if(!empty($pet['photo'])){
                                        $img = "https://image.banjjakpet.com".img_link_change($pet['photo']);
                                    } else {
                                        $sql = "SELECT * FROM tb_mypet_beauty_photo WHERE pet_seq = '{$pet['pet_seq']}' AND artist_id = '{$user_id}' ORDER BY upload_dt DESC LIMIT 1";
                                        $rw = sql_fetch_array($sql);
                                        if(!empty($rw[0]['file_path'])){
                                            $img = "https://image.banjjakpet.com".img_link_change($rw[0]['file_path']);
                                        } else {
                                            if ($pet['type'] == 'dog') {
                                                $img = '/images/dog/dog_90x90/dog_90x90@3x.png';
                                            } else {
                                                $img = '/images/cat/cat_90x90/cat_90x90@3x.png';
                                            }
                                        }

                                        // 펫정보 입질
                                        if($pet['bite'] == 0){
                                            $bite = "안해요";
                                        }else{
                                            $bite = "해요";
                                        }
                                    }
                                    ?>
                                    <img src="<?php echo $img; ?>" alt="" onclick="show_img('<?php echo $img;?>');">
                                </div>
                            </div>
                            <div class="item-user-info">
                                <div class="item-user-info-inner">
                                    <div class="user-name"><?php echo $pet['name'];?></div>
                                    <div class="user-cate"><?php echo $pet['pet_type'];?></div>
                                </div>
                            </div>
                            <div class="item-action">
                                <div class="grid-layout btn-grid-group">
                                    <div class="grid-layout-inner">
                                        <div class="grid-layout-cell grid-2"><a href="#" class="btn btn-outline-gray btn-middle-size btn-round" onclick="location.href='./reserve_beauty_gallery?aid=<?php echo $pay['artist_id'];?>&seq=<?php echo $pay['payment_log_seq'];?>&pet=<?php echo $pay['pet_seq'];?>';">미용 갤러리</a></div>
                                        <?php
                                        if($bag[0]['is_agree']==1){
                                            ?>
                                            <div class="grid-layout-cell grid-2"><a href="./customer_beauty_agree_view?aid=<?php echo $pay['artist_id'];?>&uid=<?php echo $pay['cellphone'];?>&pid=<?php echo $pay['pet_seq'];?>&ba_seq=<?php echo $bag[0]['ba_seq'];?>&payment_seq=<?php echo $payment_log_seq;?>&backurl=reserve_pay_management_2" class="btn btn-outline-gray btn-middle-size btn-round" >미용동의서 보기</a></div>
                                        <?php } else { ?>
                                            <div class="grid-layout-cell grid-2"><a href="./customer_beauty_agree?aid=<?php echo $pay['artist_id'];?>&uid=<?php echo $pay['cellphone'];?>&pid=<?php echo $pay['pet_seq'];?>&backurl=reserve_pay_management_2" class="btn btn-outline-gray btn-middle-size btn-round" >미용동의서 작성</a></div>
                                        <?php } ?>
                                        <div class="grid-layout-cell grid-1"><a href="#" class="btn btn-outline-purple btn-middle-size btn-round" onclick="location.href='./customer_pet_add?pet_seq=<?php echo $pay['pet_seq'];?>&payment_seq=<?php echo $payment_log_seq;?>&backurl=reserve_pay_management_2';">펫 정보 수정</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="grid-col2-row3">
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">성별</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php echo $pet['gender'];?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">중성화</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php echo ($pet['neutral']==1)?'O':'X';?>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">무게</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php echo $pet['weight'];?>Kg
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--                            <div class="flex-table-cell">-->
                            <!--                                <div class="flex-table-item">-->
                            <!--                                    <div class="flex-table-title"><div class="txt">생일</div></div>-->
                            <!--                                    <div class="flex-table-data">-->
                            <!--                                        <div class="flex-table-data-inner">-->
                            <!--                                            --><?php //echo $pet['year'].'.'.$pet['month'].'.'.$pet['day'];?>
                            <!--                                        </div>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </div>-->
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">나이</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php
                                            calc_passed_year($pet['year'].'-'.$pet['month'].'-'.$pet['day'], date('Y-m-d'));
                                            ?>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">입질</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php
                                            echo $bite;
                                            ?>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-table-cell">
                                <div class="flex-table-item">
                                    <div class="flex-table-title flex-table-title-add"><div class="txt">슬개골 탈구</div></div>
                                    <div class="flex-table-data">
                                        <div class="flex-table-data-inner flex-table-data-inner-add">
                                            <?php echo ($pet['luxation'] == 0)? "없음" : $pet['luxation'];?>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- customer-view-pet-detail 클래스에 actived클래스 추가시 활성화 -->
                        <div class="customer-view-pet-detail">
                            <button type="button" class="btn-detail-toggle btn-detail-toggle-add" id="pet-info-view">펫 정보 자세히 보기</button>
                            <div class="service-selected-wrap">
                                <div class="service-selected-group">
                                    <div class="list-title">미용 경험</div>
                                    <div class="list-data list-data-add" ><?php echo ($pet['beauty_exp'] == 0)? "없음" : $pet['beauty_exp'];?></div>
                                </div>
                                <div class="service-selected-group">
                                    <div class="list-title">예방 접종</div>
                                    <div class="list-data list-data-add"><?php echo ($pet['vaccination'] == 0)? "2차 이하" : $pet['vaccination'];?></div>
                                </div>

                                <?php
                                if($pet['nothing']==1){
                                    //$is_hate = '없음';
                                } else {
                                    if ($pet['dt_eye'] == 1) $hate[] = '눈';
                                    if ($pet['dt_nose'] == 1) $hate[] = '코';
                                    if ($pet['dt_mouth'] == 1) $hate[] = '입';
                                    if ($pet['dt_neck'] == 1) $hate[] = '목';
                                    if ($pet['dt_body'] == 1) $hate[] = '몸';
                                    if ($pet['dt_leg'] == 1) $hate[] = '다리';
                                    if ($pet['dt_tail'] == 1) $hate[] = '꼬리';
                                    if ($pet['dt_genitalia'] == 1) $hate[] = '생식기';
                                    $is_hate = implode(",",$hate);
                                    ?>
                                    <div class="service-selected-group">
                                        <div class="list-title">생일</div>
                                        <div class="list-data list-data-add">
                                            <?php echo $pet['year'].'.'.$pet['month'].'.'.$pet['day'];?>
                                        </div>
                                    </div>
                                    <?php
                                }
                                //echo $is_hate;
                                ?>

                                <div class="service-selected-group">
                                    <div class="list-title">특이사항</div>
                                    <div class="list-data list-data-add">
                                        <?php

                                        if ($pet['dermatosis'] == 1) $dis[] = '피부병';
                                        if ($pet['heart_trouble'] == 1) $dis[] = '심장질환';
                                        if ($pet['marking'] == 1) $dis[] = '마킹';
                                        if ($pet['mounting'] == 1) $dis[] = '마운팅';

                                        $is_dis = implode(",",$dis);

                                        echo ($is_dis)?$is_dis:'';
                                        ?>
                                    </div>
                                </div>
                                <div class="service-selected-group">
                                    <div class="list-title">기타</div>
                                    <div class="list-data list-data-add"><?php echo $pet['etc'];?></div>
                                </div>
                            </div>
                        </div>
                        <div class="basic-data-group vmiddle">
                            <div class="form-group">
                                <div class="form-group-cell middle">
                                    <div class="form-group-item">
                                        <div class="form-item-label mg-bt-12">특이사항<span class="form-input-info">(고객에게는 노출되지 않습니다.)</span></div>
                                        <div class="form-item-data">
                                            <textarea name="etc_memo" id="etc_memo" cols="30" rows="10"><?php echo $pay['etc_memo'];?></textarea>

                                        </div>
                                        <div class="form-item-data type-8">
                                            <button type="button" class="pc-mg-bt-20 btn btn-outline-purple btn-middle-size btn-round save-etc1" data-seq="<?php echo $payment_log_seq;?>">저장</button>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                <!-- //예약동물 정보 -->

                <!--이전 특이사항 -->
                <?php
                $this_time = date('Y-m-d',strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day']));
                $ct = 0;
                $sql = "
                                    SELECT *
                                    FROM tb_payment_log 
                                    WHERE artist_id = '" . $user_id . "' 
                                        AND is_no_show = 0 
                                        AND is_cancel = 0 
                                        AND is_cancel = 0
                                        AND approval = 1
                                        AND etc_memo != ''
                                        AND pet_seq = '{$pay["pet_seq"]}'   
                                        AND DATE_FORMAT(CONCAT(year,'-',month,'-',DAY),'%Y-%m-%d') < DATE_FORMAT('".$this_time."','%Y-%m-%d') 
                                        ORDER BY  CONCAT(year,'-',month,'-',day) DESC
                                ";
                //echo $sql;
                $arr = sql_fetch_array($sql);
                if(count($arr)>0){
                    ?>

                    <div class="basic-data-group" id="prev_cmt">

                        <div class="con-title-group con-title-group-add">
                            <h4 class="con-title">이전 특이사항</h4>
                        </div>
                        <div class="special-note-list">
                            <?php
                            foreach($arr as $rs){
                                ?>
                                <div class="special-note special-cmt special-note-border special-note-add" style="display: <?php echo ($ct<4)?'block':'none';?>">
                                    <div class="note-desc"><em><?php echo $rs['year'].'.'.$rs['month'].'.'.$rs['day'];?></em><div class="txt"><?php echo $rs['etc_memo'];?></div></div>
                                </div>
                                <?php $ct++;} ?>
                        </div>
                        <?php if($ct>5){ ?>
                            <div class="basic-data-group vmiddle">
                                <!-- 더보기 활성화시 닫기로 텍스트 변경 필요 -->
                                <button type="button" class="btn btn-middle-size btn-round btn-outline-purple border-1 view-special-cmt btn-border-view-special-cmt">더보기</button>
                            </div>
                        <?php } ?>
                    </div>
                <?php } ?>

                <!-- 이전 미용 -->
                <?php
                //echo $que;
                $que = "SELECT * FROM tb_payment_log WHERE pet_seq = {$pay['pet_seq']} AND artist_id = '{$artist_id}' AND cellphone = '{$pay['cellphone']}' AND is_no_show = 0 AND data_delete = 0 AND is_cancel = 0 AND approval = 1 AND DATE_FORMAT(CONCAT(year,'-',month,'-',DAY),'%Y-%m-%d') < DATE_FORMAT('".$this_time."','%Y-%m-%d') ORDER BY  CONCAT(year,'-',month,'-',day) DESC  ";
                $arr = sql_fetch_array($que);
                if(count($arr)>0) {
                    foreach ($arr as $arr) {
                        $data['total_payment'][] = $arr;
                    }
                }

                if (count($data["total_payment"]) > 0) {
                    ?>

                    <div class="basic-data-group">
                        <div class="con-title-group con-title-group-add">
                            <h4 class="con-title">이전 미용</h4>
                        </div>
                        <div class="memo-item-list">


                            <?php
                            $tp_cnt = 0;
                            for($k=0;$k<count($data["total_payment"]);$k++){
                                $date = $data["total_payment"][$k]['year'].'-'.$data["total_payment"][$k]['month'].'-'.$data["total_payment"][$k]['day'];
                                $prev_beauty = explode("|",$data["total_payment"][$k]['product']);
                                $kg = explode(":",$prev_beauty[5]);
                                $tp_cnt++;




                                ?>
                                <div class="memo-item memo-item-border memo-item-add memo-item-add2" style="display: <?php echo ($tp_cnt<5)?'block':'none !important';?>">

                                    <p class="memo-item-overflow" style="max-width:250px;" ><?php echo date('Y.m.d',strtotime($date));?>  <?php echo $data["pet"]["name"];?>  / <?php echo $prev_beauty[4];?> / <?php echo $kg[0];?>Kg / <?php echo number_format($data["total_payment"][$k]['local_price'] + $data["total_payment"][$k]['local_price_cash']);?>원</p>
                                    <a href="reserve_pay_management_2?payment_log_seq=<?php echo $data["total_payment"][$k]['payment_log_seq']?>" class="memo-detail-wrap">
                                        <span class="memo-detail">상세보기</span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="5.207" height="9.414" viewBox="0 0 5.207 9.414">
                                            <path data-name="Path" d="m-4 8 4-4-4-4" transform="translate(4.707 .707)" style="fill:none;stroke:#202020;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;"/>
                                        </svg>
                                    </a>
                                </div>
                                <?php }?>
                        </div>
                        <?php if($tp_cnt>5){ ?>
                            <div class="basic-data-group vmiddle">
                                <button type="button" class="btn btn-middle-size btn-round btn-outline-purple view-prev-beauty">더보기</button>
                            </div>
                        <?php } ?>
                    </div>
                <?php } ?>


                <div class="basic-data-group">
                    <div class="con-title-group con-title-group-add">
                        <h4 class="con-title">예약 내용</h4>
                        <button type="button" onclick="location.href='reserve_alarm_inquiry?payment_log_seq=<?=$payment_log_seq?>&cellphone=<?=$pay['cellphone']?>&pet_name=<?=$pet['name']?>'" class="btn-side btn btn-msmall-size btn-inline btn-border-radius-16 btn-bg-yellow">알림톡 발송 이력</button>

                    </div>
                    <div class="text-list-wrap type-2 text-list-wrap-add">
                        <div class="text-list-cell"><div class="item-title unit">날짜</div><div class="item-data"><?php echo date('Y.m.d',strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day']));?></div></div>
                        <div class="text-list-cell"><div class="item-title unit">선생님</div><div class="item-data"><?php echo $ar[0]['nicname'];?></div></div>
                        <div class="text-list-cell">
                            <div class="item-title unit align-self-center">시간</div>
                            <div class="item-data">
                                <div class="form-datepicker-group">
                                    <div class="form-datepicker">
                                        <select name="from_time" id="from_time">
                                            <?php

                                            $from_time_sql = "
                                                SELECT * FROM (
                                                    SELECT to_hour end_hour, to_minute end_minute FROM tb_payment_log WHERE artist_id = '".$artist_id."'
                                                    AND worker = '".$pay['worker']."' AND is_cancel = '0'
                                                    AND YEAR = ".$pay['year']." AND MONTH = ".$pay['month']." AND DAY = ".$pay['day']."
                                                    UNION
                                                    SELECT end_hour, end_minute FROM tb_private_holiday WHERE customer_id = '".$artist_id."'
                                                    AND worker = '".$pay['worker']."'
                                                    AND start_YEAR = ".$pay['year']." AND start_MONTH = ".$pay['month']." AND start_DAY = ".$pay['day']."
                                                    AND end_MONTH = ".$pay['month']." AND end_DAY = ".$pay['day']."
                                                ) a
                                                    WHERE time_format(CONCAT(a.end_hour,':',a.end_minute),'%H:%i') <= TIME_FORMAT('".$pay['hour'].':'.$pay['minute']."','%H:%i')
                                                    ORDER BY time_format(CONCAT(a.end_hour,':',a.end_minute),'%H:%i') DESC
                                                    LIMIT 1
                                            ";
                                            $from_time_result = sql_query($from_time_sql);
                                            $from_time_row = sql_fetch($from_time_result);
                                            $from_hour = (count($from_time_row)>0&&$from_time_row['end_hour']<10)?'0'.$from_time_row['end_hour']:$from_time_row['end_hour'];
                                            $from_minute = (count($from_time_row)>0&&$from_time_row['end_minute']<10)?'0'.$from_time_row['end_minute']:$from_time_row['end_minute'];

                                            // 뒤 타임 미용 및 휴무 있는지 확인
                                            $to_time_sql = "
                                                SELECT * FROM (
                                                    SELECT hour start_hour, minute start_minute FROM tb_payment_log WHERE artist_id = '".$artist_id."'
                                                    AND worker = '".$pay['worker']."' AND is_cancel = '0'
                                                    AND YEAR = ".$pay['year']." AND MONTH = ".$pay['month']." AND DAY = ".$pay['day']."
                                                    UNION
                                                    SELECT start_hour, start_minute FROM tb_private_holiday WHERE customer_id = '".$artist_id."'
                                                    AND worker = '".$pay['worker']."'
                                                    AND start_YEAR = ".$pay['year']." AND start_MONTH = ".$pay['month']." AND start_DAY = ".$pay['day']."
                                                    AND end_MONTH = ".$pay['month']." AND end_DAY = ".$pay['day']."
                                                ) a
                                                    WHERE time_format(CONCAT(a.start_hour,':',a.start_minute),'%H:%i') > TIME_FORMAT('".$pay['hour'].':'.$pay['minute']."','%H:%i')
                                                    ORDER BY time_format(CONCAT(a.start_hour,':',a.start_minute),'%H:%i')
                                                    LIMIT 1
                                            ";
                                            $to_time_result = sql_query($to_time_sql);
                                            $to_time_row = sql_fetch($to_time_result);
                                            $to_hour = (count($to_time_row)>0&&$to_time_row['start_hour']<10)?'0'.$to_time_row['start_hour']:$to_time_row['start_hour'];
                                            $to_minute = (count($to_time_row)>0&&$to_time_row['start_minute']<10)?'0'.$to_time_row['start_minute']:$to_time_row['start_minute'];


                                            $workDate = date('Y-m-d',strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day']));
                                            $start_time = $ar[0]['time_start'];
                                            $end_time = $ar[0]['time_end'];
                                            //$start_date = $workDate.' '.$start_time.':00';
                                            //$end_date = $workDate.' '.$end_time.':00';
                                            $start_date = ($from_hour)? $workDate.' '.$from_hour.':'.$from_minute : $workDate.' '.$start_time.':00';
                                            $end_date = ($to_minute)? $workDate.' '.$to_hour.':'.$to_minute : $workDate.' '.$end_time.':00';
                                            $rev_date = strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day'].' '.$pay['hour'].':'.$pay['minute']);
                                            for($i=strtotime($start_date);$i<=(strtotime($end_date)-1800);$i+=1800){
                                                ?>
                                                <option value="<?php echo $i;?>" <?php echo ($i == $rev_date)?'selected':''; ?>><?php echo date('H:i',$i);?></option>
                                            <?php } ?>
                                        </select>
                                    </div>
                                    <div class="form-unit">~</div>
                                    <div class="form-datepicker">
                                        <select name="to_time" id="to_time">
                                            <?php
                                            //$workDate = date('Y-m-d',strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day']));
                                            //$start_time = $ar[0]['time_start'];
                                            //$end_time = $ar[0]['time_end'];
                                            //$start_date = $workDate.' '.$start_time.':00';
                                            //$end_date = $workDate.' '.$end_time.':00';
                                            $rev_date = strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day'].' '.$pay['to_hour'].':'.$pay['to_minute']);
                                            for($i=(strtotime($start_date)+1800);$i<=strtotime($end_date);$i+=1800){
                                                ?>
                                                <option value="<?php echo $i;?>" <?php echo ($i == $rev_date)?'selected':''; ?>><?php echo date('H:i',$i);?></option>
                                            <?php } ?>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="basic-data-group vsmall"><button type="button" class="btn btn-outline-gray btn-middle-size btn-round only-change-time" data-seq="<?php echo $pay['payment_log_seq'];?>">시간만 변경</button></div>
                        <div class="form-bottom-info" style="font-size:13px !important;">*시간 변경만 하는 경우 시간선택 후 변경을 눌러주세요.</div>
                    </div>






                </div>



                <div class="basic-data-group vmiddle">
                    <div class="grid-layout btn-grid-group">
                        <div class="grid-layout-inner pc-mg-bt-20">
                            <div class="grid-layout-cell grid-2"><button type="button" class="btn btn-outline-purple btn-middle-size btn-round change-rev" data-status="<?php echo $pay['status'];?>">날짜/미용사 변경</button></div>
                            <div class="grid-layout-cell grid-2"><button type="button" class="btn btn-outline-purple btn-middle-size btn-round cancel-rev" data-seq="<?php echo $pay['payment_log_seq'];?>" data-status="<?php echo $pay['status'];?>" data-cid="<?php echo $cus['id'];?>" data-tid="<?php echo $cus['tmp_seq'];?>">예약 취소</button></div>
                        </div>
                    </div>
                </div>
            </div>
            <form action="change_payment_log_endtime.php" id="shop_form" method="POST">
                <input type="hidden" name="payment_log_seq" value="<?= $payment_log_seq ?>" />
                <input type="hidden" id="history_seq" name="history_seq" />
                <input type="hidden" id="is_coupon" name="is_coupon" value="" />
                <input type="hidden" name="pet_type" value="<?php echo $pet['type']; ?>" />
                <input type="hidden" name="pet_weight" value="<?php echo $pet['weight']; ?>" />
                <input type="hidden" name="reserve_point" value="" />
                <input type="hidden" name="discount_price" value="<?=$shop_history ?>" />
                <input type="hidden" name="discount_num" value="<?=$discount_num ?>" />
                <input type="hidden" name="discount_type" value="<?=$discount_type ?>" />
                <div class="basic-data-group">
                    <div class="con-title-group con-title-group-add">
                        <h4 class="con-title">미용 종료 알림 발송</h4>
                    </div>
                    <div class="basic-data-group vvsmall">
                        <div class="grid-layout basic">
                            <div class="grid-layout-inner">
                                <div class="grid-layout-cell grid-4"><label class="form-toggle-box block"><input type="radio" name="time1" class="timer" id="timer_0" value="y" ><em>지금종료</em></label></div>
                                <div class="grid-layout-cell grid-4"><label class="form-toggle-box block"><input type="radio" name="time1" class="timer" id="timer_10" value="10" ><em>10분전</em></label></div>
                                <div class="grid-layout-cell grid-4"><label class="form-toggle-box block"><input type="radio" name="time1" class="timer" id="timer_15" value="15" ><em>15분전</em></label></div>
                                <div class="grid-layout-cell grid-4"><label class="form-toggle-box block"><input type="radio" name="time1" class="timer" id="timer_20" value="20" ><em>20분전</em></label></div>
                                <div class="grid-layout-cell grid-4"><label class="form-toggle-box block"><input type="radio" name="time1" class="timer" id="timer_30" value="30" ><em>30분전</em></label></div>
                            </div>
                        </div>
                    </div>
                    <div class="form-bottom-info" style="font-size:13px !important;">*시간 선택 후 발송을 누르면 견주에게 즉시알림이 발송됩니다.</div>
                    <div class="basic-data-group vvsmall3">
                        <div class="grid-layout btn-grid-group">
                            <div class="grid-layout-inner">
                                <div class="grid-layout-cell grid-2"><button type="button" class="btn btn-outline-gray btn-middle-size btn-round" onclick="popalert.open('talkExam');">예시보기</button></div>
                                <div class="grid-layout-cell grid-2"><button type="button" class="btn btn-outline-purple btn-middle-size btn-round sendComplete" data-seq="<?php echo $payment_log_seq;?>">발송</button></div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!-- 서비스 정보 변경 -->
            <form action="./data/make_reservation_update" method="post" name="service_update" id="service_update" target="hiddenFrame" >
                <input type="hidden" name="backurl" value="reserve_pay_management_2?payment_log_seq=<?php echo $payment_log_seq?>">
                <input type="hidden" name="seq" value="<?php echo $payment_log_seq?>">
                <input type="hidden" name="artist_id" value="<?php echo $pay['artist_id'];?>">
                <input type="hidden" name="customer_id" value="<?php echo $cus['id'];?>">
                <input type="hidden" name="tmp_seq" value="<?php echo $cus['tmp_seq'];?>">
                <div class="basic-data-group" id="basic-data-group-target">
                    <div class="sticky-tab-group" id="sticky-tab-group-target">
                        <div class="con-title-group con-title-group-add " >
                            <h4 class="con-title">결제정보</h4>
                        </div>
                        <div class="wide-tab receipt-wide-tab">
                            <div class="receipt-wide-tab-wrap">
                                <div class="wide-tab-inner receipt-wide-tab-inner">
                                    <!-- 활성화시 actived클래스 추가 -->
                                    <!-- 변경사항 있을 경우 hit클래스 추가 -->
                                    <div class="tab-cell hit actived" ><a href="#basic-data-group-target"><button type="button"  class="btn-tab-item" id="tab1"><span>기본 서비스</span></button></a></div>
                                    <div class="tab-cell "><a href="#basic-data-group-target"><button type="button" class="btn-tab-item" id="tab2"><span>추가</span></button></a></div>
                                    <div class="tab-cell" ><a href="#basic-data-group-target"><button type="button" class="btn-tab-item" id="tab3"><span>쿠폰상품</span></button></a></div>
                                    <div class="tab-cell" ><a href="#basic-data-group-target"><button type="button" class="btn-tab-item" id="tab4"><span>제품</span></button></a></div>
                                </div>
                            </div>


                        </div>
                    </div>
                    <div class="basic-data-group vmiddle tab-data-group">
                        <!-- tab-data-cell 클래스에 actived클래스 추가시 활성화
                        기본 서비스 -->
                        <?php if($pet['type']=='dog'){ ?>
                            <div class="tab-data-cell actived">
                                <div class="basic-data-group vmiddle">
                                    <div class="form-group">
                                        <div class="form-group-cell middle grid-5-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01"  id="service_tab">크기</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir">
                                                            <div class="grid-layout-cell"><label class="form-toggle-box middle" for="size1"><input type="radio" name="size" class="pet-size" id="size1"><em>선택안함</em></label></div>
                                                            <?php
                                                            $que = "SELECT *,
                                                                        if(second_type = '소형견미용', 1, 
                                                                            if(second_type = '중형견미용', 2, 
                                                                                if(second_type = '대형견미용', 3, 
                                                                                    if(second_type = '특수견미용', 4,
                                                                                        if(second_type = '기타공통', 5, 9)
                                                                                )
                                                                            )
                                                                        )
                                                                    ) AS sort 
                                                                    FROM tb_product_dog_static 
                                                                    WHERE customer_id = '{$user_id}' AND first_type = '개' #AND (second_type IN ('소형견미용','중형견미용','대형견미용','특수견미용') OR direct_title != '') AND second_type != '기타공통'  ORDER BY sort ASC, update_time
                                                                    AND second_type != '기타공통'
                                                                    ORDER BY sort ASC, update_time
                                                                   ";
                                                            //echo $que;
                                                            $arr = sql_fetch_array($que);
                                                            if (count($arr) > 0) {
                                                                foreach ($arr as $rs) {

                                                                    $second_type = ($rs['direct_title']!='')?$rs['direct_title']:$rs['second_type'];
                                                                    ?>

                                                                    <div class="grid-layout-cell">
                                                                        <label class="form-toggle-box middle" for="size2">
                                                                            <input type="radio" name="size" id="size2" class="pet-size" value="<?php echo ($rs['direct_title']!='')?$rs['direct_title']:$rs['second_type'];?>" <?php echo ($second_type==$beauty_info[3])?'checked':'';?>><em><?php echo ($rs['direct_title']!='')?$rs['direct_title']:$rs['second_type'];?></em>
                                                                        </label>
                                                                    </div>
                                                                <?php }} ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group-cell middle grid-5-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">서비스</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir" id="service_list">
                                                            <div class="grid-layout-cell"><label class="form-toggle-box middle" for="service1"><input type="radio" name="service" class="service-type" id="service1"><em>선택안함</em></label></div>
                                                            <?php

                                                            $cnt = $disp_cnt = 0;
                                                            $dog_product_title = array();
                                                            $option_name = array('bath_price','part_price','bath_part_price','sanitation_price','sanitation_bath_price','all_price','spoting_price','scissors_price','summercut_price');
                                                            $dog_product_arr = array(
                                                                "무게",
                                                                "목욕",
                                                                "부분미용",
                                                                "부분+목욕",
                                                                "위생",
                                                                "위생+목욕",
                                                                "전체미용",
                                                                "스포팅",
                                                                "가위컷",
                                                                "썸머컷"
                                                            );
                                                            $dog_product_seq = array(
                                                                "목욕"         =>'bath',
                                                                "부분미용"      =>'part',
                                                                "부분+목욕"     =>'bath_part',
                                                                "위생"         =>'sanitation',
                                                                "위생+목욕"    =>'sanitation_bath',
                                                                "전체미용"     =>'all',
                                                                "스포팅"      =>'spoting',
                                                                "가위컷"      =>'scissors',
                                                                "썸머컷"       =>'summercut'
                                                            );
                                                            $beauty = 1;
                                                            $productWorkTimeTitle = array("목욕", "부분미용", "부분+목욕", "위생", "위생+목욕","전체미용", "스포팅", "가위컷", "썸머컷");
                                                            $que = "SELECT * FROM tb_product_dog_worktime WHERE artist_id = '{$user_id}' ";
                                                            $res = sql_query($que);
                                                            $rows = sql_fetch($res);
                                                            for($i=0;$i<14;$i++){
                                                                if(!empty($rows['worktime'.$i.'_disp_yn'] == 'y')){
                                                                    if($i<10){
                                                                        array_push($dog_product_title, $dog_product_arr[$i]);
                                                                    } else {
                                                                        if(!empty($rows['worktime'.$i.'_title'])) {
                                                                            $dog_product_seq[$rows['worktime' . $i . '_title']] = 'beauty' . $beauty;
                                                                            $option_name[] = 'beauty' . $beauty . "_price";
                                                                            array_push($dog_product_title, $rows['worktime' . ($i+1) . '_title']);
                                                                            $beauty++;
                                                                        }
                                                                    }
                                                                }
                                                                //print_r($dog_product_title);
                                                                if($i<9) {

                                                                    if ($rows['worktime' . ($i + 1) . '_disp_yn'] == 'y' && !empty($rows['worktime' . ($i + 1)]) && !empty($productWorkTimeTitle[$i])) {
                                                                        $worktime['title'][] = $productWorkTimeTitle[$i];
                                                                        $worktime['time'][] = $rows['worktime' . ($i + 1)];
                                                                    }
                                                                } else if($i>8){
                                                                    if ($rows['worktime' . ($i + 1) . '_disp_yn'] == 'y' && !empty($rows['worktime' . ($i + 1).'_title']) ) {
                                                                        $worktime['title'][] = $rows['worktime' . ($i + 1).'_title'];
                                                                        $worktime['time'][] = $rows['worktime' . ($i + 1)];
                                                                    }
                                                                }
                                                            }

                                                            for($i=0;$i<count($worktime['title']);$i++){
                                                                $que_main = "SELECT * FROM tb_product_dog_static
                                                            WHERE customer_id = '{$user_id}' AND first_type = '개' AND (second_type = '{$beauty_info[3]}' OR direct_title = '{$beauty_info[3]}')
                                                            AND ".$dog_product_seq[$worktime['title'][$i]]."_price != ''
                                                        ";

                                                                //echo $que;
                                                                $res_main = sql_query($que_main);
                                                                $row_main = sql_fetch($res_main);
                                                                if(count($row_main)>0){
                                                                    ?>
                                                                    <div class="grid-layout-cell">
                                                                        <label class="form-toggle-box middle" for="service2">
                                                                            <input type="radio" name="service" class="service-type" data-time="<?php echo strtotime($pay['year'].'-'.$pay['month'].'-'.$pay['day'].' '.$pay['hour'].':'.$pay['minute'].' +'.$worktime['time'][$i].' minute');?>" data-time="<?php echo $worktime['time'][$i];?>" value="<?php echo $dog_product_seq[$worktime['title'][$i]].'_price';?>" <?php echo ($worktime['title'][$i] == $beauty_info[4])?'checked':''; ?>>
                                                                            <em><?php echo $worktime['title'][$i];?><br><?php echo $worktime['time'][$i];?>분</em>
                                                                        </label>
                                                                    </div>
                                                                <?php }} ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group-cell middle is-dog grid-5-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">무게</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir" id="kgs_list">
                                                            <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="weight1"><input type="radio" name="weight" id="weight1" checked><em><span>선택안함</span><strong>0원</strong></em></label></div>
                                                            <?php
                                                            $que = "SELECT * FROM tb_product_dog_worktime WHERE artist_id = '{$user_id}' ";
                                                            //echo $que;
                                                            $res = mysqli_query($connection, $que);
                                                            $row = mysqli_fetch_assoc($res);
                                                            for ($i = 1; $i <= 14; $i++) {
                                                                if (!empty($row['worktime' . $i . '_disp_yn'] == 'y')) {
                                                                    if ($i < 10) {
                                                                        array_push($dog_product_title, $dog_product_arr[$i]);
                                                                    } else {
                                                                        if (!empty($row['worktime' . $i . '_title'])) {
                                                                            $dog_product_seq[$row['worktime' . $i . '_title']] = 'beauty' . $beauty;
                                                                            $option_name[] = 'beauty' . $beauty . "_price";
                                                                            array_push($dog_product_title, $row['worktime' . $i . '_title']);
                                                                            $beauty++;
                                                                        }
                                                                    }
                                                                }
                                                            }

                                                            //print_r($option_name);
                                                            if($_POST['petType'] == 'dog')  $petType = '개';
                                                            if($_POST['petType'] == 'cat')  $petType = '고양이';
                                                            $que = "SELECT * FROM tb_product_dog_static 
                                                            WHERE customer_id = '{$user_id}' AND first_type = '개' AND (second_type = '{$beauty_info[3]}' OR direct_title = '{$beauty_info[3]}') ";

                                                            //echo $que;
                                                            $res = sql_query($que);
                                                            $row = sql_fetch($res);
                                                            //무게

                                                            $tmp = $dog_product_seq[$beauty_info[4]];
                                                            for($j=0;$j<count($option_name);$j++){

                                                                if($tmp.'_price' == $option_name[$j]){
                                                                    $sv[] = explode(",",$row[$tmp.'_price']);
                                                                    $cl[] = explode(",",$row['is_consult_'.$tmp[0]]);
                                                                }
                                                            }

                                                            $kgs = explode(",",$row['kgs']);
                                                            $plus_kgs_first = 0;
                                                            $plus_kgs_price_first = 0;
                                                            for($i=0;$i<count($kgs);$i++){
                                                                $pr1 = ($cl[0][$i]==1)?'상담':$sv[0][$i];
                                                                $pr = ($cl[0][$i]==1)?'상담':number_format($sv[0][$i]).'원';
                                                                ?>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="weight2">
                                                                        <input type="radio" name="weight" id="weight2" <?php echo ($beauty_info[5]==$kgs[$i].':'.$pr1)?'checked':'';?> class="weight" value="<?php echo $kgs[$i].':'.$pr1;?>">
                                                                        <em><span>~<?php echo $kgs[$i]?>kg</span><strong><?php echo $pr;?></strong></em>
                                                                    </label>
                                                                </div>
                                                                <?php
                                                                $plus_kgs_first = $kgs[$i];
                                                                $plus_kgs_price_first = $pr1;
                                                            }
                                                            if($row['what_over_kgs']!='' && $row['over_kgs_price'] > 0){
                                                                $weight_info = explode(":",$beauty_info[5]);
                                                                $plus_kgs = $weight_info[0];
                                                                $plus_kgs_price = $weight_info[1];
                                                                ?>
                                                                <div class="grid-layout-cell">
                                                                    <div class="form-toggle-options">
                                                                        <input type="radio" name="weight" id="weight2" class="weight_plus" value="<?php echo (($plus_kgs > $row['what_over_kgs'])? $plus_kgs : $row['what_over_kgs']).':'.$plus_kgs_price;?>" <?php echo ($weight_info[0]>$row['what_over_kgs'])? 'checked' : '';?>>
                                                                        <div class="form-toggle-options-data">
                                                                            <div class="options-labels"><span><?php echo $row['what_over_kgs'];?>kg~</span><strong>kg당<br>+<?php echo number_format($row['over_kgs_price']);?>원</strong></div>
                                                                            <div class="form-amount-input">
                                                                                <button type="button" class="btn-form-amount-minus" onclick="weight_change(<?php echo ($weight_info[0]>$row['what_over_kgs'])? $weight_info[0] : $row['what_over_kgs'];?>,<?php echo $row['over_kgs_price']; ?>,'m');">감소</button>
                                                                                <div class="form-amount-info">
                                                                                    <!-- 20220313 수정 -->
                                                                                    <!-- readonly , disabled 속성 추가하여도 상관 없음 -->
                                                                                    <input type="number" id="weight<?php echo ($weight_info[0]>$row['what_over_kgs'])? $weight_info[0] : $row['what_over_kgs'];?>_cnt" value="<?php echo ($weight_info[0]>$row['what_over_kgs'])? $weight_info[0] : $row['what_over_kgs'];?>" class="form-amount-val">
                                                                                    <!-- //20220313 수정 -->
                                                                                </div>
                                                                                <button type="button" class="btn-form-amount-plus" onclick="weight_change(<?php echo ($weight_info[0]>$row['what_over_kgs'])? $weight_info[0] : $row['what_over_kgs'];?>,<?php echo $row['over_kgs_price']; ?>,'p');">증가</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <?php
                                                            }
                                                            ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <?php
                                        $sql = "
                                            SELECT * 
                                            FROM tb_product_dog_common
                                            WHERE customer_id = '".$user_id."'
                                        ";

                                        $result = mysqli_query($connection, $sql);
                                        while($row = mysqli_fetch_assoc($result)){
                                            $data["product_dog_common"][] = $row;
                                        }

                                        $sql_option = "
                                    SELECT *
                                    FROM tb_product_common_option
                                    WHERE customer_id = '".$user_id."'
                                ";
                                        $result_option = mysqli_query($connection, $sql_option);
                                        while($row_option = mysqli_fetch_assoc($result_option)){
                                            $data["bath_option_list"][] = $row_option;
                                        }

                                        if($data["product_dog_common"][0]['short_hair_price']>0 || $data["product_dog_common"][0]['long_hair_price']>0 || $data["product_dog_common"][0]['double_hair_price'] || count($data['bath_option_list']) > 0){

                                            //$bath = explode(":",$beauty_info[8]);
                                            // 털특징별 상품
                                            $bath_array = explode(",",$beauty_info[8]);
                                            // 중복선택이 가능하니 배열 구하기
                                            for($j=0;$j<count($bath_array);$j++) {
                                                $bath[] = explode(":", $bath_array[$j])[0];
                                            }

                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">털특징</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">

                                                                <?php if($data["product_dog_common"][0]['short_hair_price']>0){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="hair_type[]" class="extra-hair_type" <?php echo (in_array('단모_목욕', $bath))?'checked':'';?> value="단모_목욕:<?php echo $data["product_dog_common"][0]['short_hair_price'];?>" id="leg1"><em>
                                                                                <span>단모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['short_hair_price']);?>원</strong></em>
                                                                        </label>
                                                                    </div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['long_hair_price']>0){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="hair_type[]" class="extra-hair_type" <?php echo (in_array('장모_목욕', $bath))?'checked':'';?> value="장모_목욕:<?php echo $data["product_dog_common"][0]['long_hair_price'];?>" id="leg1"><em>
                                                                                <span>장모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['long_hair_price']);?>원</strong></em>
                                                                        </label>
                                                                    </div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['double_hair_price']>0){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="hair_type[]" class="extra-hair_type" <?php echo (in_array('이중모_목욕', $bath))?'checked':'';?> value="이중모_목욕:<?php echo $data["product_dog_common"][0]['double_hair_price'];?>" id="leg1"><em>
                                                                                <span>이중모_목욕</span><strong>+<?php echo number_format($data["product_dog_common"][0]['double_hair_price']);?>원</strong></em>
                                                                        </label>
                                                                    </div>
                                                                <?php } ?>
                                                                <?php
                                                                /*$sql_option = "
                                                                                    SELECT *
                                                                                    FROM tb_product_common_option
                                                                                    WHERE customer_id = '".$user_id."'
                                                                                ";
                                                                $result_option = mysqli_query($connection, $sql_option);
                                                                while($row_option = mysqli_fetch_assoc($result_option)){
                                                                    $data["bath_option_list"][] = $row_option;
                                                                }*/
                                                                for($i=0;$i<count($data['bath_option_list']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="hair_type[]" class="extra-hair-type" <?php echo (in_array($data['bath_option_list'][$i]['title'], $bath))?'checked':'';?> value="<?php echo $data['bath_option_list'][$i]['title'];?>:<?php echo $data['bath_option_list'][$i]['price'];?>" id="leg1"><em><span><?php echo $data['bath_option_list'][$i]['title'];?></span><strong>+<?php echo number_format($data['bath_option_list'][$i]['price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                        <?php
                                        if($data["product_dog_common"][0]['beauty_length_1']>0 || $data["product_dog_common"][0]['beauty_length_2']>0 || $data["product_dog_common"][0]['beauty_length_3']>0 || $data["product_dog_common"][0]['beauty_length_4']>0 || $data["product_dog_common"][0]['beauty_length_5']>0){
                                            $hair1 = explode(":",$beauty_info[7]);
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">털길이</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="weight1"><input type="radio" name="hair_length" value = "" checked><em><span>선택안함</span><strong>0원</strong></em></label></div>
                                                                <?php
                                                                for($i=1; $i<=5; $i++){
                                                                    if($data["product_dog_common"][0]['beauty_length_'.$i]){
                                                                        ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                                <input type="radio" name="hair_length" id="leg1" class="extra-hair-length" <?php echo ($data["product_dog_common"][0]['beauty_length_'.$i.'_price'] == $hair1[1])?'checked':'';?> value="<?php echo $data["product_dog_common"][0]['beauty_length_'.$i];?>:<?php echo $data["product_dog_common"][0]['beauty_length_'.$i.'_price'];?>">
                                                                                <em><span><?php echo $data["product_dog_common"][0]['beauty_length_'.$i];?>mm</span><strong>+<?php echo number_format($data["product_dog_common"][0]['beauty_length_'.$i.'_price']);?>원</strong></em>
                                                                            </label>
                                                                        </div>
                                                                        <?php
                                                                    }
                                                                }
                                                                $face = split_text($data["product_dog_common"][0]['hair_length_product']);
                                                                if(count($face)>0){
                                                                    for($i=0;$i<count($face['name']);$i++){
                                                                        ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                                <input type="radio" name="hair_length" id="leg1" class="extra-hair-length" <?php echo ($face['price'][$i] == $hair1[1])?'checked':'';?> value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>">
                                                                                <em><span><?php echo $face['name'][$i];?>mm</span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em>
                                                                            </label>
                                                                        </div>
                                                                        <?php
                                                                    }
                                                                }
                                                                ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                    </div>
                                    <!--<div class="basic-data-group middle">
                                        <a href="javascript:;" class="btn btn-outline-purple btn-round btn-middle-size update-service-btn">변경</a>
                                    </div>-->
                                </div>
                            </div>
                            <!-- //기본 서비스 -->
                            <!-- 추가 -->
                            <div class="tab-data-cell">
                                <div class="accordion-content">
                                    <div class="form-group">
                                        <?php
                                        if($data["product_dog_common"][0]['basic_face_price'] > 0 || $data["product_dog_common"][0]['broccoli_price'] > 0 || $data["product_dog_common"][0]['highba_price'] > 0 || $data["product_dog_common"][0]['bear_price'] > 0 ) {

                                            $hair = explode(":",$beauty_info[6]);
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">얼굴컷</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input  type="radio" name="face" id="face0"  value="" class="extra-face" checked><em><span>선택안함</span><strong>+0원</strong></em></label></div>
                                                                <?php if($data["product_dog_common"][0]['basic_face_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face1"><input type="radio" name="face" id="face1" <?php echo ($hair[0]=='기본얼굴컷')?'checked':'';?> value="기본얼굴컷:<?php echo $data["product_dog_common"][0]['basic_face_price'];?>" class="extra-face"><em><span>기본얼굴컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['basic_face_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['broccoli_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face2"><input type="radio" name="face" id="face2" <?php echo ($hair[0]=='브로콜리컷')?'checked':'';?> value="브로콜리컷:<?php echo $data["product_dog_common"][0]['broccoli_price'];?>" class="extra-face"><em><span>브로콜리컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['broccoli_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['highba_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face3"><input type="radio" name="face" id="face3" <?php echo ($hair[0]=='하이바컷')?'checked':'';?> value="하이바컷:<?php echo $data["product_dog_common"][0]['highba_price'];?>" class="extra-face"><em><span>하이바컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['highba_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['bear_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face4"><input type="radio" name="face" id="face4" <?php echo ($hair[0]=='곰돌이컷')?'checked':'';?> value="곰돌이컷:<?php echo $data["product_dog_common"][0]['bear_price'];?>" class="extra-face"><em><span>곰돌이컷</span><strong>+<?php echo number_format($data["product_dog_common"][0]['bear_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php
                                                                $face = split_text($data["product_dog_common"][0]['addition_face_product']);
                                                                if($face['name']>0){
                                                                    for($i=0;$i<count($face['name']);$i++){
                                                                        ?>
                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="face5"><input type="radio" name="face" id="face5" <?php echo ($hair[0]==$face['name'][$i])?'checked':'';?> value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                    <?php }} ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>

                                        <?php

                                        ?>

                                        <div class="form-group-cell middle grid-5-add">
                                            <?php
                                            $face = split_text($data["product_dog_common"][0]['addition_option_product']);
                                            if((count($face)>0 && !empty($face['name'][0])) || $data["product_dog_common"][0]['toenail_price'] != '' || $data["product_dog_common"][0]['trumpet_etc_price'] != '' || $data["product_dog_common"][0]['bell_price'] != ''){
                                                ?>
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">다리</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php if($data["product_dog_common"][0]['toenail_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1"><input type="checkbox" name="leg[]" class="extra-leg" <?php echo ($beauty_info[9]>0)?'checked':'';?> value="발톱:<?php echo $data["product_dog_common"][0]['toenail_price'];?>" id="leg1"><em><span>발톱</span><strong>+<?php echo number_format($data["product_dog_common"][0]['toenail_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['trumpet_etc_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg2"><input type="checkbox" name="leg[]" class="extra-leg" <?php echo ($beauty_info[10]>0)?'checked':'';?> value="장화:<?php echo $data["product_dog_common"][0]['trumpet_etc_price'];?>" id="leg2"><em><span>장화</span><strong>+<?php echo number_format($data["product_dog_common"][0]['trumpet_etc_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php if($data["product_dog_common"][0]['bell_price'] != ''){ ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg3"><input type="checkbox" name="leg[]" class="extra-leg" <?php echo ($beauty_info[11]>0)?'checked':'';?> value="방울:<?php echo $data["product_dog_common"][0]['bell_price'];?>" id="leg3"><em><span>방울</span><strong>+<?php echo number_format($data["product_dog_common"][0]['bell_price']);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                                <?php

                                                                $leg = split_text($data["product_dog_common"][0]['addition_option_product']);
                                                                if (count($leg) > 0 && !empty($leg['name'][0])){
//                                                    print_r($leg);

                                                                    $a = 15;
                                                                    for($i=0;$i<$beauty_info[14];$i++){
                                                                        $tmp_chk[] = $beauty_info[($a+$i)];
                                                                    }

                                                                    for($i=0;$i<count($leg['name']);$i++){
                                                                        ?>

                                                                        <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                                <input type="checkbox" name="leg[]" class="extra-leg" id="leg1" <?php echo (in_array($leg['name'][$i].':'.$leg['price'][$i],$tmp_chk))?'checked':'';?> value="<?php echo $leg['name'][$i];?>:<?php echo $leg['price'][$i];?>"><em><span><?php echo $leg['name'][$i];?></span><strong>+<?php echo number_format($leg['price'][$i]);?>원</strong></em></label></div>
                                                                    <?php } ?>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            <?php } ?>
                                        </div>
                                        <?php

                                        unset($face);
                                        unset($tmp_chk);
                                        $face = split_text($data["product_dog_common"][0]['spa_option_product']);
                                        $spa_start = 14+($beauty_info[14]+1);
                                        if(count($face)>0 && !empty($face['name'][0])){

                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">스파</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                $a = $spa_start+1;
                                                                for($i=0;$i<$beauty_info[$spa_start];$i++){
                                                                    $tmp_chk[] = $beauty_info[($a+$i)];
                                                                }

                                                                for($i=0;$i<count($face['name']);$i++) {
                                                                    ?>

                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="spa[]"  class="extra-spa" id="leg1" <?php echo (in_array($face['name'][$i].':'.$face['price'][$i],$tmp_chk))?'checked':'';?> value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                        <?php

                                        unset($tmp_chk);
                                        $color_start = $spa_start+($beauty_info[$spa_start]+1);
                                        unset($face);
                                        $face = split_text($data["product_dog_common"][0]['dyeing_option_product']);
                                        if(count($face)>0 && !empty($face['name'][0])){
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">염색</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                $a = $color_start+1;
                                                                for($i=0;$i<$beauty_info[$color_start];$i++){
                                                                    $tmp_chk[] = $beauty_info[($a+$i)];
                                                                }
                                                                for($i=0;$i<count($face['name']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="color[]" class="extra-color" id="color2" <?php echo (in_array($face['name'][$i].':'.$face['price'][$i],$tmp_chk))?'checked':'';?>  value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                        <?php

                                        unset($tmp_chk);
                                        unset($face);
                                        $etc_start = $color_start+($beauty_info[$color_start]+1);
                                        $face = split_text($data["product_dog_common"][0]['etc_option_product']);
                                        if(count($face)>0 && !empty($face['name'][0])){
                                            ?>
                                            <div class="form-group-cell middle grid-5-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">기타</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <?php
                                                                $a = $etc_start+1;
                                                                for($i=0;$i<$beauty_info[$etc_start];$i++){
                                                                    $tmp_chk[] = $beauty_info[($a+$i)];
                                                                }

                                                                for($i=0;$i<count($face['name']);$i++){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="leg1">
                                                                            <input type="checkbox" name="etc[]" class="extra-etc" id="color2" <?php echo (in_array($face['name'][$i].':'.$face['price'][$i],$tmp_chk))?'checked':'';?>  value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>"><em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                    </div>
                                    <!--<div class="basic-data-group middle">
                                        <a href="javascript:;" class="btn btn-outline-purple btn-round btn-middle-size update-service-btn">변경</a>
                                    </div>-->
                                </div>
                            </div>
                            <!-- //추가 -->
                        <?php } else { ?>
                            <?php

                            $que = "SELECT * FROM tb_product_cat WHERE customer_id = '{$user_id}'";
                            //echo $que;
                            $res1 = sql_query($que);
                            $cat = sql_fetch($res1);
                            ?>
                            <div class="tab-data-cell actived">
                                <div class="basic-data-group vmiddle">
                                    <div class="form-group">
                                        <?php
                                        if($cat['is_use_weight']==1){
                                            $cat_sec = explode(",",$cat['section']);
                                            $serv1 = explode(':',$beauty_info[3]);
                                            ?>
                                            <div class="form-group-cell middle grid-3-add">
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">무게</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir" id="kgs_list_cat">
                                                                <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                        <input type="radio" name="cat_weight" onclick="cat_show_view('');"  value="">
                                                                        <em><span></span><strong>사용안함</strong></em></label>
                                                                </div>
                                                                <?php for($x=0;$x<count($cat_sec);$x++){ ?>
                                                                    <div class="grid-layout-cell">
                                                                        <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                            <input type="radio" name="cat_weight" onclick="cat_show_view(<?php echo $x;?>);" <?php echo ($serv1[0] == $cat_sec[$x])?'checked':'';?> value="<?php echo $cat_sec[$x];?>">
                                                                            <em><span></span><strong><?php echo $cat_sec[$x];?>kg</strong></em></label>
                                                                    </div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group-cell middle grid-3-add" >
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">미용</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell">
                                                                    <label class="form-toggle-box form-toggle-price middle" for="weight1">
                                                                        <input type="radio" name="hair_kg" checked  value="">
                                                                        <em><span>선택안함</span><strong>0원</strong></em></label>
                                                                </div>
                                                                <?php
                                                                for($x=0;$x<count($cat_sec);$x++){
                                                                    ?>
                                                                    <div class="grid-layout-cell cat-weight kg_<?php echo $x;?>" style="display:none"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                            <input type="radio" name="hair_kg" class="cat-hair-price" data-cat_hair="단모" <?php echo ($serv1[1]==$cat['short_price']*($x+1))?'checked':'';?> value="<?php echo $cat['short_price']*($x+1);?>"><em><span>단모</span><strong><?php echo number_format($cat['short_price']*($x+1));?>원</strong></em></label></div>
                                                                    <div class="grid-layout-cell cat-weight kg_<?php echo $x;?>" style="display:none"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                            <input type="radio" name="hair_kg" class="cat-hair-price" data-cat_hair="장모" <?php echo ($serv1[1]==$cat['long_price']*($x+1))?'checked':'';?> value="<?php echo $cat['long_price']*($x+1);?>"><em><span>장모</span><strong><?php echo number_format($cat['long_price']*($x+1));?>원</strong></em></label></div>
                                                                <?php } ?>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } else { ?>
                                            <!-- 고양이 선택시 -->
                                            <div class="form-group-cell middle grid-3-add" >
                                                <div class="form-group-item">
                                                    <div class="form-item-label01">미용</div>
                                                    <div class="form-item-data type-2">
                                                        <div class="grid-layout toggle-button-group">
                                                            <div class="grid-layout-inner flex-dir">
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hair1">
                                                                        <input type="radio" name="hair" value="<?php echo "단모:".$cat['short_price'];?>" data-cat_hair="단모" class="cat-hair-price" <?php echo ($beauty_info[4]=="단모:".$cat['short_price'])?'checked':'';?>><em><span>단모_미용</span><strong>+<?php echo number_format($cat['short_price']);?>원</strong></em></label></div>
                                                                <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hair2">
                                                                        <input type="radio" name="hair" value="<?php echo "장모:".$cat['long_price'];?>" data-cat_hair="장모" class="cat-hair-price" <?php echo ($beauty_info[4]=="장모:".$cat['long_price'])?'checked':'';?>><em><span>장모_미용</span><strong>+<?php echo number_format($cat['long_price']);?>원</strong></em></label></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        <?php } ?>
                                        <div class="form-group-cell middle grid-3-add" >
                                            <div class="form-group-item">
                                                <div class="form-item-label01">목욕</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir">
                                                            <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="" value="" checked ><em><span>선택안함</span><strong>0원</strong></em></label></div>
                                                            <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="단모" <?php echo ($beauty_info[6]==$cat['shower_price'])?'checked':'';?>  value="<?php echo '단모:'.$cat['shower_price'];?>"><em><span>단모</span><strong><?php echo number_format($cat['shower_price']);?>원</strong></em></label></div>
                                                            <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="hairBeauty1"><input type="radio" name="cat_bath" class="cat_bath" data-cat_bath="장모" <?php echo ($beauty_info[6]==$cat['shower_price_long'])?'checked':'';?>  value="<?php echo '장모:'.$cat['shower_price_long'];?>"><em><span>장모</span><strong><?php echo number_format($cat['shower_price_long']);?>원</strong></em></label></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-data-cell ">
                                <div class="basic-data-group vmiddle">
                                    <div class="form-group">

                                        <div class="form-group-cell middle">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">추가서비스</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner">
                                                            <div class="grid-layout-cell grid-2"><label class="form-toggle-box form-toggle-price middle" for="face1">
                                                                    <input type="radio" class="cat-etc" name="cat_toenail" value="<?php echo $cat['toenail_price'];?>" <?php echo ($beauty_info[5]==$cat['toenail_price'])?'checked':'';?> class="extra-face"><em><span>발톱</span><strong>+<?php echo number_format($cat['toenail_price']);?>원</strong></em></label></div>

                                                            <?php
                                                            $etc_start = 7;
                                                            $a = $etc_start+1;
                                                            for($i=0;$i<$beauty_info[$etc_start];$i++){
                                                                $tmp_chk = explode(":",$beauty_info[($a+$i)]);
                                                                $goods_seq[] = $tmp_chk[0];
                                                                $goods_cnt[$tmp_chk[0]] = $tmp_chk[3];
                                                            }

                                                            $face = split_text($cat['addition_option_product']);

                                                            for($i=0;$i<count($face['name']);$i++){

                                                                ?>
                                                                <div class="grid-layout-cell grid-2"><label class="form-toggle-box form-toggle-price middle" for="face5">
                                                                        <input type="checkbox" name="cat_etc[]" class="cat-etc" <?php echo (in_array($face['name'][$i],$goods_seq))?'checked':'';?> value="<?php echo $face['name'][$i];?>:<?php echo $face['price'][$i];?>">
                                                                        <em><span><?php echo $face['name'][$i];?></span><strong>+<?php echo number_format($face['price'][$i]);?>원</strong></em></label>
                                                                </div>
                                                            <?php } ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        <?php } ?>

                        <!-- 쿠폰상품 -->
                        <div class="tab-data-cell ">
                            <div class="basic-data-group middle">
                                <div class="form-group">
                                    <div class="form-group-cell middle grid-2-add">
                                        <div class="form-group-item">
                                            <div class="form-item-label01">쿠폰상품</div>
                                            <div class="form-item-data type-2">
                                                <div class="grid-layout toggle-button-group">
                                                    <div class="grid-layout-inner flex-dir">
                                                        <?php

                                                        unset($tmp_chk);
                                                        if($pet['type']=='dog') {
                                                            $gd_start = $etc_start + ($beauty_info[$etc_start] + 1);
                                                            $cp_start = $gd_start + $beauty_info[$etc_start];
                                                        } else {
                                                            $cp_start = $etc_start + ($beauty_info[$etc_start] + 1);
                                                        }
                                                        $a = $cp_start +1;
                                                        for($i=0;$i<$beauty_info[$cp_start];$i++){
                                                            $tmp_chk = explode(":",$beauty_info[($a+$i)]);
                                                            $cp_seq[] = $tmp_chk[0];
                                                            $cp_cnt[$tmp_chk[0]] = $tmp_chk[3];
                                                        }

                                                        if(count($coupon)>0){
                                                            foreach($coupon as $cp1){
                                                                if($cp1['type']=='C'){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="cp1-1">
                                                                            <input type="checkbox" name="cp[]" id="cp1-1" value="<?php echo $cp1['coupon_seq'];?>" <?php echo (in_array($cp1['coupon_seq'],$cp_seq))?'checked':'';?>><em><span><?php echo $cp1['name'];?></span><strong>+<?php echo number_format($cp1['price']);?>원</strong></em></label></div>
                                                                <?php }}} ?>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group-cell middle grid-2-add">
                                        <div class="form-group-item">
                                            <div class="form-item-label01">정액상품</div>
                                            <div class="form-item-data type-2">
                                                <div class="grid-layout toggle-button-group">
                                                    <div class="grid-layout-inner flex-dir">
                                                        <?php
                                                        if(count($coupon)>0){
                                                            foreach($coupon as $cp2){
                                                                if($cp2['type']=='F'){
                                                                    ?>
                                                                    <div class="grid-layout-cell"><label class="form-toggle-box form-toggle-price middle" for="cp1-1">
                                                                            <input type="checkbox" name="cp[]" id="cp1-1" value="<?php echo $cp2['coupon_seq'];?>" <?php echo (in_array($cp2['coupon_seq'],$cp_seq))?'checked':'';?>><em><span><?php echo $cp2['name'];?></span><strong>+1<?php echo number_format($cp2['price']);?>원</strong></em></label></div>
                                                                <?php }}} ?>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--<div class="basic-data-group middle">
                                    <a href="javascript:;" class="btn btn-outline-purple btn-round btn-middle-size update-service-btn">변경</a>
                                </div>-->
                            </div>
                        </div>
                        <!-- //쿠폰상품 -->
                        <!-- 제품 -->
                        <div class="tab-data-cell ">
                            <div class="basic-data-group vmiddle">
                                <div class="form-group">
                                    <?php
                                    //print_r($beauty_info);
                                    unset($tmp_chk);
                                    if($pet['type']=='dog') {
                                        $gd_start = $cp_start + ($beauty_info[$cp_start] + 1);
                                        $a = $gd_start + 1;
                                    } else {
                                        $gd_start = $cp_start + ($beauty_info[$cp_start] + 1);
                                        $a = $gd_start + 1;
                                    }
                                    for($i=0;$i<$beauty_info[$gd_start];$i++){
                                        $tmp_chk = explode(":",$beauty_info[($a+$i)]);
                                        $goods_seq[] = $tmp_chk[0];
                                        $goods_cnt[$tmp_chk[0]] = $tmp_chk[3];
                                    }

                                    $num = 1;
                                    $que = "SELECT * FROM tb_product_dog_etc WHERE customer_id = '{$user_id}' AND product_kind = 1";
                                    $gd1 = sql_fetch_array($que);
                                    if(count($gd1)){

                                        ?>
                                        <div class="form-group-cell middle grid-4-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">용품</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir">
                                                            <?php
                                                            foreach($gd1 as $gd1){
                                                                ?>
                                                                <input type="checkbox" name="gd_chkbox[]" value="n" id="gd_chkbox_n_<?php echo $num;?>" style="display:none"  <?php echo (!in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?>  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'disabled':'';?>>
                                                                <div class="grid-layout-cell">
                                                                    <div class="form-toggle-options">
                                                                        <input type="checkbox" name="gd_chkbox[]" value="y" id="gd_chkbox_y_<?php echo $num;?>"  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?> onclick="chk_box_press('gd',<?php echo $num;?>);">
                                                                        <div class="form-toggle-options-data">
                                                                            <div class="options-labels"><span><?php echo $gd1['name'];?></span><strong><?php echo number_format($gd1['price']);?>원</strong></div>
                                                                            <div class="form-amount-input">
                                                                                <button type="button" class="btn-form-amount-minus" onclick="cnt_change('gd<?php echo $num;?>','m');">감소</button>
                                                                                <div class="form-amount-info">
                                                                                    <!-- 20220313 수정 -->
                                                                                    <!-- readonly , disabled 속성 추가하여도 상관 없음 -->
                                                                                    <input type="hidden" name="gd_seq[]" value="<?php echo $gd1['etc_seq'];?>">
                                                                                    <input type="hidden" name="gd_name[]" value="<?php echo $gd1['name'];?>">
                                                                                    <input type="hidden" name="gd_price[]" value="<?php echo $gd1['price'];?>">
                                                                                    <input type="number" name="gd[]" id="gd<?php echo $num;?>_cnt" value="<?php echo ($goods_cnt[$gd1['etc_seq']]>0)?$goods_cnt[$gd1['etc_seq']]:'1';?>" class="form-amount-val gd1">
                                                                                    <!-- //20220313 수정 -->
                                                                                </div>
                                                                                <button type="button" class="btn-form-amount-plus" onclick="cnt_change('gd<?php echo $num;?>','p');">증가</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <?php $num++;} ?>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <?php } ?>
                                    <?php
                                    $num = 1;
                                    $que = "SELECT * FROM tb_product_dog_etc WHERE customer_id = '{$user_id}' AND product_kind = 2";
                                    $gd1 = sql_fetch_array($que);
                                    if(count($gd1)){
                                        ?>
                                        <div class="form-group-cell middle grid-4-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">간식</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir">
                                                            <?php
                                                            foreach($gd1 as $gd1){
                                                                ?>
                                                                <input type="checkbox" name="snack_chkbox[]" value="n" id="snack_chkbox_n_<?php echo $num;?>" style="display:none"  <?php echo (!in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?>  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'disabled':'';?>>
                                                                <div class="grid-layout-cell">
                                                                    <div class="form-toggle-options">
                                                                        <input type="checkbox" name="snack_chkbox[]" value="y" id="snack_chkbox_y_<?php echo $num;?>"  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?> onclick="chk_box_press('snack',<?php echo $num;?>);" >
                                                                        <!--<input type="checkbox" name="snack_chkbox_no[]" value="n" id="snack_chkbox_n_<?php /*echo $num;*/?>"  >-->
                                                                        <div class="form-toggle-options-data">
                                                                            <div class="options-labels"><span><?php echo $gd1['name'];?></span><strong><?php echo number_format($gd1['price']);?>원</strong></div>
                                                                            <div class="form-amount-input">
                                                                                <button type="button" class="btn-form-amount-minus" onclick="cnt_change('snack<?php echo $num;?>','m');">감소</button>
                                                                                <div class="form-amount-info">
                                                                                    <!-- 20220313 수정 -->
                                                                                    <!-- readonly , disabled 속성 추가하여도 상관 없음 -->
                                                                                    <input type="hidden" name="snack_seq[]" value="<?php echo $gd1['etc_seq'];?>">
                                                                                    <input type="hidden" name="snack_name[]" value="<?php echo $gd1['name'];?>">
                                                                                    <input type="hidden" name="snack_price[]" value="<?php echo $gd1['price'];?>">
                                                                                    <input type="number" name="snack[]" id="snack<?php echo $num;?>_cnt" value="<?php echo ($goods_cnt[$gd1['etc_seq']]>0)?$goods_cnt[$gd1['etc_seq']]:'1';?>" class="form-amount-val gd1">
                                                                                    <!-- //20220313 수정 -->
                                                                                </div>
                                                                                <button type="button" class="btn-form-amount-plus" onclick="cnt_change('snack<?php echo $num;?>','p');">증가</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <?php $num++;} ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <?php } ?>
                                    <?php
                                    $num = 1;
                                    $que = "SELECT * FROM tb_product_dog_etc WHERE customer_id = '{$user_id}' AND product_kind = 3";
                                    $gd1 = sql_fetch_array($que);
                                    if(count($gd1)){
                                        ?>

                                        <div class="form-group-cell middle grid-4-add">
                                            <div class="form-group-item">
                                                <div class="form-item-label01">사료</div>
                                                <div class="form-item-data type-2">
                                                    <div class="grid-layout toggle-button-group">
                                                        <div class="grid-layout-inner flex-dir">
                                                            <?php
                                                            foreach($gd1 as $gd1){
                                                                ?>
                                                                <input type="checkbox" name="feed_chkbox[]" value="n" id="feed_chkbox_n_<?php echo $num;?>" style="display:none"  <?php echo (!in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?>  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'disabled':'';?>>
                                                                <div class="grid-layout-cell">
                                                                    <div class="form-toggle-options">
                                                                        <input type="checkbox" name="feed_chkbox[]" value="y" id="feed_chkbox_y_<?php echo $num;?>"  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?> onclick="chk_box_press('feed',<?php echo $num;?>);" >
                                                                        <!--<input type="checkbox" name="feed_chkbox_box[]" value="n" id="feed_chkbox_n_<?php /*echo $num;*/?>"  >-->
                                                                        <div class="form-toggle-options-data">
                                                                            <div class="options-labels"><span><?php echo $gd1['name'];?></span><strong><?php echo number_format($gd1['price']);?>원</strong></div>
                                                                            <div class="form-amount-input">
                                                                                <button type="button" class="btn-form-amount-minus" onclick="cnt_change('feed<?php echo $num;?>','m');">감소</button>
                                                                                <div class="form-amount-info">
                                                                                    <!-- 20220313 수정 -->
                                                                                    <!-- readonly , disabled 속성 추가하여도 상관 없음 -->
                                                                                    <input type="hidden" name="feed_seq[]" value="<?php echo $gd1['etc_seq'];?>">
                                                                                    <input type="hidden" name="feed_name[]" value="<?php echo $gd1['name'];?>">
                                                                                    <input type="hidden" name="feed_price[]" value="<?php echo $gd1['price'];?>">
                                                                                    <input type="number" name="feed[]" id="feed<?php echo $num;?>_cnt" value="<?php echo ($goods_cnt[$gd1['etc_seq']]>0)?$goods_cnt[$gd1['etc_seq']]:'1';?>" class="form-amount-val gd1">
                                                                                    <!-- //20220313 수정 -->
                                                                                </div>
                                                                                <button type="button" class="btn-form-amount-plus" onclick="cnt_change('feed<?php echo $num;?>','p');">증가</button>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <?php $num++;} ?>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <?php } ?>
                                    <?php
                                    $num = 1;
                                    $que = "SELECT * FROM tb_product_dog_etc WHERE customer_id = '{$user_id}' AND product_kind = 4";
                                    $gd1 = sql_fetch_array($que);
                                    if(count($gd1)){
                                    ?>
                                    <div class="form-group-cell middle grid-4-add">
                                        <div class="form-group-item">
                                            <div class="form-item-label01">기타</div>
                                            <div class="form-item-data type-2">

                                                <div class="grid-layout toggle-button-group">
                                                    <div class="grid-layout-inner flex-dir">
                                                        <?php
                                                        foreach($gd1 as $gd1){
                                                            ?>
                                                            <input type="checkbox" name="et_chkbox[]" value="n" id="et_chkbox_n_<?php echo $num;?>" style="display:none"  <?php echo (!in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?>  <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'disabled':'';?>>
                                                            <div class="grid-layout-cell">
                                                                <div class="form-toggle-options">
                                                                    <input type="checkbox" name="et_chkbox[]" value="y"  id="et_chkbox_y_<?php echo $num;?>" <?php echo (in_array($gd1['etc_seq'],$goods_seq))?'checked':'';?>  onclick="chk_box_press('etc',<?php echo $num;?>);">
                                                                    <!--<input type="checkbox" name="et_chkbox_box[]" value="n" id="et_chkbox_n_<?php /*echo $num;*/?>"  >-->
                                                                    <div class="form-toggle-options-data">
                                                                        <div class="options-labels"><span><?php echo $gd1['name'];?></span><strong><?php echo number_format($gd1['price']);?>원</strong></div>
                                                                        <div class="form-amount-input">
                                                                            <button type="button" class="btn-form-amount-minus" onclick="cnt_change('etc<?php echo $num;?>','m');">감소</button>
                                                                            <div class="form-amount-info">
                                                                                <!-- 20220313 수정 -->
                                                                                <!-- readonly , disabled 속성 추가하여도 상관 없음 -->
                                                                                <input type="hidden" name="etc_seq[]" value="<?php echo $gd1['etc_seq'];?>">
                                                                                <input type="hidden" name="etc_name[]" value="<?php echo $gd1['name'];?>">
                                                                                <input type="hidden" name="etc_price[]" value="<?php echo $gd1['price'];?>">
                                                                                <input type="number" name="etc_cnt[]" id="etc<?php echo $num;?>_cnt" value="<?php echo ($goods_cnt[$gd1['etc_seq']]>0)?$goods_cnt[$gd1['etc_seq']]:'1';?>" class="form-amount-val gd1">
                                                                                <!-- //20220313 수정 -->
                                                                            </div>
                                                                            <button type="button" class="btn-form-amount-plus" onclick="cnt_change('etc<?php echo $num;?>','p');">증가</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <?php $num++;} ?>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <?php } ?>
                                    </div>
                                    <!--<div class="basic-data-group middle">
                                        <a href="javascript:;" class="btn btn-outline-purple btn-round btn-middle-size update-service-btn">변경</a>
                                    </div>-->
                                </div>
                            </div>
                            <!-- //제품 -->
                        </div>
            </form>

            <!--변경 버튼 시작 -->
            <div class="basic-data-group middle sticky-bottom" id="sticky-bottom">
                <div class="sticky-bottom-inner pc-mg-bt-20" >
                    <a href="javascript:;" class="btn btn-outline-purple btn-round btn-middle-size update-service-btn">변경</a>
                </div>
            </div>
            <!--변경 버튼 끝 -->

            <!-- 하단 결제 부분 시작 -->
            <div class="basic-data-group">
                <!-- 결제금액 리스트 표시-->
                <div class="basic-data-group vvsmall2">
                    <div class="user-receipt-item user-receipt-item-add">
                        <div class="receipt-buy-detail">
                            <div class="item-data-list">
                                <?php if($pet['type']=='dog'){ ?>
                                <div class="list-cell">
                                    <div class="list-title">
                                        <?php
                                        $sum = 0;
                                        $kg = explode(':',$beauty_info[5]);
                                        $face = explode(':',$beauty_info[6]);
                                        $hair_length = explode(':',$beauty_info[7]);
                                        $bath_array = explode(',',$beauty_info[8]);
                                        ?>
                                        <?php
                                        if(!empty($beauty_info[3])){
                                            $beauty_first[] = $beauty_info[3];
                                        }
                                        if(!empty($beauty_info[4])){
                                            $beauty_first[] = $beauty_info[4];
                                        }
                                        if(!empty($kg[0]) && $kg[0] != 'on'){
                                            $beauty_first[] = '~'.$kg[0].'Kg';
                                        }
                                        $bf = implode(' / ',$beauty_first);
                                        ?>
                                        <?php echo $bf;?>
                                    </div>
                                    <div class="list-value"><?php $sum+=$kg[1]; echo number_format($kg[1]);?>원</div>
                                </div>
                                <?php if(!empty($face[0])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title"><?php echo $face[0];?></div>
                                        <div class="list-value"><?php $sum+=$face[1]; echo number_format($face[1]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(!empty($hair_length[0])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title"><?php echo $hair_length[0];?>mm</div>
                                        <div class="list-value"><?php $sum+=$hair_length[1];echo number_format($hair_length[1]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(count($bath_array)>0){
                                    for($i=0;$i<count($bath_array);$i++){
                                        $bath = explode(':',$bath_array[$i]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $bath[0];?></div>
                                            <div class="list-value"><?php $sum+=$bath[1]; echo number_format($bath[1]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <?php if(!empty($beauty_info[9])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">발톱</div>
                                        <div class="list-value"><?php $sum+=$beauty_info[9];echo number_format($beauty_info[9]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(!empty($beauty_info[10])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">장화</div>
                                        <div class="list-value"><?php $sum+=$beauty_info[10];echo number_format($beauty_info[10]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(!empty($beauty_info[11])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">방울</div>
                                        <div class="list-value"><?php $sum+=$beauty_info[11];echo number_format($beauty_info[11]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php
                                $s = 15;
                                if($beauty_info[14]>0){
                                    for($i=0;$i<$beauty_info[14];$i++){
                                        $tmp = explode(':',$beauty_info[(15+$i)]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[0];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[1]; echo number_format($tmp[1]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!--스파-->
                                <?php
                                unset($tmp);
                                $spa_start = 14+($beauty_info[14]+1);
                                if($beauty_info[$spa_start]>0){
                                    for($i=1;$i<=$beauty_info[$spa_start];$i++){
                                        $tmp = explode(':',$beauty_info[($spa_start+$i)]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[0];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[1]; echo number_format($tmp[1]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!-- 염색 -->
                                <?php
                                unset($tmp);
                                $color_start = $spa_start+($beauty_info[$spa_start]+1);
                                if($beauty_info[$color_start]>0){
                                    for($i=1;$i<=$beauty_info[$color_start];$i++){
                                        $tmp = explode(':',$beauty_info[($color_start+$i)]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[0];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[1]; echo number_format($tmp[1]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!-- 기타 -->
                                <?php
                                unset($tmp);
                                $etc_start = $color_start+($beauty_info[$color_start]+1);
                                if($beauty_info[$etc_start]>0){
                                    for($i=1;$i<=$beauty_info[$etc_start];$i++){
                                        $tmp = explode(':',$beauty_info[($etc_start+$i)]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[0];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[1]; echo number_format($tmp[1]);?>원</div>
                                        </div>
                                    <?php }} ?>


                                <!--제품구매내역-->
                                <?php
                                unset($tmp);
                                $goods_start = $cp_start+($beauty_info[$cp_start]+1);
                                if($beauty_info[$goods_start]>0){
                                    for($i=1;$i<=$beauty_info[$goods_start];$i++){
                                        $tmp = explode(':',$beauty_info[($goods_start+$i)]);

                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[1];?>[<?php echo number_format($tmp[2]);?>원X<?php echo number_format($tmp[3]);?>개]</div>
                                            <div class="list-value"><?php $sum+=$tmp[2]*$tmp[3]; echo number_format($tmp[2]*$tmp[3]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!--쿠폰구매내역-->
                                <?php
                                unset($tmp);
                                $coupon_start = $etc_start+($beauty_info[$etc_start]+1);
                                if($beauty_info[$coupon_start]>0){
                                    for($i=1;$i<=$beauty_info[$coupon_start];$i++){
                                        $tmp = explode(':',$beauty_info[($coupon_start+$i)]);
//                                                    print_r($tmp);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title">쿠폰 : <?php echo $tmp[1];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[2]; echo number_format($tmp[2]);?>원</div>
                                        </div>
                                    <?php }} ?>

                            </div>
                            <?php } else { ?>
                                <div class="list-cell">
                                    <?php
                                    $sum = 0;
                                    $kg = explode(':',$beauty_info[3]);
                                    $hair = explode(':',$beauty_info[4]);
                                    $bath = $beauty_info[6];
                                    $toenail = $beauty_info[5];
                                    /*$face = explode(':',$beauty_info[6]);
                                    $hair_length = explode(':',$beauty_info[7]);
                                    $bath = explode(':',$beauty_info[8]);*/
                                    ?>
                                </div>
                                <?php if(!empty($kg[0])){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">미용 : ~<?php echo $kg[0];?>kg</div>
                                        <div class="list-value"><?php $sum+=$hair[1]; echo number_format($hair[1]);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(!empty($bath)){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">목욕  </div>
                                        <div class="list-value"><?php $sum+=$bath; echo number_format($bath);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php if(!empty($toenail)){ ?>
                                    <div class="list-cell">
                                        <div class="list-title">발톱  </div>
                                        <div class="list-value"><?php $sum+=$toenail; echo number_format($toenail);?>원</div>
                                    </div>
                                <?php } ?>
                                <?php
                                if($beauty_info[7]>0){
                                    for($i=0;$i<$beauty_info[7];$i++){
                                        $tmp = explode(':',$beauty_info[(8+$i)]);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[0];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[1]; echo number_format($tmp[1]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!--제품구매내역-->
                                <?php

                                unset($tmp);
                                $etc_start = 7;
                                $cp_start = $etc_start + ($beauty_info[$etc_start] + 1);
                                $goods_start = $etc_start+($beauty_info[$etc_start]+1);
                                if($beauty_info[$goods_start]>0){
                                    for($i=1;$i<=$beauty_info[$goods_start];$i++){
                                        $tmp = explode(':',$beauty_info[($goods_start+$i)]);

                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title"><?php echo $tmp[1];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[2]; echo number_format($tmp[2]);?>원</div>
                                        </div>
                                    <?php }} ?>
                                <!--쿠폰구매내역-->
                                <?php
                                unset($tmp);
                                $coupon_start = $goods_start+($beauty_info[$goods_start]+1);
                                if($beauty_info[$coupon_start]>0){
                                    for($i=1;$i<=$beauty_info[$coupon_start];$i++){
                                        $tmp = explode(':',$beauty_info[($coupon_start+$i)]);
//                                                    print_r($tmp);
                                        ?>
                                        <div class="list-cell">
                                            <div class="list-title">쿠폰 : <?php echo $tmp[1];?></div>
                                            <div class="list-value"><?php $sum+=$tmp[2]; echo number_format($tmp[2]);?>원</div>
                                        </div>
                                    <?php }} ?>
                            <?php } ?>

                        </div>
                        <!--합계금액 부가세표시 기본결제금액-->
                        <div class="receipt-buy-detail total-price" style="border-top: 1px solid #f4f4f4;
    margin-top: 12px;
    padding-top: 12px;">
                            <div class="item-data-list">
                                <div class="list-cell">
                                    <div class="list-title"><strong>합산 금액</strong></div>
                                    <div class="list-value"><strong><?php echo number_format($sum);?>원</strong></div>
                                </div>
                                <div class="list-cell">
                                    <div class="list-title"><strong>부가세 10%</strong></div>
                                    <div class="list-value"><strong>
                                            <?php

                                            if($sh[0]['is_vat']==1){
                                                $vat = ($sum*0.1);
                                                echo number_format($vat);;
                                            } else {
                                                echo '0';
                                            }

                                            ?>
                                            원</strong></div>
                                </div>
                            </div>
                        </div>
                        <div class="receipt-buy-detail result-price">
                            <div class="item-data-list">
                                <div class="list-cell">
                                    <div class="list-title font-color-purple"><strong>예상 금액</strong></div>
                                    <div class="list-value font-color-purple"><strong><span id="total_pay_money"><?php echo number_format($sum+$vat);?></span>원</strong></div>
                                </div>
                            </div>
                        </div>
                        <!--합계금액 부가세표시 기본결제금액 끝 -->
                    </div>
                </div>
                <!--보유쿠폰-->
                <?php
                //$que1 = "SELECT * FROM tb_user_coupon a LEFT JOIN tb_coupon b ON a.coupon_seq = b.coupon_seq WHERE a.customer_id = '{$cus['id']}' AND a.artist_id = '{$pay['artist_id']}' AND a.tmp_seq = '{$cus['tmp_seq']}'";
                $que1 = "
                    SELECT * FROM (
                        SELECT a.*, b.name FROM tb_user_coupon a
                        LEFT JOIN tb_coupon b ON a.coupon_seq = b.coupon_seq
                        WHERE (a.customer_id = '{$cus['id']}' OR a.tmp_seq = '{$cus['tmp_seq']}')
                        AND a.artist_id = '{$pay['artist_id']}'
                        ORDER BY a.user_coupon_seq desc
                    ) s
                    GROUP BY s.coupon_seq
                ";
                //echo $que1;
                $cop = sql_fetch_array($que1);
                if(count($cop)>0){
                    ?>

                    <div class="basic-data-group" id="prev_cmt">

                        <div class="con-title-group con-title-group-add">
                            <h4 class="con-title">보유 쿠폰</h4>
                        </div>
                        <div class="form-group user-receipt-wrap">
                            <div class="form-group-cell small">
                                <div class="form-group-item">
                                    <div class="form-item-label">쿠폰 명</div>
                                    <div class="form-item-data type-2">
                                        <div class="form-control-btns">
                                            <select name="coupon_name" id="coupon_name">
                                                <option value="">선택안함</option>
                                                <?php
                                                foreach($cop as $cop){
                                                    ?>
                                                    <option value="<?php echo $cop['user_coupon_seq'];?>"><?php echo $cop['name'];?></option>
                                                    <?php
                                                }
                                                ?>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell small">
                                <div class="grid-layout basic">
                                    <div class="grid-layout-inner">
                                        <div class="grid-layout-cell grid-60">
                                            <div class="form-group-item">
                                                <div class="form-item-label">보유</div>
                                                <div class="form-item-data type-2">
                                                    <div class="form-control-btns">
                                                        <select name="coupon_balance" id="coupon_balance">
                                                            <option value="">선택</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="grid-layout-cell grid-40">
                                            <div class="form-group-item">
                                                <div class="form-item-label">차감</div>
                                                <div class="form-item-data type-2">
                                                    <div class="form-control-btns">
                                                        <select name="use_coupon" id="use_coupon">
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group-cell small">
                                <button type="button" class="btn btn-outline-purple btn-round use-coupon">적용</button>
                                <div class="form-bottom-info font-color-purple font-weight-500 text-align-right">적용 후 잔액 : <span id="remind_coupon">0</span>원</div>
                            </div>
                        </div>


                    </div>

                <?php } ?>
                <!-- 단골고객할인-->

                <div class="basic-data-group " id="prev_cmt">

                    <div class="con-title-group con-title-group-add">
                        <h4 class="con-title">단골 고객 할인</h4>
                    </div>

                    <div class="user-receipt-wrap"><div class="regular-user-confirm ">
                            <div class="info" style="font-size:13px !important;">*원하시는 할인방법을 선택하신 후 적용을 누르세요.</div>
                            <div class="regular-user-confirm-select">
                                <div class="regular-user-confirm-input">
                                    <div class="item-check"><label class="form-radiobox">
                                            <input type="radio" id="percent_radio" name="discount_radio" <?=($pay['discount_type'] == "1")? 'checked' : "" ?> >
                                            <span class="form-check-icon"><em>퍼센트할인</em></span></label></div>
                                    <div class="item-data">
                                        <select id="percent_type" class="select_type">
                                            <option value=""></option>
                                            <?php
                                            for ($i = 0; $i < count($discount_percent); $i++) {
                                                if($pay['discount_type'] == "1" && $discount_percent[$i] == $pay['discount_num']){
                                                    echo "<option value='$discount_percent[$i]' selected>$discount_percent[$i]</option>";
                                                }else{
                                                    echo "<option value='$discount_percent[$i]'>$discount_percent[$i]</option>";
                                                }
                                            }
                                            ?>
                                        </select>
                                        <div class="unit">%</div>
                                    </div>
                                </div>
                                <div class="regular-user-confirm-input">
                                    <div class="item-check"><label class="form-radiobox">
                                            <input type="radio" id="won_radio" name="discount_radio" class="discount_radio" value="won_type"
                                                <?=($pay['discount_type'] == "2")? 'checked' : "" ?>><span class="form-check-icon"><em>금액할인</em></span></label></div>
                                    <div class="item-data">
                                        <select id="won_type" class="select_type" <?=($discount_type != "0")? $disabled : "" ?>>
                                            <option value=""></option>
                                            <?php
                                            for ($i = 0; $i < count($discount_won); $i++) {
                                                if($pay['discount_type'] == "2" && $discount_won[$i] == $pay['discount_num']){
                                                    echo "<option value='$discount_won[$i]' selected>$discount_won[$i]</option>";
                                                }else{
                                                    echo "<option value='$discount_won[$i]'>$discount_won[$i]</option>";
                                                }
                                            }
                                            ?>
                                        </select>
                                        <div class="unit">원</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="basic-data-group vsmall">
                            <button type="button" class="btn btn-outline-purple btn-middle-size btn-round set_update_discount_btn" data-seq="<?php echo $payment_log_seq;?>">적용</button>
                        </div>
                        <div class="form-bottom-info font-color-purple font-weight-500 text-align-right">할인금액 : <span id="discount_price">
                                        <?php
                                        if($pay['discount_type'] == "1"){
                                            echo $discount_price = number_format(((($sum+$vat))*$pay['discount_num'])/100);
                                        } else {
                                            echo $discount_price = number_format($pay['discount_num']);
                                        }

                                        ?>
                                </span>원</div></div>



                </div>



                <!--펫샵 적립금-->
                <?php
                $que_r = "SELECT * FROM tb_shop_reserve WHERE artist_id = '{$pay['artist_id']}' AND is_use = '1' AND percent != '0'";
                //echo $que1;
                $reserve = sql_fetch_array($que_r);
                if(count($reserve)>0){
                    ?>

                    <div class="basic-data-group " id="prev_cmt">

                        <div class="con-title-group con-title-group-add">
                            <h4 class="con-title">펫샵 적립금<button type="button" class="btn-data-helper" onclick="popalert.open('reservePayManagementMsg8');">도움말</button></h4>
                        </div>

                        <div class="user-receipt-wrap">
                            <div class="receipt-buy-detail result-price">
                                <div class="item-data-list">
                                    <div class="list-cell">
                                        <div class="list-title"><strong>현 적립금</strong></div>
                                        <div class="list-value"><strong id="cur_reserve"><?php echo number_format($resrv['reserve']);?>원</strong></div>
                                    </div>
                                </div>
                            </div>
                            <div class="basic-data-group vsmall line">
                                <div class="form-group">
                                    <div class="form-group-cell">
                                        <div class="form-group-item">
                                            <div class="form-item-label">사용적립금</div>
                                            <div class="form-item-data type-2">
                                                <div class="form-point-input">
                                                    <input type="text" name="use_reserve" id="use_reserve" value="<?php echo $pay['reserve_point']; ?>" <?php echo ($pay['reserve_point']>0)?'disabled':''; ?> class="" placeholder="">
                                                    <div class="char">원</div>
                                                    <button type="button" class="btn btn-outline-gray btn-round btn-inline all-use-reserve" data-price="<?php echo $resrv['reserve'];?>">전액 사용</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="basic-data-group vvsmall3">
                                <div class="grid-layout btn-grid-group">
                                    <div class="grid-layout-inner">
                                        <!--                                        <div class="grid-layout-cell grid-2">-->
                                        <!--                                            <button type="button" class="btn btn-outline-gray btn-middle-size btn-round reserve-save-cancel"-->
                                        <!--                                                    data-cid="--><?php //echo $cus['id'];?><!--"-->
                                        <!--                                                    data-tid="--><?php //echo $cus['tmp_seq'];?><!--"-->
                                        <!--                                                    data-phone="--><?php //echo $pay['cellphone'];?><!--"-->
                                        <!--                                                    data-seq="--><?php //echo $payment_log_seq;?><!--"-->
                                        <!--                                                    data-service="B"-->
                                        <!--                                                    data-aid="--><?php //echo $pay['artist_id'];?><!--"-->
                                        <!--                                                --><?php //echo ($pay['reserve_point']>0)?'':'disabled';?><!--재설정</button></div>-->
                                        <div class="grid-layout-cell grid-1">
                                            <button type="button" class="btn btn-outline-purple btn-middle-size btn-round  reserve-save-btn"
                                                    data-cid="<?php echo $cus['id'];?>"
                                                    data-tid="<?php echo $cus['tmp_seq'];?>"
                                                    data-phone="<?php echo $pay['cellphone'];?>"
                                                    data-seq="<?php echo $payment_log_seq;?>"
                                                    data-service="B"
                                                    data-aid="<?php echo $pay['artist_id'];?>"
                                            >적용</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--<div class="basic-data-group vsmall">
                                <button type="button" class="btn btn-outline-gray btn-middle-size btn-round reserve-save-btn"

                                >적용</button>
                            </div>-->
                            <div class="form-bottom-info font-color-purple font-weight-500 " style="text-align:right; font-size:13px !important;">이 예약 건에 대한 적립금이 아직 지급되지 않았습니다.</div>



                        </div>



                    </div>


                <?php } ?>
                <!--최종결제액-->

                <div class="basic-data-group vvsmall2 " >
                    <div class="user-receipt-item user-receipt-item-add" style="border: 1px solid #6840B1 !important; margin-top: 32px;">
                        <div class="receipt-buy-detail total-price">
                            <div class="item-data-list">
                                <div class="list-cell">
                                    <div class="list-title"><strong>할인금액</strong></div>
                                    <div class="list-value"><strong>(-)<span id="total_discount_price"><?php echo $discount_price;?></span>원</strong></div>
                                </div>
                                <?php
                                if(count($reserve)>0){
                                    ?>
                                    <div class="list-cell">
                                        <div class="list-title"><strong>적립금 사용</strong></div>
                                        <div class="list-value"><strong>(-)<span id="total_reserve_price"><?php echo ($pay['reserve_point']>0)?number_format($pay['reserve_point']):'0';?></span>원</strong></div>

                                    </div>
                                <?php } ?>
                            </div>
                        </div>
                        <div class="receipt-buy-detail result-price">
                            <div class="item-data-list">
                                <div class="list-cell">
                                    <div class="list-title font-color-purple"><strong>최종 결제액</strong></div>
                                    <div class="list-value font-color-red"><strong id="total_pay_price_disp">
                                            <?php
                                            $t1 = ($sum+$vat)-str_replace(",","",$discount_price)-$pay['reserve_point'];
                                            //echo number_format($t1);
                                            echo number_format($pay['local_price']+$pay['local_price_cash']);
                                            ?>
                                            원</strong></div>
                                    <input type="hidden" name="total_pay_price" id="total_pay_price" value="<?php echo $t1;?>" size="3">
                                </div>
                            </div>
                        </div>
                        <?php

                        if ($pay['add_price'] > 0) {
                            $card_price = number_format($pay['add_price']);
                        } else if (empty($pay['add_price_cash']) && empty($pay['add_price'])) {
                            $card_price = number_format($t1);
                        }

                        ?>
                        <div class="basic-data-group vmiddle">
                            <div class="form-change-wrap">
                                <div class="form-change-item">
                                    <div class="form-change-label"><strong>카드</strong> (단위:원)</div>
                                    <div class="form-change-data"><input type="text" name="use_card" id="use_card" value="<?php echo number_format($pay['local_price']);?>">
                                    </div>
                                </div>
                                <button type="button" class="btn-data-change">전환하기</button>
                                <div class="form-change-item">
                                    <div class="form-change-label"><strong>현금</strong> (단위:원)</div>
                                    <div class="form-change-data"><input type="text" name="use_cash" id="use_cash" value="<?php echo number_format($pay['local_price_cash']);?>"></div>
                                </div>
                            </div>
                        </div>

                        <div class="basic-data-group vsmall">
                            <button type="button" class="btn btn-outline-purple btn-middle-size btn-round save-final-price" data-seq="<?php echo $payment_log_seq;?>">적용</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="basic-data-group">
                <div class="con-title-group" style="background:none !important;">
                    <h4 class="con-title">결제완료 처리</h4>
                    <label for="switch-toggle" class="form-switch-toggle" ><input type="checkbox" id="pay_confirm" value="1" <?php echo ($pay['is_confirm']==1)?'checked':'';?> data-seq="<?php echo $payment_log_seq;?>"><span class="bar"></span></label>
                </div>
                <div>
                    <span id="confirm_dt"><?php echo ($pay['is_confirm']==1)?$pay['confirm_dt']:'';?></span>
                </div>
            </div>
            </form>
        </div>
        </div>
        <!-- //page-body -->


        <!-- [필수사항]을(를) 입력해주세요.  -->
        <article id="firstRequestMsg1" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt"></div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>

        <!--  기본 메세지 팝업(버튼2) -->
        <article id="only_change_time" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-title">확인</div>
                            <div class="msg-txt">예약시간을 변경 하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-cc" onclick="popalert.close();">취소</button>
                            <button type="button" class="btn btn-confirm btn-cf" onclick="set_change_time(); ">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <!-- //기본 메세지 팝업(버튼2) -->

        <!--  기본 메세지 팝업(버튼2) -->
        <article id="noshow" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-title">확인</div>
                            <div class="msg-txt">해당 예약정보를 노쇼로 등록을 하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-cc" onclick="popalert.close();">취소</button>
                            <button type="button" class="btn btn-confirm btn-cf" onclick="set_noshow();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <!-- //기본 메세지 팝업(버튼2) -->

        <!--  기본 메세지 팝업(버튼2) -->
        <article id="change_rev" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-title">확인</div>
                            <div class="msg-txt">
                                * 변경을 위해 주간스케줄로 이동합니다. 현재 페이지에서 저장하지 않은 정보는 분실될 수 있으니 변경 전에 확인해주세요.
                                <p>
                                    * 변경을 완료하기 전에 다른 페이지로 이동하면 오류가 발생할 수 있으니 주의해주세요.
                                <p>
                                    변경하시겠습니까?
                                <p>
                                    <span style="color:red">(주의) 주간 스케줄표에서만 변경 가능합니다!</span>
                            </div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-cc" onclick="popalert.close();">취소</button>
                            <button type="button" class="btn btn-confirm btn-cf" onclick="change_rev();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <!-- //기본 메세지 팝업(버튼2) -->

        <!-- 알림없이 등록 팝업 -->
        <article id="reserveCancel" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약취소 알림톡을 발송 하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-reserv-block cancel-cls" onclick="confirm_send_reserv('Y'); pop.close();">발송</button>
                            <button type="button" class="btn btn-confirm btn-reserv-send cancel-cls" onclick="confirm_send_reserv('N'); pop.close();">미발송</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- 예약변경 알림 등록 팝업 -->
        <article id="reserveChange" class="layer-pop-wrap">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약변경 알림톡을 발송 하시겠습니까?</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm btn-reserv-block change-cls" id="change_cls" onclick="confirm_change_reserv('Y'); popalert.close();">발송</button>
                            <button type="button" class="btn btn-confirm btn-reserv-send change-cls" onclick="popalert.close(); location.href = '<?php echo $_SESSION['backurl1'];?>';">미발송</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- 앱예약 취소 불가 -->
        <article id="neverCancel" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">견주가 앱을 통해 직접 예약한 경우 예약자 본인이 변경/취소 가능합니다.</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="pop.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>

        <article id="reserveCalendarPop1" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약이 취소되었습니다.</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="pop.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <article id="bigImg" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt"></div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <article id="confirmOnlyOkNoLink" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약이 취소되었습니다.</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>
        <article id="confirmOnlyOkReload" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약이 취소되었습니다.</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="location.reload();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>


        <article id="confirmOnlyOkLink" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">예약이 취소되었습니다.</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();go_anc();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>


        <article id="talkExam" class="layer-pop-wrap" style="z-index: 100002;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">

                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-txt">
                                <img src="/images/exam_talk.jpg" alt="미용 종료 알림 발송톡 예시 입니다.">
                            </div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();">확인</button>
                        </div>
                    </div>

                </div>
            </div>
        </article>

        <article id="reservePayManagementMsg8" class="layer-pop-wrap" style="z-index: 100000;">
            <div class="layer-pop-parent">
                <div class="layer-pop-children">
                    <div class="pop-data alert-pop-data">
                        <div class="pop-body">
                            <div class="msg-title">펫샵적립금 적립시점 안내</div>
                            <div class="msg-txt text-align-left">해당 미용종료시간 10분이 지나면 자동으로 직접 설정하신 기준에 따라 자동 적립됩니다.<br>(설정방법: <strong>상세설정 &gt; 적립금설정</strong>)</div>
                        </div>
                        <div class="pop-footer">
                            <button type="button" class="btn btn-confirm" onclick="popalert.close();">닫기</button>
                        </div>
                    </div>
                </div>
            </div>
        </article>

    </section>
    <!-- //container -->
    <iframe src="" name="hiddenFrame" style="display:none;" frameborder="0"></iframe>
    <script>

        // 고양이 미용 선택 선택시 선택해제(완전 래퍼)
        var beforeChecked = -1;
        $("input[name='hair']").click(function(){
            // 블로그 인용
            var index = $(this).parent().index("label");
            if(beforeChecked == index) {
                beforeChecked = -1;
                $(this).prop("checked", false);
            }else{
                beforeChecked = index;
            }
        });

        $(document).ready(function(){
            var link = window.location.href.split('#');
            $('#'+link[1]).focus();

            // 미용종료 발송했을때
            if("<?=$pay['notice_yn']?>" == "Y"){
                $(".sendComplete").attr('disabled',true).text("발송완료");
                $(".timer").attr('disabled',true);
            }
        });


        function go_anc(){
            setTimeout(function(){
                location.reload();
            },1000);
        }

        $(document).on('click','.service-type',function(){
            var petType = '';
            var serviceType = '';
            var service = $(this).val();
            var time = $(this).data('time');
            $('input[name="pet_kind"]').each(function(){
                if($(this).is(':checked')==true) {
                    petType = $(this).val();
                }
            });

            if(!petType){
                petType = '<?php echo $pet['type'];?>';
            }

            $('.pet-size').each(function(){
                var checked = $(this).prop('checked');
                if(checked==true) {
                    serviceType = $(this).val();
                }
            });


            if(!petType || !serviceType){
                alert('크기를 선택해주세요.');
                return false;
            }

            //해당 미용 시간으로 예약시간을 변경한다.



            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'getBeautyKgsData','petType':petType,'serviceType':serviceType,'service':service},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    if(json.flag == true){
                        $('#kgs_list').empty().append(json.data);
                        console.log(time)
                        $('#to_time').val(time).prop('selected',true);
                    }
                }
            });
        });

        $(document).on('click','.set-noshow',function(){
            popalert.open('noshow');
        });

        function set_noshow(){
            var seq = '<?php echo $payment_log_seq;?>';
            var backurl = '<?php echo $_GET['backurl'];?>';

            $.ajax({
                type : 'post',
                url : './data/pay_make_ajax',
                data : {'mode':'regNoshow','seq':seq, 'backurl':backurl},
                dataType : 'json',
                success : function(json){

                    if(json.flag == true){
                        location.href = '<?php echo $_SESSION['backurl1'];?>';
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //특이사항 저장
        $(document).on('click','.save-etc1',function(){
            var memo = $('#etc_memo').val();
            var seq = $(this).data('seq');
            $.ajax({
                type : 'post',
                url : './data/pay_make_ajax',
                data : {'mode':'etc1','seq':seq,'memo':memo},
                dataType : 'json',
                success : function(json){
                    if(json.flag == true){
                        popalert.open('confirmOnlyOkNoLink','특이사항이 저장되었습니다.');
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });

        });

        //특이사항 저장
        $(document).on('click','.save-etc2',function(){
            var memo = $('#etc2_memo').val();
            var cid = $(this).data('cid');
            var aid = $(this).data('aid');
            var phone = $(this).data('phone');
            var tseq = $(this).data('tseq');
            $.ajax({
                type : 'post',
                url : './data/pay_make_ajax',
                data : {'mode':'etc2','cid':cid,'memo':memo, 'aid':aid, 'phone':phone, 'tseq':tseq},
                dataType : 'json',
                success : function(json){
                    console.log(json)
                    if(json.flag == true){
                        popalert.open('confirmOnlyOkNoLink','견주관련 메모가 저장되었습니다.');
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        });

        //시간만 변경
        //특이사항 저장
        $(document).on('click','.only-change-time',function(){
            popalert.open('only_change_time');
        });

        function set_change_time(){
            var start_time = $('#from_time option:selected').val();
            var end_time = $('#to_time option:selected').val();
            var seq = $('.only-change-time').data('seq');
            popalert.close();
            $.ajax({
                type : 'post',
                url : './data/pay_make_ajax',
                data : {'mode':'onlyTimeChange','startTime':start_time,'endTime':end_time, 'seq':seq},
                dataType : 'json',
                success : function(json){
                    if(json.flag == true){
                        console.log(json)
                        $('#change_cls').data('pay_seq',seq)
                        $('#change_cls').data('org_date',json.orgDate)
                        popalert.open('reserveChange');
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //날짜 미용사 변경
        $(document).on('click','.change-rev',function(){
            var status = $('.cancel-rev').data('status');
            //popalert.open('change_rev');
            if(status == "R1"){
                pop.open('neverCancel');
            }else{
                pop.open('change_rev');
            }
        });

        function change_rev(){
            location.href='./reserve_main_week?payment_log_seq=<?php echo $payment_log_seq;?>&artist_id=<?php echo $pay['artist_id'];?>&worker=<?php echo $ar[0]['name'];?>&yy=<?php echo $pay['year'];?>&mm=<?php echo $pay['month'];?>&dd=<?php echo $pay['day'];?>';
        }

        // 카카오톡알림발송
        function sendAllimtalk() {
            var timer = $("input[name=timer]:checked").val();

            if (timer != "" && timer != undefined) {
                var data = $("#shop_form").serialize();

                $.ajax({
                    type: 'post',
                    data: data,
                    url: '<?=$shop_directory?>/send_notice_talk.php',
                    dataType: 'json',
                    error: function() {
                        $.MessageBox('알림톡 발송이 실패했습니다.');
                    },
                    success: function(json) {
                        if (json.result) {
                            $.MessageBox({
                                buttonDone: '확인',
                                message: '발송 되었습니다.'
                            }).done(function(){
                                location.href = 'view_payment_customer_info.php'+location.search;
                            });
                        } else {
                            $.MessageBox('알림톡 발송이 실패했습니다.');
                        }
                    }
                });
            } else {
                alert("시간을 선택해주세요.");
            }

            return;
        }

        //펫정보
        function get_pet_info(no){
            $.ajax({
                type : 'post',
                url : './data/get_pet_info',
                data : {'mode':'petInfo','no':no,'cellphone':'<?php echo $cellPhone;?>'},
                dataType : 'json',
                success : function(json){

                    if(json.result['flag'] == true){
                        var kg = json.data['weight'].split('.');
                        $('#pet_name').val(json.data['name']);
                        $('#pet_type').val(json.data['pet_type']);
                        if(json.data['type']=='dog'){
                            $('#breed1').prop('checked',true);
                        } else {
                            $('#breed2').prop('checked',true);
                        }

                        $('#pet_year').val(json.data['year']);
                        $('#pet_month').val(json.data['month']);
                        $('#pet_day').val(json.data['day']);

                        if(json.data['gender']=='남아'){
                            $('#gender1').prop('checked',true);
                        } else {
                            $('#gender2').prop('checked',true);
                        }

                        if(json.data['neutral']==1){
                            $('#neutralize1').prop('checked',true);
                        } else {
                            $('#neutralize2').prop('checked',true);
                        }

                        $('#pet_weight1').val(kg[0]);
                        $('#pet_weight2').val(kg[1]);


                        if(json.beauty != ''){
                            $('#prev_beauty_info').empty().append(json.beauty).css('display','block');
                        } else {
                            $('#prev_beauty_info').empty().css('display','none');
                        }

                        $('#customer_id').val(json.data['customer_id']);
                        //get_coupon($('#customer_id').val());
                        //품종 타입별 크기선택 불러오기
                        get_type_load(json.data['type']);
                        // make_beauty_chk();
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //크기 정보 구하기
        function get_type_load(gt){
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax',
                data : {'mode':'getTypeSize','type':gt},
                dataType : 'json',
                success : function(json){
                    if(json.flag == true){
                        $('#serviceType').empty().append(json.data);
                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //쿠폰 정보 구하기
        function get_coupon(cusid){
            console.log(cusid)
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax',
                data : {'mode':'getCoupon','cid':cusid},
                dataType : 'json',
                success : function(json){
                    console.log(json)
                    if(json.flag == true){
                        if(!json.cnt){
                            $('#coupon_div').css('display','none');
                        } else {
                            $('#coupon_name').empty().append(json.select_name);
                            $('#coupon_div').css('display','block');
                        }
                        $('#serviceType').empty().append(json.data);

                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }

        //쿠폰 선택시
        $('#coupon_name').change(function(){
            var cid = $(this).val();
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax',
                data : {'mode':'getCouponBalance','cid':cid},
                dataType : 'json',
                success : function(json){
                    console.log(json)
                    if(json.flag == true){
                        $('#coupon_balance').empty().append(json.select_name);
                        $('#use_coupon').empty().append(json.select_use);

                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        });

        //쿠폰사용
        $(document).on('click','.use-coupon',function(){
            if(confirm('쿠폰을 사용하시겠습니까?')){
                var cnt = $('#use_coupon option:selected').val();
                var cid = $('#coupon_name option:selected').val();
                if(!cnt){
                    alert('쿠폰차감 횟수를 선택해주세요.');
                    return false;
                }
                $.ajax({
                    type : 'post',
                    url : './data/get_book_data_ajax',
                    data : {'mode':'useCoupon','cid':cid,'cnt':cnt,'payment_log':<?php echo $payment_log_seq;?>},
                    dataType : 'json',
                    success : function(json){
                        console.log(json)
                        if(json.flag == true){
                            //var cid = json.cid;
                            $.ajax({
                                type : 'post',
                                url : './data/get_book_data_ajax',
                                data : {'mode':'getCouponBalance','cid':cid},
                                dataType : 'json',
                                success : function(json){
                                    if(json.flag == true){
                                        $('#coupon_balance').empty().append(json.select_name);
                                        $('#use_coupon').empty().append(json.select_use);
                                        $('#remind_coupon').text($('#coupon_balance option:selected').val());
                                    }
                                }, error : function(xhr, error){
                                    console.log('error'+xhr)
                                }
                            });
                        }
                        $('#coupon_seq').val(cid);
                    }, error : function(xhr, error){
                        console.log('error'+xhr)
                    }
                });
            }
        });

        $(document).ready(function(){
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax.php',
                data : {'mode':'getCouponBalance','payment_log':<?php echo $payment_log_seq;?>},
                dataType : 'json',
                success : function(json){
                    console.log(json);
                    if(json.flag == true){
                        $('#coupon_name').val(json.user_coupon_seq).prop("selected", true);
                        $('#coupon_balance').empty().append(json.select_name);
                        $('#use_coupon').empty().append(json.select_use);
                        $('#remind_coupon').text($('#coupon_balance option:selected').val());

                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        });

        //크기 정보 구하기
        function get_type_load(gt){
            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax',
                data : {'mode':'getTypeSize','type':gt},
                dataType : 'json',
                success : function(json){
                    if(json.flag == true){
                        $('#serviceType').empty().append(json.data);


                    }
                }, error : function(xhr, error){
                    console.log('error'+xhr)
                }
            });
        }


        //강아지 사이즈 선택시 무게 값을 가져온다.
        $(document).on('click','.pet-size',function(){

            var petType = '';
            var serviceType = '';
            var service = '';
            var seq = '<?php echo $payment_log_seq;?>';

            $('input[name="pet_kind"]').each(function(){
                if($(this).is(':checked')==true) {
                    petType = $(this).val();
                }
            });

            //$('.pet-size').each(function(){
            //if($(this).is(':checked')==true) {
            serviceType = $(this).val();
            //}
            //});

            //$('.service-type').each(function(){
            // if($(this).is(':checked')==true) {
            //  service = $(this).val();
            // }
            //});

            if(!petType){
                petType = '<?php echo $pet['type'];?>';
            }

            $('.pet-size').each(function(){
                var checked = $(this).prop('checked');
                if(checked==true) {
                    serviceType = $(this).val();
                }
            });


            if(petType || serviceType || service){
                $.ajax({
                    type: 'post',
                    url: 'data/get_book_data_ajax',
                    data: {'mode':'getBeautyServiceData','petType':petType,'serviceType':serviceType,'service':service, 'payment_log':seq},
                    dataType: 'json',
                    error: function() {
                        alert('Error');
                    },
                    success: function(json) {
                        if(json.flag == true){
                            $('#service_list').empty().append(json.data);
                        }
                    }
                });
            }
        });

        //품종선택시
        $(document).on('click','input[name="pet_kind"]',function(){
            //기본서비스 정보를 초기화 한다.

            if($(this).val() == 'dog'){
                get_type_load($(this).val());
                $('.is-dog').css('display','block');
                $('.is-cat').css('display','none').prop('disabled',true);
            } else {
                get_type_load($(this).val());
                $('.is-cat').css('display','block');
                $('.is-dog').css('display','none').prop('disabled',true);
            }

            //
        });

        //이전 미용 정보 불러오기
        function get_prev_beauty_info(){
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'getBeautyKgsData','petType':petType,'serviceType':serviceType,'service':service},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    if(json.flag == true){
                        $('#kgs_list').empty().append(json.data);

                    }
                }
            });
        }

        //무게 선택시
        $(document).ready(function(){
            //get_coupon('<?php echo $pay['customer_id'];?>');
        });

        // 무게 키로당 추가금액 선택시
        //무게 +-
        function weight_change(obj, add_price, type){
            var name = $('#weight'+obj+'_cnt');
            var org_cnt = parseInt($('#weight'+obj+'_cnt').val());
            var weight_plus = $(".weight_plus").val().split(":");
            var weight_plus_0 = parseInt(weight_plus[0]);
            var weight_plus_1 = parseInt(weight_plus[1]);
            var obj = parseInt(obj);
            console.log(add_price, weight_plus_0, weight_plus_1);
            if(type == 'm'){
                if(name.val() > obj){
                    name.val(org_cnt-1);
                    var val = (weight_plus_0-1)+":"+(weight_plus_1-add_price);
                    $(".weight_plus").val(val);
                }
            } else {
                if(name.val() < 100){
                    name.val(org_cnt+1);
                    var val = (weight_plus_0+1)+":"+(weight_plus_1+add_price);
                    $(".weight_plus").val(val);
                }
            }
        }


        $(document).on('click','#pet-info-view',function(){
            console.log($(this).hasClass('actived'))
            if($('.customer-view-pet-detail').hasClass('actived') == true){
                $('.customer-view-pet-detail').removeClass('actived');
            } else {
                $('.customer-view-pet-detail').addClass('actived');
            }
        });


        $(document).on('click','.btn-tab-item',function(){
            var checked = false;
            var value = '';
            $('.btn-tab-item').each(function(index){
                $(this).parent().parent().removeClass('actived').removeClass('hit');
            });
            $(this).parent().parent().addClass('actived').addClass('hit');
            $('.tab-data-cell').css('display','none');
            $('.btn-tab-item').each(function(index){
                if($(this).parent().parent().hasClass('actived') == true){
                    $('.tab-data-cell:eq('+index+')').css('display','block');
                }
            });




        });



        //서비스 정보 업데이트
        $(document).on('click','.update-service-btn',function(){
            document.service_update.submit();
        });

        function callback(){
            popalert.open('confirmOnlyOkLink','서비스정보가 변경되었습니다.');

        }

        //할인퍼센트 선택시
        $('#percent_type').change(function(){
            var total_price = parseInt($('#total_pay_money').text().replace(",",""));
            var per = $(this).val();
            var dis_price = 0;

            $('#percent_radio').prop('checked',true);
            dis_price =( total_price * (per/100));
            $('#won_type').val('');
            $('#discount_price').text($.numberWithCommas(dis_price));

        });

        //금액 선택시
        $('#won_type').change(function(){
            var total_price = parseInt($('#total_pay_money').text().replace(",",""));
            var per = $(this).val();
            var dis_price = 0;

            $('#won_radio').prop('checked',true);
            dis_price =( total_price - per);
            $('#percent_type').val('');
            $('#discount_price').text($.numberWithCommas(per));

        });

        //할인금액적용하기
        $(document).on('click','.set_update_discount_btn',function(){
            var cid = $(this).data('seq');
            var type = 0;
            var num = 0;
            if($('#percent_type').val() != ''){
                type = 1;
                num = $('#percent_type').val();
            } else if($('#won_type').val() != ''){
                type = 2;
                num = $('#won_type').val();
            }

            if(type == 0 ){
                alert('할인 퍼센트 또는 할인 금액을 선택해주세요.');
                return false;
            }
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'saveDiscount','seq':cid,'type':type,'num':num},
                dataType: 'json',
                error: function() {
                    popalert.open('confirmOnlyOkNoLink','쿠폰 사용시 오류가 발생했습니다.');
                },
                success: function(json) {
                    if(json.flag == true){
                        var dp = parseInt($('#discount_price').text().replace(",", ""));
                        var tpp = parseInt($('#total_pay_money').text().replace(",", ""));
                        $('#total_discount_price').text($.numberWithCommas(dp));

                        $('#total_pay_price').val(tpp-dp);
                        $('#use_card').val(tpp-dp);
                        $('#total_pay_price_disp').text($.numberWithCommas(tpp-dp)+'원');
                        change_total(tpp-dp);
                        popalert.open('confirmOnlyOkNoLink','단골고객 할인이 적용되었습니다.');
                    }
                }
            });
        });

        function change_total(price){
            var currentVal = price;
            var seq = '<?php echo $payment_log_seq;?>';

            $.ajax({
                type : 'post',
                url : './data/get_book_data_ajax',
                data : {'mode':'changeTotalPrice','price':currentVal, 'seq':seq},
                dataType : 'json',
                success : function(json){

                }
            });
        }
        //적립금모두사용
        $(document).on('click','.all-use-reserve',function(){
            var price = $(this).data('price');
            if($('#use_reserve').prop('disabled') == true){
                alert('사용하실 수 없습니다.');
                return false;
            }
            $('#use_reserve').val(price);
        });

        //적립금 사용 저장
        $(document).on('click','.reserve-save-btn',function(){
            var price = $('#use_reserve').val().replace(",", "");
            var cur_price = parseInt($('#cur_reserve').text().replace(",", ""));
            var cid = $(this).data('cid');
            var tid = $(this).data('tid');
            var phone = $(this).data('phone');
            var seq = $(this).data('seq');
            var type = $(this).data('service');
            var aid = $(this).data('aid');
            if(!cid && !phone){
                popalert.open('confirmOnlyOkReload','적립금 사용을 위한 데이터가 없습니다. 새로고침 후 다시 이용해주세요.');
                return false;
            }

            if(!price || price == 0){
                popalert.open('talkExam','보유한 적립금이 없거나 부족하여 적용할 수 없습니다.');
                return false;
            }
            if(cur_price < price){
                popalert.open('talkExam','보유한 적립금이 없거나 부족하여 적용할 수 없습니다.');
                return false;
            }
            //적립금 사용시 해당 금액을 고정한다. 재설정시 사용가능하게 처리한다.
            $('#use_reserve').prop('disabled',true);
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'useReserve','cid':cid,'aid':aid,'tid':tid,'phone':phone,'price':price,'seq':seq,'type':type},
                dataType: 'json',
                error: function() {
                    popalert.open('confirmOnlyOkNoLink','적립금 사용시 오류가 발생했습니다.');
                },
                success: function(json) {
                    if(json.flag == true){
                        var dp = parseInt($('#use_reserve').val().replace(",", ""));
                        var tpp = parseInt($('#total_pay_price').val());
                        $('#user_reserve_price').val(json.price);
                        $('#cur_reserve').text($.numberWithCommas(json.cur_price));
                        $('.reserve-save-cancel').prop('disabled',false);
                        $('.reserve-save-btn').prop('disabled',true);
                        $('#total_reserve_price').text($.numberWithCommas(price));
                        $('#total_pay_price').val(tpp-dp);
                        $('#total_pay_price_disp').text($.numberWithCommas(tpp-dp)+'원');
                        //$('#use_card').val(tpp-dp);
                        popalert.open('confirmOnlyOkNoLink','적립금 사용이 완료되었습니다.');
                    }
                }
            });
        });

        //적립금 사용 재설정
        $(document).on('click','.reserve-save-cancel',function(){
            if(confirm('적립금 사용을 재설정하시겠습니다.')){
                $('#use_reserve').prop('disabled',false);
                var price = $('#use_reserve').val().replace(",", "");
                var cid = $(this).data('cid');
                var tid = $(this).data('tid');
                var phone = $(this).data('phone');
                var seq = $(this).data('seq');
                var type = $(this).data('service');
                var aid = $(this).data('aid');
                if(!cid || !phone){
                    popalert.open('confirmOnlyOkNoLink','적립금 사용을 위한 데이터가 없습니다. 새로고침 후 다시 이용해주세요.');
                    return false;
                }

                $.ajax({
                    type: 'post',
                    url: 'data/get_book_data_ajax',
                    data: {'mode':'useReserveCancel','cid':cid,'aid':aid,'tid':tid,'phone':phone,'price':price,'seq':seq,'type':type},
                    dataType: 'json',
                    error: function() {
                        alert('Error');
                    },
                    success: function(json) {
                        if(json.flag == true){
                            var dp = parseInt($('#use_reserve').val().replace(",", ""));
                            var tpp = parseInt($('#total_pay_price').val());
                            $('#user_reserve_price').val(json.price);
                            $('#use_reserve').val('0');
                            $('.all-use-reserve').data('price',json.cur_price)
                            $('#cur_reserve').text($.numberWithCommas(json.cur_price));
                            $('.reserve-save-cancel').prop('disabled',true);
                            $('.reserve-save-btn').prop('disabled',false);
                            $('#total_reserve_price').text('0');
                            $('#total_pay_price').val(tpp-dp);
                            $('#total_pay_price_disp').text($.numberWithCommas(tpp+dp)+'원');
                            //$('#use_card').val('0');
                            popalert.open('confirmOnlyOkNoLink','적립금 사용이 재설정되었습니다.');
                        }
                    }
                });
            }
        })

        //제품 +-
        function cnt_change(obj, type){
            var name = $('#'+obj+'_cnt');
            var org_cnt = parseInt($('#'+obj+'_cnt').val());
            if(type == 'm'){
                if(name.val() > 0){
                    name.val(org_cnt-1);
                }
            } else {
                if(name.val() < 100){
                    name.val(org_cnt+1);
                }
            }
        }


        //제품 선택 여부를 확인한다.
        function chk_box_press(obj, num){
            if(obj == 'gd'){
                if($('#gd_chkbox_y_'+num).is(':checked')==true){
                    $('#gd_chkbox_n_'+num).prop('disabled',true);
                } else {
                    console.log('unchecked')
                    $('#gd_chkbox_n_'+num).prop('disabled',false).prop('checked',true);
                }
            }

            if(obj == 'snack'){
                if($('#snack_chkbox_y_'+num).is(':checked')==true){
                    $('#snack_chkbox_n_'+num).prop('disabled',true);
                } else {
                    console.log('unchecked')
                    $('#snack_chkbox_n_'+num).prop('disabled',false).prop('checked',true);
                }
            }

            if(obj == 'feed'){
                if($('#feed_chkbox_y_'+num).is(':checked')==true){
                    $('#feed_chkbox_n_'+num).prop('disabled',true);
                } else {
                    console.log('unchecked')
                    $('#feed_chkbox_n_'+num).prop('disabled',false).prop('checked',true);
                }
            }

            if(obj == 'etc'){
                if($('#et_chkbox_y_'+num).is(':checked')==true){
                    $('#et_chkbox_n_'+num).prop('disabled',true);
                } else {
                    console.log('unchecked')
                    $('#et_chkbox_n_'+num).prop('disabled',false).prop('checked',true);
                }
            }

        }

        //최종 결제금액 저장
        $(document).on('click','.save-final-price',function(){
            var seq = $(this).data('seq');
            var card = $('#use_card').val();
            var cash = $('#use_cash').val();

            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'savePayResult','card':card,'cash':cash,'seq':seq},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    popalert.open('confirmOnlyOkReload',json.error);
                    location.reload();
                }
            });
        });

        //결제완료처리
        $(document).on('click','#pay_confirm',function(){
            var seq = $(this).data('seq');
            var con = 0;
            if($(this).is(':checked')==true){
                con = 1;
            }
            $.ajax({
                type: 'post',
                url: 'data/get_book_data_ajax',
                data: {'mode':'savePayConfirm','seq':seq, 'con':con},
                dataType: 'json',
                error: function() {
                    alert('Error');
                },
                success: function(json) {
                    console.log(json.error)
                    popalert.open('confirmOnlyOkNoLink',json.error);
                    $('#confirm_dt').text(json.time);
                    //alert(json.error);
                    //location.reload();
                }
            });
        });

        //현금 카드 전환하기
        $(document).on('click','.btn-data-change',function(){
            var tmp = $('#use_card').val();
            $('#use_card').val($('#use_cash').val());
            $('#use_cash').val(tmp);
        });


        //미용 종료 알림 발송
        $(document).on('click','.sendComplete',function(){
            var chk_time = '';
            var seq = $(this).data('seq');
            $('.timer').each(function(){
                if($(this).is(':checked')==true){
                    chk_time = $(this).val();
                }
            });


            if (chk_time != "" && chk_time != undefined) {

                $.ajax({
                    type: 'post',
                    data: {'timer':chk_time,'payment_log_seq':seq},
                    url: './data/send_notice_talk',
                    dataType: 'json',
                    error: function(xhr, error) {
                        alert('알림톡 발송이 실패했습니다. '+xhr+' : '+error);
                    },
                    success: function(json) {
                        if (json.result) {
                            alert('발송되었습니다.');
                            location.reload();
                        } else {
                            alert('알림톡 발송이 실패했습니다.');
                        }
                    }
                });
            } else {
                alert("시간을 선택해주세요.");
            }
        });


        //예약취소 알림톡 발송여부
        function confirm_send_reserv(msg){
            var seq = $('.cancel-rev').data('seq');
            var cid = $('.cancel-rev').data('cid');
            var tid = $('.cancel-rev').data('tid');


            $.ajax({
                type: 'post',
                data: {'mode':'cancelRev', 'payment_log_seq': seq, 'tid':tid, 'cid':cid,'talk':msg},
                url: './data/get_book_data_ajax',
                dataType: 'json',
                error: function (xhr, error) {
                    alert('알림톡 발송이 실패했습니다. ' + xhr + ' : ' + error);
                },
                success: function (json) {
                    if (json.flag) {
                        pop.open('reserveCalendarPop1','예약 취소되었습니다.');
                        setTimeout(function(){
                            location.href = '<?php echo $_GET['backurl'];?>';
                        },1500)
                    } else {
                        pop.open('reserveCalendarPop1','예약 취소시 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
                    }
                }
            });
        }

        //예약변경 알림톡 발송여부
        function confirm_change_reserv(msg){
            var seq = $('#change_cls').data('pay_seq');
            var org_date = $('#change_cls').data('org_date');

            $.ajax({
                type: 'post',
                data: {'mode':'changeReserve', 'payment_log_seq': seq, 'org_date':org_date},
                url: './data/get_book_data_ajax',
                dataType: 'json',
                error: function (xhr, error) {
                    alert('알림톡 발송이 실패했습니다. ' + xhr + ' : ' + error);
                },
                success: function (json) {
                    if (json.flag) {
                        popalert.open('reserveCalendarPop1','예약 변경되었습니다.');
                        setTimeout(function(){
                            location.href = '<?php echo $_SESSION['backurl1'];?>';
                        },1500)
                    } else {
                        pop.open('reserveCalendarPop1','예약 취소시 오류가 발생했습니다. 잠시 후 다시 시도해주세요.');
                    }
                }
            });
        }


        //예약취소
        $(document).on('click','.cancel-rev',function(){
            var seq = $('.cancel-rev').data('seq');
            var cid = $('.cancel-rev').data('cid');
            var tid = $('.cancel-rev').data('tid');
            var status = $('.cancel-rev').data('status');
            $('#reserveCancel .cancel-cls').data('seq',seq)
            $('#reserveCancel .cancel-cls').data('cid',cid)
            $('#reserveCancel .cancel-cls').data('tid',tid)

            if(status == "R1"){
                pop.open('neverCancel');
            }else{
                pop.open('reserveCancel');
            }

            //pop.open('reserveCancel');
        });

        $.numberWithCommas = function (x) {
            return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        //$('#btn_page_prev').prop('href','<?php //echo $_SESSION['backurl1'];?>//');

        /*
            $("#total_pay_price_disp").on("change keyup paste", function() {
                var currentVal = $(this).text();
                var seq = '<?php echo $payment_log_seq;?>';

        $.ajax({
            type : 'post',
            url : './data/get_book_data_ajax',
            data : {'mode':'changeTotalPrice','price':currentVal, 'seq':seq},
            dataType : 'json',
            success : function(json){

            }
        });
    });


    //카드 금액 변경시 업데이트 한다.
    $('#use_card').on("change keyup paste",function(){
        var currentVal = $(this).val();
        var seq = '<?php echo $payment_log_seq;?>';

        $.ajax({
            type : 'post',
            url : './data/get_book_data_ajax',
            data : {'mode':'changeTotalPrice','price':currentVal, 'seq':seq},
            dataType : 'json',
            success : function(json){

            }
        });
    });

    $(document).ready(function(){
        var currentVal = $('#total_pay_price_disp').text();
        var seq = '<?php echo $payment_log_seq;?>';

        $.ajax({
            type : 'post',
            url : './data/get_book_data_ajax',
            data : {'mode':'changeTotalPrice','price':currentVal, 'seq':seq},
            dataType : 'json',
            success : function(json){

            }
        });

        var cVal = $('#use_card').val();
        var seq = '<?php echo $payment_log_seq;?>';

        $.ajax({
            type : 'post',
            url : './data/get_book_data_ajax',
            data : {'mode':'changeCardPrice','price':cVal, 'seq':seq},
            dataType : 'json',
            success : function(json){

            }
        });

        $('#btn_page_prev').prop('href','<?php echo $_SESSION['backurl1'];?>');
    });
*/

        function show_img(img){
            $('#bigImg .msg-txt').html('<img src="'+img+'">')
            popalert.open('bigImg');
        }

        //특이사항 더보기
        $(document).on('click','.view-special-cmt',function(){
            if($(this).text() == '더보기'){
                $('.special-cmt').css('display','block');
                $(this).text('닫기');
            } else {
                $('.special-cmt').each(function(index){
                    if(index>3){
                        $('.special-cmt').eq(index).css('display','none');
                    }
                })
                $(this).text('더보기');
            }
        });
        //이전미용 더보기
        $(document).on('click','.view-prev-beauty',function(){
            if($(this).text() == '더보기'){
                $('.memo-item').css('display','block');
                $(this).text('닫기');
            } else {
                $('.memo-item').each(function(index){
                    if(index>3){
                        $('.memo-item').eq(index).attr('style','display: none !important');
                    }

                })
                console.log("1")
                $(this).text('더보기');
            }
        });
        $(document).ready(function(){
            $('#btn_page_prev').prop('href','<?php echo $_SESSION['backurl1'];?>');
            $('input[name="cat_weight"]').each(function(index){
                if($(this).is(':checked')==true){
                    $('.kg_'+(index-1)).css('display','block');
                }
            });
<!--            --><?php //if($_SESSION['anchor']=='Y'){ ?>
//            //서비스 변경시 등록위치로 이동시키기
//            var target = $("#tab1").offset().top;
//            $("div").scrollTop(target);
//            <?php //} unset($_SESSION['anchor']); ?>

            var total_price = parseInt($('#total_pay_money').text().replace(",",""));
            //change_total(total_price)


        });
        //고양이 미용 선택시
        function cat_show_view(g){
            $('.cat-weight').css('display','none');
            $('.kg_'+g).css('display','block');
        }







        
            //wide-tab 클릭시 #basic-data-group-target으로 이동



            // $(document.body).on("touchstart", ".tab-cell button", tabTouch);
            // $(document).on("click", ".tab-cell button", tabClick);
            //
            // function tabClick(){
            //     const click_target= document.querySelector("#basic-data-group-target");
            //     const click_targetY= pageYOffset + click_target.getBoundingClientRect().top -80
            //     console.log("click");
            //     $("body,html").stop().animate(
            //         {
            //             scrollTop: click_targetY,
            //         },
            //         500
            //     );
            // }
            //
            // function tabTouch(){
            //     const touch_target= document.querySelector("#basic-data-group-target");
            //     const touch_targetY= pageYOffset + touch_target.getBoundingClientRect().top -80
            //     console.log("touch");
            //
            //     $("body,html").stop().animate(
            //         {
            //             scrollTop: touch_targetY,
            //         },
            //         500
            //     );
            // }



           $(document).on("click", ".tab-cell a", function (event) {



            $("body,html").stop().animate(
                    {
                        scrollTop: $(this.hash).offset().top - 80
                    },
                    500
                );


        });



       //#sticky-bottom 지나가면 sticky 해제

        function onScroll(e){

            const sticky_target = document.querySelector("#sticky-tab-group-target");
            const classes = sticky_target.classList;
            const st_bt_target = pageYOffset + document.querySelector("#sticky-bottom").getBoundingClientRect().top;

            if(window.scrollY >= st_bt_target -100){
                            if(!classes.contains("sticky-remove")) {
                                sticky_target.classList.add("sticky-remove")

                            }
                    }else{
                            sticky_target.classList.remove("sticky-remove")
                }
        }
        //모멘텀 스크롤 최적화
        function timeoutScroll(){
            setTimeout(onScroll,500);
        }

        document.addEventListener("scroll",onScroll);
        document.addEventListener("touchmove",timeoutScroll)












    </script>

<?php
//include($_SERVER['DOCUMENT_ROOT']."/include/skin/footer_shop.php");
?>